var mypathseg=function(){"use strict";return{initPathSeg:function(){window.SVGPathSeg||(window.SVGPathSeg=function(t,e,r){this.pathSegType=t,this.pathSegTypeAsLetter=e,this._owningPathSegList=r},SVGPathSeg.PATHSEG_UNKNOWN=0,SVGPathSeg.PATHSEG_CLOSEPATH=1,SVGPathSeg.PATHSEG_MOVETO_ABS=2,SVGPathSeg.PATHSEG_MOVETO_REL=3,SVGPathSeg.PATHSEG_LINETO_ABS=4,SVGPathSeg.PATHSEG_LINETO_REL=5,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9,SVGPathSeg.PATHSEG_ARC_ABS=10,SVGPathSeg.PATHSEG_ARC_REL=11,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19,SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)},window.SVGPathSegClosePath=function(t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CLOSEPATH,"z",t)},SVGPathSegClosePath.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"},SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter},SVGPathSegClosePath.prototype.clone=function(){return new SVGPathSegClosePath(void 0)},window.SVGPathSegMovetoAbs=function(t,e,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_ABS,"M",t),this._x=e,this._y=r},SVGPathSegMovetoAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"},SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegMovetoAbs.prototype.clone=function(){return new SVGPathSegMovetoAbs(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegMovetoRel=function(t,e,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_REL,"m",t),this._x=e,this._y=r},SVGPathSegMovetoRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"},SVGPathSegMovetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegMovetoRel.prototype.clone=function(){return new SVGPathSegMovetoRel(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoAbs=function(t,e,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_ABS,"L",t),this._x=e,this._y=r},SVGPathSegLinetoAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"},SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegLinetoAbs.prototype.clone=function(){return new SVGPathSegLinetoAbs(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegLinetoAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoRel=function(t,e,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_REL,"l",t),this._x=e,this._y=r},SVGPathSegLinetoRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"},SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegLinetoRel.prototype.clone=function(){return new SVGPathSegLinetoRel(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicAbs=function(t,e,r,n,i,h,o){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",t),this._x=e,this._y=r,this._x1=n,this._y1=i,this._x2=h,this._y2=o},SVGPathSegCurvetoCubicAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"},SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicAbs(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicRel=function(t,e,r,n,i,h,o){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",t),this._x=e,this._y=r,this._x1=n,this._y1=i,this._x2=h,this._y2=o},SVGPathSegCurvetoCubicRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"},SVGPathSegCurvetoCubicRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicRel(void 0,this._x,this._y,this._x1,this._y1,this._x2,this._y2)},Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticAbs=function(t,e,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",t),this._x=e,this._y=r,this._x1=n,this._y1=i},SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoQuadraticAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticAbs]"},SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticAbs(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticRel=function(t,e,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",t),this._x=e,this._y=r,this._x1=n,this._y1=i},SVGPathSegCurvetoQuadraticRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"},SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y},SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticRel(void 0,this._x,this._y,this._x1,this._y1)},Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x1",{get:function(){return this._x1},set:function(t){this._x1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(t){this._y1=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegArcAbs=function(t,e,r,n,i,h,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_ABS,"A",t),this._x=e,this._y=r,this._r1=n,this._r2=i,this._angle=h,this._largeArcFlag=o,this._sweepFlag=s},SVGPathSegArcAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"},SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},SVGPathSegArcAbs.prototype.clone=function(){return new SVGPathSegArcAbs(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(SVGPathSegArcAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(t){this._r1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(t){this._r2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(t){this._largeArcFlag=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(t){this._sweepFlag=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegArcRel=function(t,e,r,n,i,h,o,s){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_REL,"a",t),this._x=e,this._y=r,this._r1=n,this._r2=i,this._angle=h,this._largeArcFlag=o,this._sweepFlag=s},SVGPathSegArcRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"},SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y},SVGPathSegArcRel.prototype.clone=function(){return new SVGPathSegArcRel(void 0,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)},Object.defineProperty(SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(t){this._r1=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(t){this._r2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(t){this._largeArcFlag=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(t){this._sweepFlag=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoHorizontalAbs=function(t,e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,"H",t),this._x=e},SVGPathSegLinetoHorizontalAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"},SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new SVGPathSegLinetoHorizontalAbs(void 0,this._x)},Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoHorizontalRel=function(t,e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",t),this._x=e},SVGPathSegLinetoHorizontalRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"},SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x},SVGPathSegLinetoHorizontalRel.prototype.clone=function(){return new SVGPathSegLinetoHorizontalRel(void 0,this._x)},Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoVerticalAbs=function(t,e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",t),this._y=e},SVGPathSegLinetoVerticalAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"},SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new SVGPathSegLinetoVerticalAbs(void 0,this._y)},Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegLinetoVerticalRel=function(t,e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",t),this._y=e},SVGPathSegLinetoVerticalRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"},SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y},SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new SVGPathSegLinetoVerticalRel(void 0,this._y)},Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicSmoothAbs=function(t,e,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",t),this._x=e,this._y=r,this._x2=n,this._y2=i},SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"},SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoCubicSmoothRel=function(t,e,r,n,i){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",t),this._x=e,this._y=r,this._x2=n,this._y2=i},SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"},SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y},SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothRel(void 0,this._x,this._y,this._x2,this._y2)},Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(t){this._x2=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(t){this._y2=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticSmoothAbs=function(t,e,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",t),this._x=e,this._y=r},SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"},SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),window.SVGPathSegCurvetoQuadraticSmoothRel=function(t,e,r){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",t),this._x=e,this._y=r},SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(SVGPathSeg.prototype),SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"},SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y},SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,this._x,this._y)},Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._segmentChanged()},enumerable:!0}),Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._segmentChanged()},enumerable:!0}),SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new SVGPathSegClosePath(void 0)},SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(t,e){return new SVGPathSegMovetoAbs(void 0,t,e)},SVGPathElement.prototype.createSVGPathSegMovetoRel=function(t,e){return new SVGPathSegMovetoRel(void 0,t,e)},SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(t,e){return new SVGPathSegLinetoAbs(void 0,t,e)},SVGPathElement.prototype.createSVGPathSegLinetoRel=function(t,e){return new SVGPathSegLinetoRel(void 0,t,e)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(t,e,r,n,i,h){return new SVGPathSegCurvetoCubicAbs(void 0,t,e,r,n,i,h)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(t,e,r,n,i,h){return new SVGPathSegCurvetoCubicRel(void 0,t,e,r,n,i,h)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(t,e,r,n){return new SVGPathSegCurvetoQuadraticAbs(void 0,t,e,r,n)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(t,e,r,n){return new SVGPathSegCurvetoQuadraticRel(void 0,t,e,r,n)},SVGPathElement.prototype.createSVGPathSegArcAbs=function(t,e,r,n,i,h,o){return new SVGPathSegArcAbs(void 0,t,e,r,n,i,h,o)},SVGPathElement.prototype.createSVGPathSegArcRel=function(t,e,r,n,i,h,o){return new SVGPathSegArcRel(void 0,t,e,r,n,i,h,o)},SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(t){return new SVGPathSegLinetoHorizontalAbs(void 0,t)},SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(t){return new SVGPathSegLinetoHorizontalRel(void 0,t)},SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(t){return new SVGPathSegLinetoVerticalAbs(void 0,t)},SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(t){return new SVGPathSegLinetoVerticalRel(void 0,t)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(t,e,r,n){return new SVGPathSegCurvetoCubicSmoothAbs(void 0,t,e,r,n)},SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(t,e,r,n){return new SVGPathSegCurvetoCubicSmoothRel(void 0,t,e,r,n)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(t,e){return new SVGPathSegCurvetoQuadraticSmoothAbs(void 0,t,e)},SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(t,e){return new SVGPathSegCurvetoQuadraticSmoothRel(void 0,t,e)}),window.SVGPathSegList||(window.SVGPathSegList=function(t){this._pathElement=t,this._list=this._parsePath(this._pathElement.getAttribute("d")),this._mutationObserverConfig={attributes:!0,attributeFilter:["d"]},this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},Object.defineProperty(SVGPathSegList.prototype,"numberOfItems",{get:function(){return this._checkPathSynchronizedToList(),this._list.length}}),SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())},SVGPathSegList.prototype._updateListFromPathMutations=function(t){if(this._pathElement){var e=!1;t.forEach(function(t){"d"==t.attributeName&&(e=!0)}),e&&(this._list=this._parsePath(this._pathElement.getAttribute("d")))}},SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect(),this._pathElement.setAttribute("d",SVGPathSegList._pathSegArrayAsString(this._list)),this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)},SVGPathSegList.prototype.segmentChanged=function(t){this._writeListToPath()},SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList(),this._list.forEach(function(t){t._owningPathSegList=null}),this._list=[],this._writeListToPath()},SVGPathSegList.prototype.initialize=function(t){return this._checkPathSynchronizedToList(),this._list=[t],t._owningPathSegList=this,this._writeListToPath(),t},SVGPathSegList.prototype._checkValidIndex=function(t){if(isNaN(t)||t<0||t>=this.numberOfItems)throw"INDEX_SIZE_ERR"},SVGPathSegList.prototype.getItem=function(t){return this._checkPathSynchronizedToList(),this._checkValidIndex(t),this._list[t]},SVGPathSegList.prototype.insertItemBefore=function(t,e){return this._checkPathSynchronizedToList(),e>this.numberOfItems&&(e=this.numberOfItems),t._owningPathSegList&&(t=t.clone()),this._list.splice(e,0,t),t._owningPathSegList=this,this._writeListToPath(),t},SVGPathSegList.prototype.replaceItem=function(t,e){return this._checkPathSynchronizedToList(),t._owningPathSegList&&(t=t.clone()),this._checkValidIndex(e),this._list[e]=t,t._owningPathSegList=this,this._writeListToPath(),t},SVGPathSegList.prototype.removeItem=function(t){this._checkPathSynchronizedToList(),this._checkValidIndex(t);var e=this._list[t];return this._list.splice(t,1),this._writeListToPath(),e},SVGPathSegList.prototype.appendItem=function(t){return this._checkPathSynchronizedToList(),t._owningPathSegList&&(t=t.clone()),this._list.push(t),t._owningPathSegList=this,this._writeListToPath(),t},SVGPathSegList._pathSegArrayAsString=function(t){var e="",r=!0;return t.forEach(function(t){r?(r=!1,e+=t._asPathString()):e+=" "+t._asPathString()}),e},SVGPathSegList.prototype._parsePath=function(t){if(!t||0==t.length)return[];var e=this,r=function(){this.pathSegList=[]};r.prototype.appendSegment=function(t){this.pathSegList.push(t)};var n=function(t){this._string=t,this._currentIndex=0,this._endIndex=this._string.length,this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN,this._skipOptionalSpaces()};n.prototype._isCurrentSpace=function(){var t=this._string[this._currentIndex];return t<=" "&&(" "==t||"\n"==t||"\t"==t||"\r"==t||"\f"==t)},n.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex},n.prototype._skipOptionalSpacesOrDelimiter=function(){return!(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&","!=this._string.charAt(this._currentIndex))&&(this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","==this._string.charAt(this._currentIndex)&&(this._currentIndex++,this._skipOptionalSpaces()),this._currentIndex<this._endIndex)},n.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex},n.prototype.peekSegmentType=function(){var t=this._string[this._currentIndex];return this._pathSegTypeFromChar(t)},n.prototype._pathSegTypeFromChar=function(t){switch(t){case"Z":case"z":return SVGPathSeg.PATHSEG_CLOSEPATH;case"M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case"m":return SVGPathSeg.PATHSEG_MOVETO_REL;case"L":return SVGPathSeg.PATHSEG_LINETO_ABS;case"l":return SVGPathSeg.PATHSEG_LINETO_REL;case"C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case"c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case"Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case"q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case"A":return SVGPathSeg.PATHSEG_ARC_ABS;case"a":return SVGPathSeg.PATHSEG_ARC_REL;case"H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case"h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;case"V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case"v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case"S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case"s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case"T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case"t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}},n.prototype._nextCommandHelper=function(t,e){return("+"==t||"-"==t||"."==t||t>="0"&&t<="9")&&e!=SVGPathSeg.PATHSEG_CLOSEPATH?e==SVGPathSeg.PATHSEG_MOVETO_ABS?SVGPathSeg.PATHSEG_LINETO_ABS:e==SVGPathSeg.PATHSEG_MOVETO_REL?SVGPathSeg.PATHSEG_LINETO_REL:e:SVGPathSeg.PATHSEG_UNKNOWN},n.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return!0;var t=this.peekSegmentType();return t==SVGPathSeg.PATHSEG_MOVETO_ABS||t==SVGPathSeg.PATHSEG_MOVETO_REL},n.prototype._parseNumber=function(){var t=0,e=0,r=1,n=0,i=1,h=1,o=this._currentIndex;if(this._skipOptionalSpaces(),this._currentIndex<this._endIndex&&"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:this._currentIndex<this._endIndex&&"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,i=-1),!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&"."!=this._string.charAt(this._currentIndex))){for(var s=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)this._currentIndex++;if(this._currentIndex!=s)for(var a=this._currentIndex-1,S=1;a>=s;)e+=S*(this._string.charAt(a--)-"0"),S*=10;if(this._currentIndex<this._endIndex&&"."==this._string.charAt(this._currentIndex)){if(this._currentIndex++,this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)n+=(this._string.charAt(this._currentIndex++)-"0")*(r*=.1)}if(this._currentIndex!=o&&this._currentIndex+1<this._endIndex&&("e"==this._string.charAt(this._currentIndex)||"E"==this._string.charAt(this._currentIndex))&&"x"!=this._string.charAt(this._currentIndex+1)&&"m"!=this._string.charAt(this._currentIndex+1)){if(this._currentIndex++,"+"==this._string.charAt(this._currentIndex)?this._currentIndex++:"-"==this._string.charAt(this._currentIndex)&&(this._currentIndex++,h=-1),this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";)t*=10,t+=this._string.charAt(this._currentIndex)-"0",this._currentIndex++}var u=e+n;if(u*=i,t&&(u*=Math.pow(10,h*t)),o!=this._currentIndex)return this._skipOptionalSpacesOrDelimiter(),u}},n.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var t=!1,e=this._string.charAt(this._currentIndex++);if("0"==e)t=!1;else{if("1"!=e)return;t=!0}return this._skipOptionalSpacesOrDelimiter(),
t}},n.prototype.parseSegment=function(){var t=this._string[this._currentIndex],r=this._pathSegTypeFromChar(t);if(r==SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==SVGPathSeg.PATHSEG_UNKNOWN)return null;if(r=this._nextCommandHelper(t,this._previousCommand),r==SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;switch(this._previousCommand=r,r){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(e,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(e,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(e,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(e,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(e,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(e,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(e,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(e,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:return this._skipOptionalSpaces(),new SVGPathSegClosePath(e);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(e,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(e,n.x,n.y,n.x1,n.y1,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(e,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:var n={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(e,n.x,n.y,n.x2,n.y2);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(e,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(e,n.x,n.y,n.x1,n.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(e,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(e,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_ARC_REL:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(e,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);case SVGPathSeg.PATHSEG_ARC_ABS:var n={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcAbs(e,n.x,n.y,n.x1,n.y1,n.arcAngle,n.arcLarge,n.arcSweep);default:throw"Unknown path seg type."}};var i=new r,h=new n(t);if(!h.initialCommandIsMoveTo())return[];for(;h.hasMoreData();){var o=h.parseSegment();if(!o)return[];i.appendSegment(o)}return i.pathSegList},Object.defineProperty(SVGPathElement.prototype,"pathSegList",{get:function(){return this._pathSegList||(this._pathSegList=new SVGPathSegList(this)),this._pathSegList},enumerable:!0}),Object.defineProperty(SVGPathElement.prototype,"normalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),Object.defineProperty(SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}),Object.defineProperty(SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:!0}))}}}(mypathseg||{});
svgedit={NS:{HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://web-edit.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}},svgedit.getReverseNS=function(){"use strict";var t={};return $.each(this.NS,function(w,e){t[e]=w.toLowerCase()}),t};
var mybrowser=function(){"use strict";return{initBrowser:function(){svgedit.browser||(svgedit.browser={});var e=svgedit.NS,t=function(){return!!document.createElementNS&&!!document.createElementNS(e.SVG,"svg").createSVGRect}();if(svgedit.browser.supportsSvg=function(){return t},!svgedit.browser.supportsSvg())return void(window.location="browser-not-supported.html");var r=navigator.userAgent,n=document.createElementNS(e.SVG,"svg"),o=!!window.opera,i=r.indexOf("AppleWebKit")>=0,s=r.indexOf("Gecko/")>=0,u=r.indexOf("MSIE")>=0,c=r.indexOf("Chrome/")>=0,d=r.indexOf("Windows")>=0,a=r.indexOf("Macintosh")>=0,m="ontouchstart"in window,v=function(){return!!n.querySelector}(),p=function(){return!!document.evaluate}(),f=function(){var t=document.createElementNS(e.SVG,"path");t.setAttribute("d","M0,0 10,10");var r=t.pathSegList,n=t.createSVGPathSegLinetoAbs(5,5);try{return r.replaceItem(n,0),!0}catch(e){}return!1}(),l=function(){var t=document.createElementNS(e.SVG,"path");t.setAttribute("d","M0,0 10,10");var r=t.pathSegList,n=t.createSVGPathSegLinetoAbs(5,5);try{return r.insertItemBefore(n,0),!0}catch(e){}return!1}(),g=function(){var t=document.createElementNS(e.SVG,"svg"),r=document.createElementNS(e.SVG,"svg");document.documentElement.appendChild(t),r.setAttribute("x",5),t.appendChild(r);var n=document.createElementNS(e.SVG,"text");n.textContent="a",r.appendChild(n);var o=n.getStartPositionOfChar(0).x;return document.documentElement.removeChild(t),0===o}(),S=function(){var t=document.createElementNS(e.SVG,"svg");document.documentElement.appendChild(t);var r=document.createElementNS(e.SVG,"path");r.setAttribute("d","M0,0 C0,0 10,10 10,0"),t.appendChild(r);var n=r.getBBox();return document.documentElement.removeChild(t),n.height>4&&n.height<5}(),b=function(){var t=document.createElementNS(e.SVG,"svg");document.documentElement.appendChild(t);var r=document.createElementNS(e.SVG,"path");r.setAttribute("d","M0,0 10,0");var n=document.createElementNS(e.SVG,"path");n.setAttribute("d","M5,0 15,0");var o=document.createElementNS(e.SVG,"g");o.appendChild(r),o.appendChild(n),t.appendChild(o);var i=o.getBBox();return document.documentElement.removeChild(t),15==i.width}(),h=function(){return o}(),w=function(){var t=document.createElementNS(e.SVG,"rect");t.setAttribute("x",.1);var r=t.cloneNode(!1),n=r.getAttribute("x").indexOf(",")==-1;return n||$.alert("NOTE: This version of Opera is known to contain bugs."),n}(),E=function(){var t=document.createElementNS(e.SVG,"rect");return t.setAttribute("style","vector-effect:non-scaling-stroke"),"non-scaling-stroke"===t.style.vectorEffect}(),G=function(){var t=document.createElementNS(e.SVG,"rect"),r=t.transform.baseVal,o=n.createSVGTransform();return r.appendItem(o),r.getItem(0)==o}();svgedit.browser.isOpera=function(){return o},svgedit.browser.isWebkit=function(){return i},svgedit.browser.isGecko=function(){return s},svgedit.browser.isIE=function(){return u},svgedit.browser.isChrome=function(){return c},svgedit.browser.isWindows=function(){return d},svgedit.browser.isMac=function(){return a},svgedit.browser.isTouch=function(){return m},svgedit.browser.supportsSelectors=function(){return v},svgedit.browser.supportsXpath=function(){return p},svgedit.browser.supportsPathReplaceItem=function(){return f},svgedit.browser.supportsPathInsertItemBefore=function(){return l},svgedit.browser.supportsPathBBox=function(){return S},svgedit.browser.supportsHVLineContainerBBox=function(){return b},svgedit.browser.supportsGoodTextCharPos=function(){return g},svgedit.browser.supportsEditableText=function(){return h},svgedit.browser.supportsGoodDecimals=function(){return w},svgedit.browser.supportsNonScalingStroke=function(){return E},svgedit.browser.supportsNativeTransformLists=function(){return G}}}}(mybrowser||{});
(function(){"use strict";function i(n){var t=n.matrix,i="",f,u,r;switch(n.type){case 1:i="matrix("+[t.a,t.b,t.c,t.d,t.e,t.f].join(",")+")";break;case 2:i="translate("+t.e+","+t.f+")";break;case 3:i=t.a==t.d?"scale("+t.a+")":"scale("+t.a+","+t.d+")";break;case 4:f=0;u=0;n.angle!=0&&(r=1-t.a,u=(r*t.f+t.b*t.e)/(r*r+t.b*t.b),f=(t.e-t.b*u)/r);i="rotate("+n.angle+" "+f+","+u+")"}return i}var t,n;svgedit.transformlist||(svgedit.transformlist={});t=document.createElementNS(svgedit.NS.SVG,"svg");n={};svgedit.transformlist.SVGTransformList=function(r){this._elem=r||null;this._xforms=[];this._update=function(){for(var r="",f=t.createSVGMatrix(),u,n=0;n<this.numberOfItems;++n)u=this._list.getItem(n),r+=i(u)+" ";this._elem.setAttribute("transform",r)};this._list=this;this._init=function(){var u=this._elem.getAttribute("transform"),e,r;if(u)for(e=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,r=!0;r;)if(r=u.match(e),u=u.replace(e,""),r&&r[1]){var l=r[1],h=l.split(/\s*\(/),i=h[0],o=h[1].match(/\s*(.*?)\s*\)/);o[1]=o[1].replace(/(\d)-/g,"$1 -");var f=o[1].split(/[, ]+/),a="abcdef".split(""),c=t.createSVGMatrix();$.each(f,function(n,t){f[n]=parseFloat(t);i=="matrix"&&(c[a[n]]=f[n])});var s=t.createSVGTransform(),v="set"+i.charAt(0).toUpperCase()+i.slice(1),n=i=="matrix"?[c]:f;i=="scale"&&n.length==1?n.push(n[0]):i=="translate"&&n.length==1?n.push(0):i=="rotate"&&n.length==1&&n.push(0,0);s[v].apply(s,n);this._list.appendItem(s)}};this._removeFromOtherLists=function(t){var u,f,r,i,e;if(t){u=!1;for(f in n){for(r=n[f],i=0,e=r._xforms.length;i<e;++i)if(r._xforms[i]==t){u=!0;r.removeItem(i);break}if(u)break}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(n){this.numberOfItems=1;this._removeFromOtherLists(n);this._xforms=[n]};this.getItem=function(n){if(n<this.numberOfItems&&n>=0)return this._xforms[n];throw{code:1};};this.insertItemBefore=function(n,t){var u=null,r,i,f;if(t>=0)if(t<this.numberOfItems){for(this._removeFromOtherLists(n),r=new Array(this.numberOfItems+1),i=0;i<t;++i)r[i]=this._xforms[i];for(r[i]=n,f=i+1;i<this.numberOfItems;++f,++i)r[f]=this._xforms[i];this.numberOfItems++;this._xforms=r;u=n;this._list._update()}else u=this._list.appendItem(n);return u};this.replaceItem=function(n,t){var i=null;return t<this.numberOfItems&&t>=0&&(this._removeFromOtherLists(n),this._xforms[t]=n,i=n,this._list._update()),i};this.removeItem=function(n){if(n<this.numberOfItems&&n>=0){for(var u=this._xforms[n],r=new Array(this.numberOfItems-1),i,t=0;t<n;++t)r[t]=this._xforms[t];for(i=t;i<this.numberOfItems-1;++i,++t)r[i]=this._xforms[t+1];return this.numberOfItems--,this._xforms=r,this._list._update(),u}throw{code:1};};this.appendItem=function(n){return this._removeFromOtherLists(n),this._xforms.push(n),this.numberOfItems++,this._list._update(),n}};svgedit.transformlist.resetListMap=function(){n={}};svgedit.transformlist.removeElementFromListMap=function(t){t.id&&n[t.id]&&delete n[t.id]};svgedit.transformlist.getTransformList=function(t){if(!svgedit.browser.supportsNativeTransformLists()){var i=t.id||"temp",r=n[i];return r&&i!=="temp"||(n[i]=new svgedit.transformlist.SVGTransformList(t),n[i]._init(),r=n[i]),r}return t.transform?t.transform.baseVal:t.gradientTransform?t.gradientTransform.baseVal:t.patternTransform?t.patternTransform.baseVal:null}})();
(function(){"use strict";svgedit.math||(svgedit.math={});var n=1e-14,t=document.createElementNS(svgedit.NS.SVG,"svg");svgedit.math.transformPoint=function(n,t,i){return{x:i.a*n+i.c*t+i.e,y:i.b*n+i.d*t+i.f}};svgedit.math.isIdentity=function(n){return n.a===1&&n.b===0&&n.c===0&&n.d===1&&n.e===0&&n.f===0};svgedit.math.matrixMultiply=function(){for(var i=arguments,r=i.length,t=i[r-1],u;r-->1;)u=i[r-1],t=u.multiply(t);return Math.abs(t.a)<n&&(t.a=0),Math.abs(t.b)<n&&(t.b=0),Math.abs(t.c)<n&&(t.c=0),Math.abs(t.d)<n&&(t.d=0),Math.abs(t.e)<n&&(t.e=0),Math.abs(t.f)<n&&(t.f=0),t};svgedit.math.hasMatrixTransform=function(n){var t,i;if(!n)return!1;for(t=n.numberOfItems;t--;)if(i=n.getItem(t),i.type==1&&!svgedit.math.isIdentity(i.matrix))return!0;return!1};svgedit.math.transformBox=function(n,t,i,r,u){var h=svgedit.math.transformPoint,f=h(n,t,u),e=h(n+i,t,u),o=h(n,t+r,u),s=h(n+i,t+r,u),c=Math.min(f.x,e.x,o.x,s.x),a=Math.max(f.x,e.x,o.x,s.x),l=Math.min(f.y,e.y,o.y,s.y),v=Math.max(f.y,e.y,o.y,s.y);return{tl:f,tr:e,bl:o,br:s,aabox:{x:c,y:l,width:a-c,height:v-l}}};svgedit.math.transformListToTransform=function(n,i,r){var e,f,u,o;if(n==null)return t.createSVGTransformFromMatrix(t.createSVGMatrix());for(i=i||0,r=r||n.numberOfItems-1,i=parseInt(i,10),r=parseInt(r,10),i>r&&(e=r,r=i,i=e),f=t.createSVGMatrix(),u=i;u<=r;++u)o=u>=0&&u<n.numberOfItems?n.getItem(u).matrix:t.createSVGMatrix(),f=svgedit.math.matrixMultiply(f,o);return t.createSVGTransformFromMatrix(f)};svgedit.math.getMatrix=function(n){var t=svgedit.transformlist.getTransformList(n);return svgedit.math.transformListToTransform(t).matrix};svgedit.math.snapToAngle=function(n,t,i,r){var o=Math.PI/4,u=i-n,f=r-t,h=Math.atan2(f,u),s=Math.sqrt(u*u+f*f),e=Math.round(h/o)*o;return{x:n+s*Math.cos(e),y:t+s*Math.sin(e),a:e}};svgedit.math.rectsIntersect=function(n,t){return t.x<n.x+n.width&&t.x+t.width>n.x&&t.y<n.y+n.height&&t.y+t.height>n.y}})();
(function(){"use strict";var f;svgedit.units||(svgedit.units={});var i=svgedit.NS,r=["x","x1","cx","rx","width"],u=["y","y1","cy","ry","height"],e=["r","radius"].concat(r,u),n,t={};svgedit.units.init=function(r){var e,u,o,f;n=r;e=document.createElementNS(i.SVG,"svg");document.body.appendChild(e);u=document.createElementNS(i.SVG,"rect");u.setAttribute("width","1em");u.setAttribute("height","1ex");u.setAttribute("x","1in");e.appendChild(u);o=u.getBBox();document.body.removeChild(e);f=o.x;t={em:o.width,ex:o.height,"in":f,cm:f/2.54,mm:f/25.4,pt:f/72,pc:f/6,px:1,"%":0}};svgedit.units.getTypeMap=function(){return t};svgedit.units.shortFloat=function(t){var i=n.getRoundDigits();return isNaN(t)?$.isArray(t)?svgedit.units.shortFloat(t[0])+","+svgedit.units.shortFloat(t[1]):parseFloat(t).toFixed(i)-0:+(+t).toFixed(i)};svgedit.units.convertUnit=function(i,r){return r=r||n.getBaseUnit(),svgedit.units.shortFloat(i/t[r])};svgedit.units.setUnitAttr=function(n,t,i){n.setAttribute(t,i)};f={line:["x1","x2","y1","y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(i){var c=i.tagName,s=n.getBaseUnit(),e=f[c],h,r,o,u;if(e)for(h=e.length,r=0;r<h;r++)o=e[r],u=i.getAttribute(o),u&&(isNaN(u)||i.setAttribute(o,u/t[s]+s))};svgedit.units.convertToNum=function(i,f){var e,o,s,h;return isNaN(f)?f.substr(-1)==="%"?(e=f.substr(0,f.length-1)/100,o=n.getWidth(),s=n.getHeight(),r.indexOf(i)>=0)?e*o:u.indexOf(i)>=0?e*s:e*Math.sqrt(o*o+s*s)/Math.sqrt(2):(h=f.substr(-2),e=f.substr(0,f.length-2),e*t[h]):+f};svgedit.units.isValidUnit=function(i,r,u){var f=!1,o,s;if(e.indexOf(i)>=0)isNaN(r)?(r=r.toLowerCase(),$.each(t,function(n){if(!f){var t=new RegExp("^-?[\\d\\.]+"+n+"$");t.test(r)&&(f=!0)}})):f=!0;else if(i=="id"){o=!1;try{s=n.getElement(r);o=s==null||s===u}catch(h){}return o}return f=!0}})();
var mysvgutils=function(t){"use strict";return{initSvgutils:function(){function e(t){if(svgedit.browser.supportsHVLineContainerBBox())try{return t.getBBox()}catch(t){}var e,i,r=$.data(t,"ref"),n=null;r?(i=$(r).children().clone().attr("visibility","hidden"),$(a).append(i),n=i.filter("line, path")):n=$(t).find("line, path");var s=!1;if(n.length)if(n.each(function(){var t=this.getBBox();t.width&&t.height||(s=!0)}),s){var o=r?i:$(t).children();e=getStrokedBBox(o)}else e=t.getBBox();else e=t.getBBox();return r&&i.remove(),e}svgedit.utilities||(svgedit.utilities={});var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=svgedit.NS,n="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use",s=n.split(","),o=null,u=null,l=null,a=null;svgedit.utilities.init=function(t){o=t,u=t.getDOMDocument(),l=t.getDOMContainer(),a=t.getSVGRoot()},svgedit.utilities.toXml=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&#x27;")},svgedit.utilities.fromXml=function(t){return $("<p/>").html(t).text()},svgedit.utilities.encode64=function(t){if(t=svgedit.utilities.encodeUTF8(t),window.btoa)return window.btoa(t);var e=[];e.length=4*Math.floor((t.length+2)/3);var r,n,s,o,u,l,a,g=0,d=0;do r=t.charCodeAt(g++),n=t.charCodeAt(g++),s=t.charCodeAt(g++),o=r>>2,u=(3&r)<<4|n>>4,l=(15&n)<<2|s>>6,a=63&s,isNaN(n)?l=a=64:isNaN(s)&&(a=64),e[d++]=i.charAt(o),e[d++]=i.charAt(u),e[d++]=i.charAt(l),e[d++]=i.charAt(a);while(g<t.length);return e.join("")},svgedit.utilities.decode64=function(t){if(window.atob)return svgedit.utilities.decodeUTF8(window.atob(t));var e,r,n,s,o,u="",l="",a="",g=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=i.indexOf(t.charAt(g++)),s=i.indexOf(t.charAt(g++)),o=i.indexOf(t.charAt(g++)),a=i.indexOf(t.charAt(g++)),e=n<<2|s>>4,r=(15&s)<<4|o>>2,l=(3&o)<<6|a,u+=String.fromCharCode(e),64!=o&&(u+=String.fromCharCode(r)),64!=a&&(u+=String.fromCharCode(l)),e=r=l="",n=s=o=a="";while(g<t.length);return svgedit.utilities.decodeUTF8(u)},svgedit.utilities.decodeUTF8=function(t){return decodeURIComponent(escape(t))},svgedit.utilities.encodeUTF8=function(t){return unescape(encodeURIComponent(t))},svgedit.utilities.convertToXMLReferences=function(t){var e,i="";for(e=0;e<t.length;e++){var r=t.charCodeAt(e);r<128?i+=t[e]:r>127&&(i+="&#"+r+";")}return i},svgedit.utilities.text2xml=function(t){t.indexOf("<svg:svg")>=0&&(t=t.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns"));var e,i;try{i=window.DOMParser?new DOMParser:new ActiveXObject("Microsoft.XMLDOM"),i.async=!1}catch(t){throw new Error("XML Parser could not be instantiated")}try{e=i.loadXML?!!i.loadXML(t)&&i:i.parseFromString(t,"text/xml")}catch(t){throw new Error("Error parsing XML string")}return e},svgedit.utilities.bboxToObj=function(t){return{x:t.x,y:t.y,width:t.width,height:t.height}},svgedit.utilities.walkTree=function(t,e){if(t&&1==t.nodeType){e(t);for(var i=t.childNodes.length;i--;)svgedit.utilities.walkTree(t.childNodes.item(i),e)}},svgedit.utilities.walkTreePost=function(t,e){if(t&&1==t.nodeType){for(var i=t.childNodes.length;i--;)svgedit.utilities.walkTree(t.childNodes.item(i),e);e(t)}},svgedit.utilities.getUrlFromAttr=function(t){if(t){if(0===t.indexOf('url("'))return t.substring(5,t.indexOf('"',6));if(0===t.indexOf("url('"))return t.substring(5,t.indexOf("'",6));if(0===t.indexOf("url("))return t.substring(4,t.indexOf(")"))}return null},svgedit.utilities.getHref=function(t){return t.getAttributeNS(r.XLINK,"href")},svgedit.utilities.setHref=function(t,e){t.setAttributeNS(r.XLINK,"xlink:href",e)},svgedit.utilities.findDefs=function(){var t=o.getSVGContent(),e=t.getElementsByTagNameNS(r.SVG,"defs");return e.length>0?e=e[0]:(e=t.ownerDocument.createElementNS(r.SVG,"defs"),t.firstChild?t.insertBefore(e,t.firstChild.nextSibling):t.appendChild(e)),e},svgedit.utilities.getPathBBox=function(e){var i,r=e.pathSegList,n=r.numberOfItems,s=[[],[]],o=r.getItem(0),u=[o.x,o.y];for(i=0;i<n;i++){var l=r.getItem(i);if(l.x!==t)if(s[0].push(u[0]),s[1].push(u[1]),l.x1){var a,g=[l.x1,l.y1],d=[l.x2,l.y2],c=[l.x,l.y];for(a=0;a<2;a++){var f=function(t){return Math.pow(1-t,3)*u[a]+3*Math.pow(1-t,2)*t*g[a]+3*(1-t)*Math.pow(t,2)*d[a]+Math.pow(t,3)*c[a]},v=6*u[a]-12*g[a]+6*d[a],h=-3*u[a]+9*g[a]-9*d[a]+3*c[a],p=3*g[a]-3*u[a];if(0!=h){var x=Math.pow(v,2)-4*p*h;if(!(x<0)){var m=(-v+Math.sqrt(x))/(2*h);0<m&&m<1&&s[a].push(f(m));var b=(-v-Math.sqrt(x))/(2*h);0<b&&b<1&&s[a].push(f(b))}}else{if(0==v)continue;var w=-p/v;0<w&&w<1&&s[a].push(f(w))}}u=c}else s[0].push(l.x),s[1].push(l.y)}var B=Math.min.apply(null,s[0]),y=Math.max.apply(null,s[0])-B,A=Math.min.apply(null,s[1]),S=Math.max.apply(null,s[1])-A;return{x:B,y:A,width:y,height:S}},svgedit.utilities.getBBox=function(t){var i=t||o.geSelectedElements()[0];if(1!=t.nodeType)return null;var r=null,n=i.nodeName;switch(n){case"text":""===i.textContent?(i.textContent="a",r=i.getBBox(),i.textContent=""):i.getBBox&&(r=i.getBBox());break;case"path":svgedit.browser.supportsPathBBox()?i.getBBox&&(r=i.getBBox()):r=svgedit.utilities.getPathBBox(i);break;case"g":case"a":r=e(i);break;default:if("use"===n&&(r=e(i,!0)),"use"===n||"foreignObject"===n&&svgedit.browser.isWebkit()){r||(r=i.getBBox());var u={};u.width=r.width,u.height=r.height,u.x=r.x+parseFloat(i.getAttribute("x")||0),u.y=r.y+parseFloat(i.getAttribute("y")||0),r=u}else if(~s.indexOf(n))if(i)r=i.getBBox();else{var l=$(i).closest("foreignObject");l.length&&l[0].getBBox&&(r=l[0].getBBox())}}return r&&(r=svgedit.utilities.bboxToObj(r)),r},svgedit.utilities.getRotationAngle=function(t,e){var i=t||o.getSelectedElements()[0],r=svgedit.transformlist.getTransformList(i);if(!r)return 0;var n,s=r.numberOfItems;for(n=0;n<s;++n){var u=r.getItem(n);if(4==u.type)return e?u.angle*Math.PI/180:u.angle}return 0},svgedit.utilities.getRefElem=function(t){return svgedit.utilities.getElem(svgedit.utilities.getUrlFromAttr(t).substr(1))},svgedit.browser.supportsSelectors()?svgedit.utilities.getElem=function(t){return a.querySelector("#"+t)}:svgedit.browser.supportsXpath()?svgedit.utilities.getElem=function(t){return u.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+t+'"]',l,function(){return svgedit.NS.SVG},9,null).singleNodeValue}:svgedit.utilities.getElem=function(t){return $(a).find("[id="+t+"]")[0]},svgedit.utilities.assignAttributes=function(t,e,i,n){var s;for(s in e){var o="xml:"===s.substr(0,4)?r.XML:"xlink:"===s.substr(0,6)?r.XLINK:null;o?t.setAttributeNS(o,s,e[s]):n?svgedit.units.setUnitAttr(t,s,e[s]):t.setAttribute(s,e[s])}},svgedit.utilities.cleanupElement=function(t){var e,i={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};for(e in i){var r=i[e];t.getAttribute(e)==r&&t.removeAttribute(e)}},svgedit.utilities.snapToGrid=function(t){var e=o.getSnappingStep(),i=o.getBaseUnit();return"px"!==i&&(e*=svgedit.units.getTypeMap()[i]),t=Math.round(t/e)*e},svgedit.utilities.preg_quote=function(t,e){return String(t).replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(e||"")+"-]","g"),"\\$&")},svgedit.utilities.executeAfterLoads=function(t,e,i){return function(){function r(){i.apply(null,n)}var n=arguments;window[t]?r():e.reduceRight(function(t,e){return function(){$.getScript(e,t)}},r)()}},svgedit.utilities.buildCanvgCallback=function(t){return svgedit.utilities.executeAfterLoads("canvg",["canvg/rgbcolor.js","canvg/canvg.js"],t)},svgedit.utilities.buildJSPDFCallback=function(e){return svgedit.utilities.executeAfterLoads("RGBColor",["canvg/rgbcolor.js"],function(){var i=[];RGBColor&&RGBColor.ok!==t||i.push("canvg/rgbcolor.js"),svgedit.utilities.executeAfterLoads("jsPDF",i.concat("jspdf/underscore-min.js","jspdf/jspdf.min.js","jspdf/jspdf.plugin.svgToPdf.js"),e)()})}}}}(mysvgutils||{});
(function(){"use strict";svgedit.sanitize||(svgedit.sanitize={});var e=svgedit.NS,t=svgedit.getReverseNS(),i={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["type","class","clip-path","clip-rule","id","display","fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id","class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id","r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class","clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],switch:["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures","spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],input:["class","id","type","style","value"],INPUT:["class","id","type","style","value"],select:["class","id","type","style"],SELECT:["class","id","type","style"],option:["value","text"],OPTION:["value","text"],button:["class","color","style","id"],BUTTON:["class","color","style","id"],span:["class","color","style","id"],SPAN:["class","color","style","id"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing","width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},s={};$.each(i,function(t,i){var r={};$.each(i,function(t,i){if(i.indexOf(":")>=0){var s=i.split(":");r[s[1]]=e[s[0].toUpperCase()]}else r[i]="xmlns"==i?e.XMLNS:null}),s[t]=r}),svgedit.sanitize.sanitizeSvg=function(r){if(3==r.nodeType&&(r.nodeValue=r.nodeValue.replace(/^\s+|\s+$/g,""),0===r.nodeValue.length&&r.parentNode.removeChild(r)),1==r.nodeType){var a=r.ownerDocument,l=r.parentNode;if(a&&l){var o,n=i[r.nodeName],d=s[r.nodeName];if("undefined"!=typeof n){if("foreignObject"===l.nodeName||l.parentNode&&"foreignObject"===l.parentNode.nodeName){for(var c=document.createElement(r.tagName),o=r.attributes.length;o--;){var m=r.attributes.item(o);c.setAttribute(m.nodeName,m.value)}c.innerHTML=r.innerHTML,l.removeChild(r),l.appendChild(c),r=c}var f=[];for(o=r.attributes.length;o--;){var m=r.attributes.item(o),p=m.nodeName,u=m.localName,k=m.namespaceURI;if(d.hasOwnProperty(u)&&k==d[u]&&k!=e.XMLNS||k==e.XMLNS&&t[m.value]||(0===p.indexOf("se:")&&f.push([p,m.value]),r.removeAttributeNS(k,u)),svgedit.browser.isGecko())switch(p){case"transform":case"gradientTransform":case"patternTransform":var y=m.value.replace(/(\d)-/g,"$1 -");r.setAttribute(p,y)}if("style"==p&&"foreignObject"!==l.nodeName){for(var h=m.value.split(";"),g=h.length;g--;){var v=h[g].split(":"),x=$.trim(v[0]),w=$.trim(v[1]);n.indexOf(x)>=0&&r.setAttribute(x,w)}r.removeAttribute("style")}}$.each(f,function(t,i){r.setAttributeNS(e.SE,i[0],i[1])});var N=svgedit.utilities.getHref(r);if(N&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(r.nodeName)>=0&&"#"!=N[0]&&(svgedit.utilities.setHref(r,""),r.removeAttributeNS(e.XLINK,"href")),"use"==r.nodeName&&!svgedit.utilities.getHref(r))return void l.removeChild(r);for($.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(e,t){var i=r.getAttribute(t);i&&(i=svgedit.utilities.getUrlFromAttr(i),i&&"#"!==i[0]&&(r.setAttribute(t,""),r.removeAttribute(t)))}),o=r.childNodes.length;o--;)svgedit.sanitize.sanitizeSvg(r.childNodes.item(o))}else{for(var L=[];r.hasChildNodes();)L.push(l.insertBefore(r.firstChild,r));for(l.removeChild(r),o=L.length;o--;)svgedit.sanitize.sanitizeSvg(L[o])}}}}})();
(function(){"use strict";svgedit.history||(svgedit.history={}),svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(t,e,i,n){this.elem=t,this.text=n?"Move "+t.tagName+" to "+n:"Move "+t.tagName,this.oldNextSibling=e,this.oldParent=i,this.newNextSibling=t.nextSibling,this.newParent=t.parentNode},svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"},svgedit.history.MoveElementCommand.prototype.type=svgedit.history.MoveElementCommand.type,svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text},svgedit.history.MoveElementCommand.prototype.apply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling),t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.MoveElementCommand.prototype.unapply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling),t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.InsertElementCommand=function(t,e){this.elem=t,this.text=e||"Create "+t.tagName,this.parent=t.parentNode,this.nextSibling=this.elem.nextSibling},svgedit.history.InsertElementCommand.type=function(){return"svgedit.history.InsertElementCommand"},svgedit.history.InsertElementCommand.prototype.type=svgedit.history.InsertElementCommand.type,svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text},svgedit.history.InsertElementCommand.prototype.apply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),this.elem=this.parent.insertBefore(this.elem,this.nextSibling),t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.InsertElementCommand.prototype.unapply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),this.parent=this.elem.parentNode,this.elem=this.elem.parentNode.removeChild(this.elem),t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.RemoveElementCommand=function(t,e,i,n){this.elem=t,this.text=n||"Delete "+t.tagName,this.nextSibling=e,this.parent=i,svgedit.transformlist.removeElementFromListMap(t)},svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"},svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type,svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text},svgedit.history.RemoveElementCommand.prototype.apply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this),svgedit.transformlist.removeElementFromListMap(this.elem),this.parent=this.elem.parentNode,this.elem=this.parent.removeChild(this.elem),t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.RemoveElementCommand.prototype.unapply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this),svgedit.transformlist.removeElementFromListMap(this.elem),null==this.nextSibling&&window.console&&console.log("Error: reference element was lost"),this.parent.insertBefore(this.elem,this.nextSibling),t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.ChangeElementCommand=function(t,e,i){this.elem=t,this.text=i?"Change "+t.tagName+" "+i:"Change "+t.tagName,this.newValues={},this.oldValues=e;var n;for(n in e)"#text"==n?this.newValues[n]=t.textContent:"#href"==n?this.newValues[n]=svgedit.utilities.getHref(t):this.newValues[n]=t.getAttribute(n)},svgedit.history.ChangeElementCommand.type=function(){return"svgedit.history.ChangeElementCommand"},svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type,svgedit.history.ChangeElementCommand.prototype.getText=function(){return this.text},svgedit.history.ChangeElementCommand.prototype.apply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var e,i=!1;for(e in this.newValues)this.newValues[e]?"#text"==e?this.elem.textContent=this.newValues[e]:"#href"==e?svgedit.utilities.setHref(this.elem,this.newValues[e]):this.elem.setAttribute(e,this.newValues[e]):"#text"==e?this.elem.textContent="":(this.elem.setAttribute(e,""),this.elem.removeAttribute(e)),"transform"==e&&(i=!0);if(!i){var n=svgedit.utilities.getRotationAngle(this.elem);if(n){var s=elem.getBBox(),o=s.x+s.width/2,r=s.y+s.height/2,h=["rotate(",n," ",o,",",r,")"].join("");h!=elem.getAttribute("transform")&&elem.setAttribute("transform",h)}}return t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this),!0},svgedit.history.ChangeElementCommand.prototype.unapply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var e,i=!1;for(e in this.oldValues)this.oldValues[e]?"#text"==e?this.elem.textContent=this.oldValues[e]:"#href"==e?svgedit.utilities.setHref(this.elem,this.oldValues[e]):this.elem.setAttribute(e,this.oldValues[e]):"#text"==e?this.elem.textContent="":this.elem.removeAttribute(e),"transform"==e&&(i=!0);if(!i){var n=svgedit.utilities.getRotationAngle(this.elem);if(n){var s=elem.getBBox(),o=s.x+s.width/2,r=s.y+s.height/2,h=["rotate(",n," ",o,",",r,")"].join("");h!=elem.getAttribute("transform")&&elem.setAttribute("transform",h)}}return svgedit.transformlist.removeElementFromListMap(this.elem),t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this),!0},svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]},svgedit.history.BatchCommand=function(t){this.text=t||"Batch Command",this.stack=[]},svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"},svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type,svgedit.history.BatchCommand.prototype.getText=function(){return this.text},svgedit.history.BatchCommand.prototype.apply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var e,i=this.stack.length;for(e=0;e<i;++e)this.stack[e].apply(t);t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)},svgedit.history.BatchCommand.prototype.unapply=function(t){t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var e;for(e=this.stack.length-1;e>=0;e--)this.stack[e].unapply(t);t&&t.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)},svgedit.history.BatchCommand.prototype.elements=function(){for(var t=[],e=this.stack.length;e--;)for(var i=this.stack[e].elements(),n=i.length;n--;)t.indexOf(i[n])==-1&&t.push(i[n]);return t},svgedit.history.BatchCommand.prototype.addSubCommand=function(t){this.stack.push(t)},svgedit.history.BatchCommand.prototype.isEmpty=function(){return 0===this.stack.length},svgedit.history.UndoManager=function(t){this.handler_=t||null,this.undoStackPointer=0,this.undoStack=[],this.undoChangeStackPointer=-1,this.undoableChangeStack=[]},svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[],this.undoStackPointer=0},svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer},svgedit.history.UndoManager.prototype.getRedoStackSize=function(){return this.undoStack.length-this.undoStackPointer},svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""},svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""},svgedit.history.UndoManager.prototype.undo=function(){if(this.undoStackPointer>0){var t=this.undoStack[--this.undoStackPointer];t.unapply(this.handler_)}},svgedit.history.UndoManager.prototype.redo=function(){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0){var t=this.undoStack[this.undoStackPointer++];t.apply(this.handler_)}},svgedit.history.UndoManager.prototype.addCommandToHistory=function(t){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&(this.undoStack=this.undoStack.splice(0,this.undoStackPointer)),this.undoStack.push(t),this.undoStackPointer=this.undoStack.length},svgedit.history.UndoManager.prototype.beginUndoableChange=function(t,e){for(var i=++this.undoChangeStackPointer,n=e.length,s=new Array(n),o=new Array(n);n--;){var r=e[n];null!=r&&(o[n]=r,s[n]=r.getAttribute(t))}this.undoableChangeStack[i]={attrName:t,oldValues:s,elements:o}},svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var t=this.undoChangeStackPointer--,e=this.undoableChangeStack[t],i=e.elements.length,n=e.attrName,s=new svgedit.history.BatchCommand("Change "+n);i--;){var o=e.elements[i];if(null!=o){var r={};r[n]=e.oldValues[i],r[n]!=o.getAttribute(n)&&s.addSubCommand(new svgedit.history.ChangeElementCommand(o,r,n))}}return this.undoableChangeStack[t]=null,s}})();
var svgedit=svgedit||{};(function(){"use strict";svgedit.coords||(svgedit.coords={});var t=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],n=null;svgedit.coords.init=function(t){n=t};svgedit.coords.remapElement=function(i,r,u){for(var v,h=function(n,t){return svgedit.math.transformPoint(n,t,u)},p=function(n){return u.a*n},w=function(n){return u.d*n},kt=n.getGridSnapping()&&i.parentNode.parentNode.localName==="svg",tt=function(){var n;if(kt)for(n in r)r[n]=svgedit.utilities.snapToGrid(r[n]);svgedit.utilities.assignAttributes(i,r,1e3,!0)},it=svgedit.utilities.getBBox(i),rt,lt,o,at,vt,yt,pt,b,y,k,ft,et,d,s,a,g,c,ot,st,f,ht,ct,nt,wt,bt,l,e=0;e<2;e++)v=e===0?"fill":"stroke",rt=i.getAttribute(v),rt&&rt.indexOf("url(")===0&&(u.a<0||u.d<0)&&(lt=svgedit.utilities.getRefElem(rt),o=lt.cloneNode(!0),u.a<0&&(at=o.getAttribute("x1"),vt=o.getAttribute("x2"),o.setAttribute("x1",-(at-1)),o.setAttribute("x2",-(vt-1))),u.d<0&&(yt=o.getAttribute("y1"),pt=o.getAttribute("y2"),o.setAttribute("y1",-(yt-1)),o.setAttribute("y2",-(pt-1))),o.id=n.getDrawing().getNextId(),svgedit.utilities.findDefs().appendChild(o),i.setAttribute(v,"url(#"+o.id+")"));b=i.tagName;(b==="g"||b==="text"||b=="tspan"||b==="use")&&(u.a==1&&u.b==0&&u.c==0&&u.d==1&&(u.e!=0||u.f!=0)?(ft=svgedit.math.transformListToTransform(i).matrix,et=svgedit.math.matrixMultiply(ft.inverse(),u,ft),r.x=parseFloat(r.x)+et.e,r.y=parseFloat(r.y)+et.f):(y=svgedit.transformlist.getTransformList(i),k=svgroot.createSVGTransform(),k.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(y).matrix,u)),y.clear(),y.appendItem(k)));switch(b){case"foreignObject":case"rect":case"image":b==="image"&&(u.a<0||u.d<0)?(y=svgedit.transformlist.getTransformList(i),k=svgroot.createSVGTransform(),k.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(y).matrix,u)),y.clear(),y.appendItem(k)):(a=h(r.x,r.y),r.width=p(r.width),r.height=w(r.height),r.x=a.x+Math.min(0,r.width),r.y=a.y+Math.min(0,r.height),r.width=Math.abs(r.width),r.height=Math.abs(r.height));tt();break;case"ellipse":d=h(r.cx,r.cy);r.cx=d.x;r.cy=d.y;r.rx=p(r.rx);r.ry=w(r.ry);r.rx=Math.abs(r.rx);r.ry=Math.abs(r.ry);tt();break;case"circle":d=h(r.cx,r.cy);r.cx=d.x;r.cy=d.y;var ut=svgedit.math.transformBox(it.x,it.y,it.width,it.height,u),dt=ut.tr.x-ut.tl.x,gt=ut.bl.y-ut.tl.y;r.r=Math.min(dt/2,gt/2);r.r&&(r.r=Math.abs(r.r));tt();break;case"line":a=h(r.x1,r.y1);g=h(r.x2,r.y2);r.x1=a.x;r.y1=a.y;r.x2=g.x;r.y2=g.y;case"text":case"tspan":case"use":tt();break;case"g":ot=$(i).data("gsvg");ot&&svgedit.utilities.assignAttributes(ot,r,1e3,!0);break;case"polyline":case"polygon":for(c=r.points.length,e=0;e<c;++e)s=r.points[e],s=h(s.x,s.y),r.points[e].x=s.x,r.points[e].y=s.y;for(c=r.points.length,st="",e=0;e<c;++e)s=r.points[e],st+=s.x+","+s.y+" ";i.setAttribute("points",st);break;case"path":for(ht=i.pathSegList,c=ht.numberOfItems,r.d=[],e=0;e<c;++e)f=ht.getItem(e),r.d[e]={type:f.pathSegType,x:f.x,y:f.y,x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,r1:f.r1,r2:f.r2,angle:f.angle,largeArcFlag:f.largeArcFlag,sweepFlag:f.sweepFlag};for(c=r.d.length,ct=r.d[0],nt=h(ct.x,ct.y),r.d[0].x=nt.x,r.d[0].y=nt.y,e=1;e<c;++e)f=r.d[e],v=f.type,v%2==0?(wt=f.x!=undefined?f.x:nt.x,bt=f.y!=undefined?f.y:nt.y,s=h(wt,bt),a=h(f.x1,f.y1),g=h(f.x2,f.y2),f.x=s.x,f.y=s.y,f.x1=a.x,f.y1=a.y,f.x2=g.x,f.y2=g.y,f.r1=p(f.r1),f.r2=w(f.r2)):(f.x=p(f.x),f.y=w(f.y),f.x1=p(f.x1),f.y1=w(f.y1),f.x2=p(f.x2),f.y2=w(f.y2),f.r1=p(f.r1),f.r2=w(f.r2));for(l="",c=r.d.length,e=0;e<c;++e){f=r.d[e];v=f.type;l+=t[v];switch(v){case 13:case 12:l+=f.x+" ";break;case 15:case 14:l+=f.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:l+=f.x+","+f.y+" ";break;case 7:case 6:l+=f.x1+","+f.y1+" "+f.x2+","+f.y2+" "+f.x+","+f.y+" ";break;case 9:case 8:l+=f.x1+","+f.y1+" "+f.x+","+f.y+" ";break;case 11:case 10:l+=f.r1+","+f.r2+" "+f.angle+" "+ +f.largeArcFlag+" "+ +f.sweepFlag+" "+f.x+","+f.y+" ";break;case 17:case 16:l+=f.x2+","+f.y2+" "+f.x+","+f.y+" "}}i.setAttribute("d",l)}}})();
var svgedit=svgedit||{};(function(){svgedit.recalculate||(svgedit.recalculate={});var t,e=svgedit.NS;svgedit.recalculate.init=function(e){t=e},svgedit.recalculate.updateClipPath=function(e,r,a){var s=getRefElem(e).firstChild,i=svgedit.transformlist.getTransformList(s),m=t.getSVGRoot().createSVGTransform();m.setTranslate(r,a),i.appendItem(m),svgedit.recalculate.recalculateDimensions(s)},svgedit.recalculate.recalculateDimensions=function(r){if(null==r)return null;if("svg"==r.nodeName&&navigator.userAgent.indexOf("Firefox/20")>=0)return null;var a,s=t.getSVGRoot(),i=svgedit.transformlist.getTransformList(r);if(i&&i.numberOfItems>0){for(a=i.numberOfItems;a--;){var m=i.getItem(a);0===m.type?i.removeItem(a):1===m.type?svgedit.math.isIdentity(m.matrix)&&i.removeItem(a):4===m.type&&0===m.angle&&i.removeItem(a)}if(1===i.numberOfItems&&svgedit.utilities.getRotationAngle(r))return null}if(!i||0==i.numberOfItems)return r.setAttribute("transform",""),r.removeAttribute("transform"),null;if(i){a=i.numberOfItems;for(var n=[];a--;){var m=i.getItem(a);1===m.type?n.push([m.matrix,a]):n.length&&(n=[])}if(2===n.length){var o=s.createSVGTransformFromMatrix(svgedit.math.matrixMultiply(n[1][0],n[0][0]));i.removeItem(n[0][1]),i.removeItem(n[1][1]),i.insertItemBefore(o,n[1][1])}if(a=i.numberOfItems,a>=2&&1===i.getItem(a-2).type&&2===i.getItem(a-1).type){var f=s.createSVGTransform(),v=svgedit.math.matrixMultiply(i.getItem(a-2).matrix,i.getItem(a-1).matrix);f.setMatrix(v),i.removeItem(a-2),i.removeItem(a-2),i.appendItem(f)}}switch(r.tagName){case"line":case"polyline":case"polygon":case"path":break;default:if(1===i.numberOfItems&&1===i.getItem(0).type||2===i.numberOfItems&&1===i.getItem(0).type&&4===i.getItem(0).type)return null}var g=$(r).data("gsvg"),l=new svgedit.history.BatchCommand("Transform"),d={},u=null,c=[];switch(r.tagName){case"line":c=["x1","y1","x2","y2"];break;case"circle":c=["cx","cy","r"];break;case"ellipse":c=["cx","cy","rx","ry"];break;case"foreignObject":case"rect":case"image":c=["width","height","x","y"];break;case"use":case"text":case"tspan":c=["x","y"];break;case"polygon":case"polyline":u={},u.points=r.getAttribute("points");var p=r.points,I=p.numberOfItems;d.points=new Array(I);var x;for(x=0;x<I;++x){var h=p.getItem(x);d.points[x]={x:h.x,y:h.y}}break;case"path":u={},u.d=r.getAttribute("d"),d.d=r.getAttribute("d")}if(c.length?(d=$(r).attr(c),$.each(d,function(t,e){d[t]=svgedit.units.convertToNum(t,e)})):g&&(d={x:$(g).attr("x")||0,y:$(g).attr("y")||0}),null==u&&(u=$.extend(!0,{},d),$.each(u,function(t,e){u[t]=svgedit.units.convertToNum(t,e)})),u.transform=t.getStartTransform()||"","g"==r.tagName&&!g||"a"==r.tagName){var T=svgedit.utilities.getBBox(r),y={x:T.x+T.width/2,y:T.y+T.height/2},b=svgedit.math.transformPoint(T.x+T.width/2,T.y+T.height/2,svgedit.math.transformListToTransform(i).matrix),v=s.createSVGMatrix(),S=svgedit.utilities.getRotationAngle(r);if(S){var M=S*Math.PI/180;if(Math.abs(M)>1e-10)var O=Math.sin(M)/(1-Math.cos(M));else var O=2/M;var x;for(x=0;x<i.numberOfItems;++x){var m=i.getItem(x);if(4==m.type){var A=m.matrix;y.y=(O*A.e+A.f)/2,y.x=(A.e-O*A.f)/2,i.removeItem(x);break}}}var G=0,V=0,L=0,N=i.numberOfItems;if(N)var B=i.getItem(0).matrix;if(N>=3&&3==i.getItem(N-2).type&&2==i.getItem(N-3).type&&2==i.getItem(N-1).type){L=3;for(var R=i.getItem(N-3).matrix,w=i.getItem(N-2).matrix,k=i.getItem(N-1).matrix,C=r.childNodes,D=C.length;D--;){var E=C.item(D);if(G=0,V=0,1==E.nodeType){var P=svgedit.transformlist.getTransformList(E);if(!P)continue;var v=svgedit.math.transformListToTransform(P).matrix,j=svgedit.utilities.getRotationAngle(E),F=t.getStartTransform(),U=[];if(t.setStartTransform(E.getAttribute("transform")),j||svgedit.math.hasMatrixTransform(P)){var H=s.createSVGTransform();H.setMatrix(svgedit.math.matrixMultiply(R,w,k,v)),P.clear(),P.appendItem(H),U.push(H)}else{var W=svgedit.math.matrixMultiply(v.inverse(),k,v),q=s.createSVGMatrix();q.e=-W.e,q.f=-W.f;var z=svgedit.math.matrixMultiply(q.inverse(),v.inverse(),R,w,k,v,W.inverse()),J=s.createSVGTransform(),K=s.createSVGTransform(),Q=s.createSVGTransform();J.setTranslate(W.e,W.f),K.setScale(z.a,z.d),Q.setTranslate(q.e,q.f),P.appendItem(Q),P.appendItem(K),P.appendItem(J),U.push(Q),U.push(K),U.push(J)}l.addSubCommand(svgedit.recalculate.recalculateDimensions(E)),t.setStartTransform(F)}}i.removeItem(N-1),i.removeItem(N-2),i.removeItem(N-3)}else if(N>=3&&1==i.getItem(N-1).type){L=3,v=svgedit.math.transformListToTransform(i).matrix;var H=s.createSVGTransform();H.setMatrix(v),i.clear(),i.appendItem(H)}else if((1==N||N>1&&3!=i.getItem(1).type)&&2==i.getItem(0).type){L=2;var X=svgedit.math.transformListToTransform(i).matrix;i.removeItem(0);var Y=svgedit.math.transformListToTransform(i).matrix.inverse(),Z=svgedit.math.matrixMultiply(Y,X);if(G=Z.e,V=Z.f,0!=G||0!=V){for(var C=r.childNodes,D=C.length,_=[];D--;){var E=C.item(D);if(1==E.nodeType){if(E.getAttribute("clip-path")){var tt=E.getAttribute("clip-path");_.indexOf(tt)===-1&&(svgedit.recalculate.updateClipPath(tt,G,V),_.push(tt))}var F=t.getStartTransform();t.setStartTransform(E.getAttribute("transform"));var P=svgedit.transformlist.getTransformList(E);if(P){var et=s.createSVGTransform();et.setTranslate(G,V),P.numberOfItems?P.insertItemBefore(et,0):P.appendItem(et),l.addSubCommand(svgedit.recalculate.recalculateDimensions(E));for(var rt=r.getElementsByTagNameNS(e.SVG,"use"),at="#"+E.id,st=rt.length;st--;){var it=rt.item(st);if(at==svgedit.utilities.getHref(it)){var mt=s.createSVGTransform();mt.setTranslate(-G,-V),svgedit.transformlist.getTransformList(it).insertItemBefore(mt,0),l.addSubCommand(svgedit.recalculate.recalculateDimensions(it))}}t.setStartTransform(F)}}}_=[],t.setStartTransform(F)}}else{if(1!=N||1!=i.getItem(0).type||S){if(S){var nt=s.createSVGTransform();nt.setRotate(S,b.x,b.y),i.numberOfItems?i.insertItemBefore(nt,0):i.appendItem(nt)}return 0==i.numberOfItems&&r.removeAttribute("transform"),null}L=1;for(var v=i.getItem(0).matrix,C=r.childNodes,D=C.length;D--;){var E=C.item(D);if(1==E.nodeType){var F=t.getStartTransform();t.setStartTransform(E.getAttribute("transform"));var P=svgedit.transformlist.getTransformList(E);if(!P)continue;var ot=svgedit.math.matrixMultiply(v,svgedit.math.transformListToTransform(P).matrix),ft=s.createSVGTransform();ft.setMatrix(ot),P.clear(),P.appendItem(ft,0),l.addSubCommand(svgedit.recalculate.recalculateDimensions(E)),t.setStartTransform(F);var vt=E.getAttribute("stroke-width");if("none"!==E.getAttribute("stroke")&&!isNaN(vt)){var gt=(Math.abs(ot.a)+Math.abs(ot.d))/2;E.setAttribute("stroke-width",vt*gt)}}}i.clear()}if(2==L){if(S){b={x:y.x+B.e,y:y.y+B.f};var nt=s.createSVGTransform();nt.setRotate(S,b.x,b.y),i.numberOfItems?i.insertItemBefore(nt,0):i.appendItem(nt)}}else if(3==L){var v=svgedit.math.transformListToTransform(i).matrix,lt=s.createSVGTransform();lt.setRotate(S,y.x,y.y);var dt=lt.matrix,ut=s.createSVGTransform();ut.setRotate(S,b.x,b.y);var ct=ut.matrix.inverse(),pt=v.inverse(),It=svgedit.math.matrixMultiply(pt,ct,dt,v);if(G=It.e,V=It.f,0!=G||0!=V)for(var C=r.childNodes,D=C.length;D--;){var E=C.item(D);if(1==E.nodeType){var F=t.getStartTransform();t.setStartTransform(E.getAttribute("transform"));var P=svgedit.transformlist.getTransformList(E),et=s.createSVGTransform();et.setTranslate(G,V),P.numberOfItems?P.insertItemBefore(et,0):P.appendItem(et),l.addSubCommand(svgedit.recalculate.recalculateDimensions(E)),t.setStartTransform(F)}}S&&(i.numberOfItems?i.insertItemBefore(ut,0):i.appendItem(ut))}}else{var T=svgedit.utilities.getBBox(r);if(!T&&"path"!=r.tagName)return null;var v=s.createSVGMatrix(),j=svgedit.utilities.getRotationAngle(r);if(j){var y={x:T.x+T.width/2,y:T.y+T.height/2},b=svgedit.math.transformPoint(T.x+T.width/2,T.y+T.height/2,svgedit.math.transformListToTransform(i).matrix),M=j*Math.PI/180;if(Math.abs(M)>1e-10)var O=Math.sin(M)/(1-Math.cos(M));else var O=2/M;for(var x=0;x<i.numberOfItems;++x){var m=i.getItem(x);if(4==m.type){var A=m.matrix;y.y=(O*A.e+A.f)/2,y.x=(A.e-O*A.f)/2,i.removeItem(x);break}}}var L=0,N=i.numberOfItems;if(!svgedit.browser.isWebkit()){var xt=r.getAttribute("fill");if(xt&&0===xt.indexOf("url(")){var ht=getRefElem(xt),Tt="pattern";ht.tagName!==Tt&&(Tt="gradient");var yt=ht.getAttribute(Tt+"Units");if("userSpaceOnUse"===yt){v=svgedit.math.transformListToTransform(i).matrix;var bt=svgedit.transformlist.getTransformList(ht),St=svgedit.math.transformListToTransform(bt).matrix;v=svgedit.math.matrixMultiply(v,St);var Mt="matrix("+[v.a,v.b,v.c,v.d,v.e,v.f].join(",")+")";ht.setAttribute(Tt+"Transform",Mt)}}}if(N>=3&&3==i.getItem(N-2).type&&2==i.getItem(N-3).type&&2==i.getItem(N-1).type)L=3,v=svgedit.math.transformListToTransform(i,N-3,N-1).matrix,i.removeItem(N-1),i.removeItem(N-2),i.removeItem(N-3);else if(4==N&&1==i.getItem(N-1).type){L=3,v=svgedit.math.transformListToTransform(i).matrix;var H=s.createSVGTransform();H.setMatrix(v),i.clear(),i.appendItem(H),v=s.createSVGMatrix()}else if((1==N||N>1&&3!=i.getItem(1).type)&&2==i.getItem(0).type){L=2;var Ot=i.getItem(0).matrix,At=svgedit.math.transformListToTransform(i,1).matrix,Gt=At.inverse();v=svgedit.math.matrixMultiply(Gt,Ot,At),i.removeItem(0)}else{if(1!=N||1!=i.getItem(0).type||j){if(L=4,j){var nt=s.createSVGTransform();nt.setRotate(j,b.x,b.y),i.numberOfItems?i.insertItemBefore(nt,0):i.appendItem(nt)}return 0==i.numberOfItems&&r.removeAttribute("transform"),null}switch(v=svgedit.math.transformListToTransform(i).matrix,r.tagName){case"line":d=$(r).attr(["x1","y1","x2","y2"]);case"polyline":case"polygon":if(d.points=r.getAttribute("points"),d.points){var p=r.points,I=p.numberOfItems;d.points=new Array(I);for(var x=0;x<I;++x){var h=p.getItem(x);d.points[x]={x:h.x,y:h.y}}}case"path":d.d=r.getAttribute("d"),L=1,i.clear()}}if(1!=L&&2!=L&&3!=L||svgedit.coords.remapElement(r,d,v),2==L){if(j){svgedit.math.hasMatrixTransform(i)||(b={x:y.x+v.e,y:y.y+v.f});var nt=s.createSVGTransform();nt.setRotate(j,b.x,b.y),i.numberOfItems?i.insertItemBefore(nt,0):i.appendItem(nt)}if("text"==r.tagName)for(var C=r.childNodes,D=C.length;D--;){var E=C.item(D);if("tspan"==E.tagName){var Vt={x:$(E).attr("x")||0,y:$(E).attr("y")||0};svgedit.coords.remapElement(E,Vt,v)}}}else if(3==L&&j){var v=svgedit.math.transformListToTransform(i).matrix,lt=s.createSVGTransform();lt.setRotate(j,y.x,y.y);var dt=lt.matrix,ut=s.createSVGTransform();ut.setRotate(j,b.x,b.y);var ct=ut.matrix.inverse(),pt=v.inverse(),It=svgedit.math.matrixMultiply(pt,ct,dt,v);svgedit.coords.remapElement(r,d,It),j&&(i.numberOfItems?i.insertItemBefore(ut,0):i.appendItem(ut))}}return 0==i.numberOfItems&&r.removeAttribute("transform"),l.addSubCommand(new svgedit.history.ChangeElementCommand(r,u)),l}})();
var myselect=function(){"use strict";return{initSelect:function(){svgedit.select||(svgedit.select={});var e,t,r,s=svgedit.browser.isTouch()?10:4;svgedit.select.Selector=function(t,r){this.id=t,this.selectedElement=r,this.locked=!0,this.selectorGroup=e.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}}),this.selectorRect=this.selectorGroup.appendChild(e.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#BFBFBF","stroke-width":"1",style:"pointer-events:none"}})),this.gripCoords={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.reset(this.selectedElement)},svgedit.select.Selector.prototype.reset=function(e){this.locked=!0,this.selectedElement=e,this.resize(),this.selectorGroup.setAttribute("display","inline")},svgedit.select.Selector.prototype.updateGripCursors=function(e){var t,s=[],i=Math.round(e/45);i<0&&(i+=8);for(t in r.selectorGrips)s.push(t);for(;i>0;)s.push(s.shift()),i--;var o=0;for(t in r.selectorGrips)r.selectorGrips[t].setAttribute("style","cursor:"+s[o]+"-resize"),o++},svgedit.select.Selector.prototype.showGrips=function(e){var t=e?"inline":"none";r.selectorGripsGroup.setAttribute("display",t);var s=this.selectedElement;this.hasGrips=e,s&&e&&(this.selectorGroup.appendChild(r.selectorGripsGroup),this.updateGripCursors(svgedit.utilities.getRotationAngle(s)))},svgedit.select.Selector.prototype.resize=function(){var t=this.selectorRect,i=r,o=i.selectorGrips,l=this.selectedElement,n=l.getAttribute("stroke-width"),a=e.currentZoom(),c=1/a;"none"===l.getAttribute("stroke")||isNaN(n)||(c+=n/2);var h=l.tagName;"text"===h&&(c+=2/a);var d=svgedit.transformlist.getTransformList(l),p=svgedit.math.transformListToTransform(d).matrix;p.e*=a,p.f*=a;var u=svgedit.utilities.getBBox(l);if("g"===h&&!$.data(l,"gsvg")){var g=e.getStrokedBBox(l.childNodes);g&&(u=g)}var G=u.x,v=u.y,m=u.width,b=u.height;u={x:G,y:v,width:m,height:b},c*=a;var f=svgedit.math.transformBox(G*a,v*a,m*a,b*a,p),y=f.aabox,x=y.x-c,B=y.y-c,w=y.width+2*c,S=y.height+2*c,k=x+w/2,C=B+S/2,M=svgedit.utilities.getRotationAngle(l);if(M){var A=e.svgRoot().createSVGTransform();A.setRotate(-M,k,C);var F=A.matrix;f.tl=svgedit.math.transformPoint(f.tl.x,f.tl.y,F),f.tr=svgedit.math.transformPoint(f.tr.x,f.tr.y,F),f.bl=svgedit.math.transformPoint(f.bl.x,f.bl.y,F),f.br=svgedit.math.transformPoint(f.br.x,f.br.y,F);var E=f.tl,P=E.x,R=E.y,V=E.x,N=E.y,z=Math.min,T=Math.max;P=z(P,z(f.tr.x,z(f.bl.x,f.br.x)))-c,R=z(R,z(f.tr.y,z(f.bl.y,f.br.y)))-c,V=T(V,T(f.tr.x,T(f.bl.x,f.br.x)))+c,N=T(N,T(f.tr.y,T(f.bl.y,f.br.y)))+c,x=P,B=R,w=V-P,S=N-R}var _=e.svgRoot().suspendRedraw(100),L="M"+x+","+B+" L"+(x+w)+","+B+" "+(x+w)+","+(B+S)+" "+x+","+(B+S)+"z";t.setAttribute("d",L);var j=M?"rotate("+[M,k,C].join(",")+")":"";this.selectorGroup.setAttribute("transform",j),this.gripCoords={nw:[x,B],ne:[x+w,B],sw:[x,B+S],se:[x+w,B+S],n:[x+w/2,B],w:[x,B+S/2],e:[x+w,B+S/2],s:[x+w/2,B+S]};var W;for(W in this.gripCoords){var q=this.gripCoords[W];o[W].setAttribute("x",q[0]-3),o[W].setAttribute("y",q[1]-3)}i.rotateGripConnector.setAttribute("x1",x+w/2),i.rotateGripConnector.setAttribute("y1",B),i.rotateGripConnector.setAttribute("x2",x+w/2),i.rotateGripConnector.setAttribute("y2",B-5*s),i.rotateGrip.setAttribute("cx",x+w/2),i.rotateGrip.setAttribute("cy",B-5*s),e.svgRoot().unsuspendRedraw(_)},svgedit.select.SelectorManager=function(){this.selectorParentGroup=null,this.rubberBandBox=null,this.selectors=[],this.selectorMap={},this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null},this.selectorGripsGroup=null,this.rotateGripConnector=null,this.rotateGrip=null,this.initGroup()},svgedit.select.SelectorManager.prototype.initGroup=function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup),this.selectorParentGroup=e.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}}),this.selectorGripsGroup=e.createSVGElement({element:"g",attr:{display:"none"}}),this.selectorParentGroup.appendChild(this.selectorGripsGroup),e.svgRoot().appendChild(this.selectorParentGroup),this.selectorMap={},this.selectors=[],this.rubberBandBox=null;var r;for(r in this.selectorGrips){var i=e.createSVGElement({element:"rect",attr:{id:"selectorGrip_resize_"+r,width:6,height:6,"stroke-width":1,stroke:"#BFBFBF",fill:"#FFF",style:"cursor:"+r+"-resize","pointer-events":"all"}});$.data(i,"dir",r),$.data(i,"type","resize"),this.selectorGrips[r]=this.selectorGripsGroup.appendChild(i)}if(this.rotateGripConnector=this.selectorGripsGroup.appendChild(e.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#BFBFBF","stroke-width":"1"}})),this.rotateGrip=this.selectorGripsGroup.appendChild(e.createSVGElement({element:"circle",attr:{id:"selectorGrip_rotate",fill:"lime",r:s,stroke:"#BFBFBF","stroke-width":1}})),$.data(this.rotateGrip,"type","rotate"),!$("#canvasBackground").length){var o=t.dimensions,l=e.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:o[0],height:o[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}}),n=e.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});l.appendChild(n),e.svgRoot().insertBefore(l,e.svgContent())}},svgedit.select.SelectorManager.prototype.requestSelector=function(e){if(null==e)return null;var t,r=this.selectors.length;if("object"==typeof this.selectorMap[e.id])return this.selectorMap[e.id].locked=!0,this.selectorMap[e.id];for(t=0;t<r;++t)if(this.selectors[t]&&!this.selectors[t].locked)return this.selectors[t].locked=!0,this.selectors[t].reset(e),this.selectorMap[e.id]=this.selectors[t],this.selectors[t];return this.selectors[r]=new svgedit.select.Selector(r,e),this.selectorParentGroup.appendChild(this.selectors[r].selectorGroup),this.selectorMap[e.id]=this.selectors[r],this.selectors[r]},svgedit.select.SelectorManager.prototype.releaseSelector=function(e){if(null!=e){var t,r=this.selectors.length,s=this.selectorMap[e.id];for(t=0;t<r;++t)if(this.selectors[t]&&this.selectors[t]==s){0==s.locked&&console.log("WARNING! selector was released but was already unlocked"),delete this.selectorMap[e.id],s.locked=!1,s.selectedElement=null,s.showGrips(!1);try{s.selectorGroup.setAttribute("display","none")}catch(e){}break}}},svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){return this.rubberBandBox||(this.rubberBandBox=this.selectorParentGroup.appendChild(e.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":.15,stroke:"#22C","stroke-width":.5,display:"none",style:"pointer-events:none"}}))),this.rubberBandBox},svgedit.select.init=function(s,i){t=s,e=i,r=new svgedit.select.SelectorManager},svgedit.select.getSelectorManager=function(){return r}}}}(myselect||{});
var mydraw=function(){"use strict";return{initDraw:function(){svgedit.draw||(svgedit.draw={});var e=svgedit.NS,t="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),r={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},i=r.LET_DOCUMENT_DECIDE;svgedit.draw.Layer=function(e,t){this.name_=e,this.group_=t},svgedit.draw.Layer.prototype.getName=function(){return this.name_},svgedit.draw.Layer.prototype.getGroup=function(){return this.group_},svgedit.draw.randomizeIds=function(e,t){i=e===!1?r.NEVER_RANDOMIZE:r.ALWAYS_RANDOMIZE,i!=r.ALWAYS_RANDOMIZE||t.getNonce()?i==r.NEVER_RANDOMIZE&&t.getNonce()&&t.clearNonce():t.setNonce(Math.floor(100001*Math.random()))},svgedit.draw.Drawing=function(t,n){if(!t||!t.tagName||!t.namespaceURI||"svg"!=t.tagName||t.namespaceURI!=e.SVG)throw"Error: draw.Drawing instance initialized without a <svg> element";this.svgElem_=t,this.obj_num=0,this.idPrefix=n||"svg_",this.releasedNums=[],this.all_layers=[],this.current_layer=null,this.nonce_="";var a=this.svgElem_.getAttributeNS(e.SE,"nonce");a&&i!=r.NEVER_RANDOMIZE?this.nonce_=a:i==r.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(100001*Math.random()))},svgedit.draw.Drawing.prototype.getElem_=function(e){return this.svgElem_.querySelector?this.svgElem_.querySelector("#"+e):$(this.svgElem_).find("[id="+e+"]")[0]},svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_},svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_},svgedit.draw.Drawing.prototype.setNonce=function(t){this.svgElem_.setAttributeNS(e.XMLNS,"xmlns:se",e.SE),this.svgElem_.setAttributeNS(e.SE,"se:nonce",t),this.nonce_=t},svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""},svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num},svgedit.draw.Drawing.prototype.getNextId=function(){var e,t,r="";for(e=0;e<32;e++)t=16*Math.random()|0,8!=e&&12!=e&&16!=e&&20!=e||(r+="-"),r+=(12==e?4:16==e?3&t|8:t).toString(16);this.obj_num=r;var i=this.getId();return i},svgedit.draw.Drawing.prototype.releaseId=function(e){var t=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if("string"!=typeof e||0!==e.indexOf(t))return!1;var r=parseInt(e.substr(t.length),10);return!("number"!=typeof r||r<=0||this.releasedNums.indexOf(r)!=-1)&&(this.releasedNums.push(r),!0)},svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length},svgedit.draw.Drawing.prototype.hasLayer=function(e){var t;for(t=0;t<this.getNumLayers();t++)if(this.all_layers[t][0]==e)return!0;return!1},svgedit.draw.Drawing.prototype.getLayerName=function(e){return e>=0&&e<this.getNumLayers()?this.all_layers[e][0]:""},svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer},svgedit.draw.Drawing.prototype.getCurrentLayerName=function(){var e;for(e=0;e<this.getNumLayers();++e)if(this.all_layers[e][1]==this.current_layer)return this.getLayerName(e);return""},svgedit.draw.Drawing.prototype.setCurrentLayer=function(e){var t;for(t=0;t<this.getNumLayers();++t)if(e==this.getLayerName(t))return this.current_layer!=this.all_layers[t][1]&&(this.current_layer.setAttribute("style","pointer-events:none"),this.current_layer=this.all_layers[t][1],this.current_layer.setAttribute("style","pointer-events:all")),!0;return!1},svgedit.draw.Drawing.prototype.deleteCurrentLayer=function(){if(this.current_layer&&this.getNumLayers()>1){var e=this.current_layer.parentNode,t=(this.current_layer.nextSibling,e.removeChild(this.current_layer));return this.identifyLayers(),t}return null},svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];var r,i=this.svgElem_.childNodes.length,n=[],a=[],s=null,o=!1;for(r=0;r<i;++r){var l=this.svgElem_.childNodes.item(r);if(l&&1==l.nodeType)if("g"==l.tagName){o=!0;var u=$("title",l).text();!u&&svgedit.browser.isOpera()&&l.querySelectorAll&&(u=$(l.querySelectorAll("title")).text()),u?(a.push(u),this.all_layers.push([u,l]),s=l,svgedit.utilities.walkTree(l,function(e){e.parentNode&&"foreignObject"===e.parentNode.nodeName||e.setAttribute("style","pointer-events:inherit")}),s.setAttribute("style","pointer-events:none")):n.push(l)}else if(~t.indexOf(l.nodeName)){svgedit.utilities.getBBox(l);n.push(l)}}var g=this.svgElem_.ownerDocument;if(n.length>0||!o){for(r=1;a.indexOf("Layer "+r)>=0;)r++;var d="Layer "+r;s=g.createElementNS(e.SVG,"g");var y=g.createElementNS(e.SVG,"title");y.textContent=d,s.appendChild(y);var h;for(h=0;h<n.length;++h)s.appendChild(n[h]);this.svgElem_.appendChild(s),this.all_layers.push([d,s])}svgedit.utilities.walkTree(s,function(e){e.parentNode&&"foreignObject"===e.parentNode.nodeName||e.setAttribute("style","pointer-events:inherit")}),this.current_layer=s,this.current_layer.setAttribute("style","pointer-events:all")},svgedit.draw.Drawing.prototype.createLayer=function(t){var r=this.svgElem_.ownerDocument,i=r.createElementNS(e.SVG,"g"),n=r.createElementNS(e.SVG,"title");return n.textContent=t,i.appendChild(n),this.svgElem_.appendChild(i),this.identifyLayers(),i},svgedit.draw.Drawing.prototype.getLayerVisibility=function(e){var t,r=null;for(t=0;t<this.getNumLayers();++t)if(this.getLayerName(t)==e){r=this.all_layers[t][1];break}return!!r&&"none"!==r.getAttribute("display")},svgedit.draw.Drawing.prototype.setLayerVisibility=function(e,t){if("boolean"!=typeof t)return null;var r,i=null;for(r=0;r<this.getNumLayers();++r)if(this.getLayerName(r)==e){i=this.all_layers[r][1];break}if(!i)return null;var n=i.getAttribute("display");return n||(n="inline"),i.setAttribute("display",t?"inline":"none"),i},svgedit.draw.Drawing.prototype.getLayerOpacity=function(e){var t;for(t=0;t<this.getNumLayers();++t)if(this.getLayerName(t)==e){var r=this.all_layers[t][1],i=r.getAttribute("opacity");return i||(i="1.0"),parseFloat(i)}return null},svgedit.draw.Drawing.prototype.setLayerOpacity=function(e,t){if(!("number"!=typeof t||t<0||t>1)){var r;for(r=0;r<this.getNumLayers();++r)if(this.getLayerName(r)==e){var i=this.all_layers[r][1];i.setAttribute("opacity",t);break}}}}}}(mydraw||{});
(function(){"use strict";var n,t,i,e,o,r,h;svgedit.path||(svgedit.path={});var u=svgedit.NS,l={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},a={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},s=[],c=!0,f={};svgedit.path.setLinkControlPoints=function(n){c=n};svgedit.path.path=null;n=null;svgedit.path.init=function(t){n=t;s=[0,"ClosePath"];$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(n,t){s.push(t+"Abs");s.push(t+"Rel")})};svgedit.path.insertItemBefore=function(n,t,i){var u=n.pathSegList,f,e,r,o;if(svgedit.browser.supportsPathInsertItemBefore()){u.insertItemBefore(t,i);return}for(f=u.numberOfItems,e=[],r=0;r<f;r++)o=u.getItem(r),e.push(o);for(u.clear(),r=0;r<f;r++)r==i&&u.appendItem(t),u.appendItem(e[r])};svgedit.path.ptObjToArr=function(n,t){for(var r=a[n],f=r.length,u=[],i=0;i<f;i++)u[i]=t[r[i]];return u};svgedit.path.getGripPt=function(t,i){var r={x:i?i.x:t.item.x,y:i?i.y:t.item.y},u=t.path,f;return u.matrix&&(f=svgedit.math.transformPoint(r.x,r.y,u.matrix),r=f),r.x*=n.getCurrentZoom(),r.y*=n.getCurrentZoom(),r};svgedit.path.getPointFromGrip=function(t,i){var r={x:t.x,y:t.y};return i.matrix&&(t=svgedit.math.transformPoint(r.x,r.y,i.imatrix),r.x=t.x,r.y=t.y),r.x/=n.getCurrentZoom(),r.y/=n.getCurrentZoom(),r};svgedit.path.addPointGrip=function(n,t,i){var e=svgedit.path.getGripContainer(),r=svgedit.utilities.getElem("pathpointgrip_"+n),f;return r||(r=document.createElementNS(u.SVG,"circle"),svgedit.utilities.assignAttributes(r,{id:"pathpointgrip_"+n,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":l.pathNodeTooltip}),r=e.appendChild(r),f=$("#pathpointgrip_"+n),f.dblclick(function(){svgedit.path.path&&svgedit.path.path.setSegType()})),t&&i&&svgedit.utilities.assignAttributes(r,{cx:t,cy:i,display:"inline"}),r};svgedit.path.getGripContainer=function(){var n=svgedit.utilities.getElem("pathpointgrip_container"),t;return n||(t=svgedit.utilities.getElem("selectorParentGroup"),n=t.appendChild(document.createElementNS(u.SVG,"g")),n.id="pathpointgrip_container"),n};svgedit.path.addCtrlGrip=function(n){var t=svgedit.utilities.getElem("ctrlpointgrip_"+n);return t?t:(t=document.createElementNS(u.SVG,"circle"),svgedit.utilities.assignAttributes(t,{id:"ctrlpointgrip_"+n,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":l.pathCtrlPtTooltip}),svgedit.path.getGripContainer().appendChild(t),t)};svgedit.path.getCtrlLine=function(n){var t=svgedit.utilities.getElem("ctrlLine_"+n);return t?t:(t=document.createElementNS(u.SVG,"line"),svgedit.utilities.assignAttributes(t,{id:"ctrlLine_"+n,stroke:"#555","stroke-width":1,style:"pointer-events:none"}),svgedit.path.getGripContainer().appendChild(t),t)};svgedit.path.getPointGrip=function(n,t){var u=n.index,r=svgedit.path.addPointGrip(u),i;return t&&(i=svgedit.path.getGripPt(n),svgedit.utilities.assignAttributes(r,{cx:i.x,cy:i.y,display:"inline"})),r};svgedit.path.getControlPoints=function(n){var i=n.item,e=n.index,f;if(!("x1"in i)||!("x2"in i))return null;for(var r={},a=svgedit.path.getGripContainer(),l=svgedit.path.path.segs[e-1].item,o=[l,i],t=1;t<3;t++){var s=e+"c"+t,h=r["c"+t+"_line"]=svgedit.path.getCtrlLine(s),u=svgedit.path.getGripPt(n,{x:i["x"+t],y:i["y"+t]}),c=svgedit.path.getGripPt(n,{x:o[t-1].x,y:o[t-1].y});svgedit.utilities.assignAttributes(h,{x1:u.x,y1:u.y,x2:c.x,y2:c.y,display:"inline"});r["c"+t+"_line"]=h;f=r["c"+t]=svgedit.path.addCtrlGrip(s);svgedit.utilities.assignAttributes(f,{cx:u.x,cy:u.y,display:"inline"});r["c"+t]=f}return r};svgedit.path.replacePathSeg=function(n,t,i,r){var e=r||svgedit.path.path.elem,a="createSVGPathSeg"+s[n],o=e[a].apply(e,i),l;if(svgedit.browser.supportsPathReplaceItem())e.pathSegList.replaceItem(o,t);else{for(var f=e.pathSegList,h=f.numberOfItems,c=[],u=0;u<h;u++)l=f.getItem(u),c.push(l);for(f.clear(),u=0;u<h;u++)u==t?f.appendItem(o):f.appendItem(c[u])}};svgedit.path.getSegSelector=function(n,t){var s=n.index,i=svgedit.utilities.getElem("segline_"+s),h,o,e,r,f;if(i||(h=svgedit.path.getGripContainer(),i=document.createElementNS(u.SVG,"path"),svgedit.utilities.assignAttributes(i,{id:"segline_"+s,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"}),h.appendChild(i)),t){if(o=n.prev,!o)return i.setAttribute("display","none"),i;for(e=svgedit.path.getGripPt(o),svgedit.path.replacePathSeg(2,0,[e.x,e.y],i),r=svgedit.path.ptObjToArr(n.type,n.item,!0),f=0;f<r.length;f+=2)e=svgedit.path.getGripPt(n,{x:r[f],y:r[f+1]}),r[f]=e.x,r[f+1]=e.y;svgedit.path.replacePathSeg(n.type,1,r,i)}return i};svgedit.path.smoothControlPoints=function(t,i,r){var s=t.x-r.x,h=t.y-r.y,c=i.x-r.x,l=i.y-r.y,o,u,a,v;if((s!=0||h!=0)&&(c!=0||l!=0)){var f=Math.atan2(h,s),e=Math.atan2(l,c),w=Math.sqrt(s*s+h*h),b=Math.sqrt(c*c+l*l),y=n.getSVGRoot().createSVGPoint(),p=n.getSVGRoot().createSVGPoint();return f<0&&(f+=2*Math.PI),e<0&&(e+=2*Math.PI),o=Math.abs(f-e),u=Math.abs(Math.PI-o)/2,f-e>0?(a=o<Math.PI?f+u:f-u,v=o<Math.PI?e-u:e+u):(a=o<Math.PI?f-u:f+u,v=o<Math.PI?e+u:e-u),y.x=w*Math.cos(a)+r.x,y.y=w*Math.sin(a)+r.y,p.x=b*Math.cos(v)+r.x,p.y=b*Math.sin(v)+r.y,[y,p]}return undefined};svgedit.path.Segment=function(n,t){this.selected=!1;this.index=n;this.item=t;this.type=t.pathSegType;this.ctrlpts=[];this.ptgrip=null;this.segsel=null};svgedit.path.Segment.prototype.showCtrlPts=function(n){for(var t in this.ctrlpts)this.ctrlpts.hasOwnProperty(t)&&this.ctrlpts[t].setAttribute("display",n?"inline":"none")};svgedit.path.Segment.prototype.selectCtrls=function(n){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",n?"#0FF":"#EEE")};svgedit.path.Segment.prototype.show=function(n){this.ptgrip&&(this.ptgrip.setAttribute("display",n?"inline":"none"),this.segsel.setAttribute("display",n?"inline":"none"),this.showCtrlPts(n))};svgedit.path.Segment.prototype.select=function(n){this.ptgrip&&(this.ptgrip.setAttribute("stroke",n?"#0FF":"#00F"),this.segsel.setAttribute("display",n?"inline":"none"),this.ctrlpts&&this.selectCtrls(n),this.selected=n)};svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,!0);this.ctrlpts=svgedit.path.getControlPoints(this,!0);this.segsel=svgedit.path.getSegSelector(this,!0)};svgedit.path.Segment.prototype.update=function(n){if(this.ptgrip){var t=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,{cx:t.x,cy:t.y});svgedit.path.getSegSelector(this,!0);this.ctrlpts&&(n&&(this.item=svgedit.path.path.elem.pathSegList.getItem(this.index),this.type=this.item.pathSegType),svgedit.path.getControlPoints(this))}};svgedit.path.Segment.prototype.move=function(n,t){var f,u=this.item,i=$.extend({},u),r,e,o;f=this.ctrlpts?[i.x+=n,i.y+=t,i.x1,i.y1,i.x2+=n,i.y2+=t]:[i.x+=n,i.y+=t];svgedit.path.replacePathSeg(this.type,this.index,f);this.next&&this.next.ctrlpts&&(r=this.next.item,e=[r.x,r.y,r.x1+=n,r.y1+=t,r.x2,r.y2],svgedit.path.replacePathSeg(this.next.type,this.next.index,e));this.mate&&(u=this.mate.item,o=[u.x+=n,u.y+=t],svgedit.path.replacePathSeg(this.mate.type,this.mate.index,o));this.update(!0);this.next&&this.next.update(!0)};svgedit.path.Segment.prototype.setLinked=function(n){var t,u,r,f,i,e;if(n==2){if(u=1,t=this.next,!t)return;r=this.item}else{if(u=2,t=this.prev,!t)return;r=t.item}f=t.item;i=$.extend({},f);i["x"+u]=r.x+(r.x-this.item["x"+n]);i["y"+u]=r.y+(r.y-this.item["y"+n]);e=[i.x,i.y,i.x1,i.y1,i.x2,i.y2];svgedit.path.replacePathSeg(t.type,t.index,e);t.update(!0)};svgedit.path.Segment.prototype.moveCtrl=function(n,t,i){var f=this.item,r=$.extend({},f),u;r["x"+n]+=t;r["y"+n]+=i;u=[r.x,r.y,r.x1,r.y1,r.x2,r.y2];svgedit.path.replacePathSeg(this.type,this.index,u);this.update(!0)};svgedit.path.Segment.prototype.setType=function(n,t){svgedit.path.replacePathSeg(n,this.index,t);this.type=n;this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.showCtrlPts(n===6);this.ctrlpts=svgedit.path.getControlPoints(this);this.update(!0)};svgedit.path.Path=function(n){if(!n||n.tagName!=="path")throw"svgedit.path.Path constructed without a <path> element";this.elem=n;this.segs=[];this.selected_pts=[];svgedit.path.path=this;this.init()};svgedit.path.Path.prototype.init=function(){var o,e,n,h,s,i,u;for($(svgedit.path.getGripContainer()).find("*").each(function(){$(this).attr("display","none")}),o=this.elem.pathSegList,e=o.numberOfItems,this.segs=[],this.selected_pts=[],this.first_seg=null,n=0;n<e;n++)h=o.getItem(n),s=new svgedit.path.Segment(n,h),s.path=this,this.segs.push(s);for(i=this.segs,u=null,n=0;n<e;n++){var t=i[n],f=n+1>=e?null:i[n+1],c=n-1<0?null:i[n-1],r;t.type===2?(c&&c.type!==1&&(r=i[u],r.next=i[u+1],r.next.prev=r,r.addGrip()),u=n):f&&f.type===1?(t.next=i[u+1],t.next.prev=t,t.mate=i[u],t.addGrip(),this.first_seg==null&&(this.first_seg=t)):f?t.type!==1&&(t.addGrip(),f&&f.type!==2&&(t.next=f,t.next.prev=t)):t.type!==1&&(r=i[u],r.next=i[u+1],r.next.prev=r,r.addGrip(),t.addGrip(),this.first_seg||(this.first_seg=i[u]))}return this};svgedit.path.Path.prototype.eachSeg=function(n){for(var r=this.segs.length,i,t=0;t<r;t++)if(i=n.call(this.segs[t],t),i===!1)break};svgedit.path.Path.prototype.addSeg=function(n){var t=this.segs[n],i,f,r,u,w;if(t.prev){i=t.prev;switch(t.item.pathSegType){case 4:r=(t.item.x+i.item.x)/2;u=(t.item.y+i.item.y)/2;f=this.elem.createSVGPathSegLinetoAbs(r,u);break;case 6:var e=(i.item.x+t.item.x1)/2,o=(t.item.x1+t.item.x2)/2,s=(t.item.x2+t.item.x)/2,h=(e+o)/2,c=(o+s)/2;r=(h+c)/2;var l=(i.item.y+t.item.y1)/2,a=(t.item.y1+t.item.y2)/2,v=(t.item.y2+t.item.y)/2,y=(l+a)/2,p=(a+v)/2;u=(y+p)/2;f=this.elem.createSVGPathSegCurvetoCubicAbs(r,u,e,l,h,y);w=[t.item.x,t.item.y,c,p,s,v];svgedit.path.replacePathSeg(t.type,n,w)}svgedit.path.insertItemBefore(this.elem,f,n)}};svgedit.path.Path.prototype.deleteSeg=function(n){var t=this.segs[n],u=this.elem.pathSegList,i,r,f;t.show(!1);i=t.next;t.mate?(r=[i.item.x,i.item.y],svgedit.path.replacePathSeg(2,i.index,r),svgedit.path.replacePathSeg(4,t.index,r),u.removeItem(t.mate.index)):t.prev?u.removeItem(n):(f=t.item,r=[i.item.x,i.item.y],svgedit.path.replacePathSeg(2,t.next.index,r),u.removeItem(n))};svgedit.path.Path.prototype.subpathIsClosed=function(n){var t=!1;return svgedit.path.path.eachSeg(function(i){return i<=n?!0:this.type===2?!1:this.type===1?(t=!0,!1):void 0}),t};svgedit.path.Path.prototype.removePtFromSelection=function(n){var t=this.selected_pts.indexOf(n);t!=-1&&(this.segs[n].select(!1),this.selected_pts.splice(t,1))};svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(!1)});this.selected_pts=[]};svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")};svgedit.path.Path.prototype.show=function(n){return this.eachSeg(function(){this.show(n)}),n&&this.selectPt(this.first_seg.index),this};svgedit.path.Path.prototype.movePts=function(n,t){for(var i=this.selected_pts.length,r;i--;)r=this.segs[this.selected_pts[i]],r.move(n,t)};svgedit.path.Path.prototype.moveCtrl=function(n,t){var i=this.segs[this.selected_pts[0]];i.moveCtrl(this.dragctrl,n,t);c&&i.setLinked(this.dragctrl)};svgedit.path.Path.prototype.setSegType=function(n){var e,s,h,u;for(this.storeD(),e=this.selected_pts.length;e--;){var y=this.selected_pts[e],t=this.segs[y],o=t.prev;if(o){n||(s="Toggle Path Segment Type",h=t.type,n=h==6?4:6);n=Number(n);var i=t.item.x,r=t.item.y,c=o.item.x,l=o.item.y,f;switch(n){case 6:if(t.olditem)u=t.olditem,f=[i,r,u.x1,u.y1,u.x2,u.y2];else{var a=i-c,v=r-l,p=c+a/3,w=l+v/3,b=i-a/3,k=r-v/3;f=[i,r,p,w,b,k]}break;case 4:f=[i,r];t.olditem=t.item}t.setType(n,f)}}svgedit.path.path.endChanges(s)};svgedit.path.Path.prototype.selectPt=function(n,t){this.clearSelection();n==null&&this.eachSeg(function(t){this.prev&&(n=t)});this.addPtsToSelection(n);t&&(this.dragctrl=t,c&&this.segs[n].setLinked(t))};svgedit.path.Path.prototype.update=function(){var n=this.elem;return svgedit.utilities.getRotationAngle(n)?(this.matrix=svgedit.math.getMatrix(n),this.imatrix=this.matrix.inverse()):(this.matrix=null,this.imatrix=null),this.eachSeg(function(t){this.item=n.pathSegList.getItem(t);this.update()}),this};svgedit.path.getPath_=function(n){var t=f[n.id];return t||(t=f[n.id]=new svgedit.path.Path(n)),t};svgedit.path.removePath_=function(n){n in f&&delete f[n]};h=function(n,u){var f=n-e,s=u-o,h=Math.sqrt(f*f+s*s),c=Math.atan2(s,f)+r;return f=h*Math.cos(c)+e,s=h*Math.sin(c)+o,f-=t,s-=i,h=Math.sqrt(f*f+s*s),c=Math.atan2(s,f)-r,{x:h*Math.cos(c)+t,y:h*Math.sin(c)+i}};svgedit.path.recalcRotatedPath=function(){var f=svgedit.path.path.elem,u,s,y,c,n,p,w,l,b,k,d,tt;if(r=svgedit.utilities.getRotationAngle(f,!0),r){u=svgedit.utilities.getBBox(f);s=svgedit.path.path.oldbbox;e=s.x+s.width/2;o=s.y+s.height/2;t=u.x+u.width/2;i=u.y+u.height/2;var a=t-e,v=i-o,g=Math.sqrt(a*a+v*v),nt=Math.atan2(v,a)+r;for(t=g*Math.cos(nt)+e,i=g*Math.sin(nt)+o,y=f.pathSegList,c=y.numberOfItems;c;)(c-=1,n=y.getItem(c),p=n.pathSegType,p!=1)&&(w=h(n.x,n.y),l=[w.x,w.y],n.x1!=null&&n.x2!=null&&(b=h(n.x1,n.y1),k=h(n.x2,n.y2),l.splice(l.length,0,b.x,b.y,k.x,k.y)),svgedit.path.replacePathSeg(p,c,l));u=svgedit.utilities.getBBox(f);d=svgroot.createSVGTransform();tt=svgedit.transformlist.getTransformList(f);d.setRotate(r*180/Math.PI,t,i);tt.replaceItem(d,0)}};svgedit.path.clearData=function(){f={}}})();
window.initLocale=function(){var n=function(n,a){"use strict";var e;a.putLocale=function(r,t){if(r)e=r;else{if(e=n.pref("lang"),!e&&(navigator.userLanguage?e=navigator.userLanguage:navigator.language&&(e=navigator.language),null==e))return;console.log("Lang: "+e),n.inArray(e,t)===-1&&"test"!==e&&(e="en")}var i=a.curConfig,g=i.langPath+"lang."+e+".js";n.getScript(g,function(n){if(!n){var a=document.createElement("script");a.src=g,document.querySelector("head").appendChild(a)}})}}(jQuery,n)};
var svgedit=svgedit||{};(function(){window.initContextmenu=function(){var n=this;svgedit.contextmenu||(svgedit.contextmenu={}),n.contextMenuExtensions={};var e=function(n){return n&&n.id&&n.label&&n.action&&"function"==typeof n.action},t=function(t){return e(t)?t.id in n.contextMenuExtensions?void console.error('Cannot add extension "'+t.id+'", an extension by that name already exists"'):(console.log("Registed contextmenu item: {id:"+t.id+", label:"+t.label+"}"),void(n.contextMenuExtensions[t.id]=t)):void console.error("Menu items must be defined and have at least properties: id, label, action, where action must be a function")},o=function(e){return n.contextMenuExtensions[e]&&!0},i=function(e){return n.contextMenuExtensions[e].action},s=function(n){};svgEditor.ready(function(){var n;for(n in contextMenuExtensions)s(contextMenuExtensions[n])}),svgedit.contextmenu.resetCustomMenus=function(){n.contextMenuExtensions={}},svgedit.contextmenu.add=t,svgedit.contextmenu.hasCustomHandler=o,svgedit.contextmenu.getCustomHandler=i}})();
function touchHandler(n){"use strict";var r,u=n.changedTouches,t=u[0],i="";switch(n.type){case"touchstart":i="mousedown";break;case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}r=document.createEvent("MouseEvent");r.initMouseEvent(i,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null);u.length<2&&(t.target.dispatchEvent(r),n.preventDefault())}document.addEventListener("touchstart",touchHandler,!0);document.addEventListener("touchmove",touchHandler,!0);document.addEventListener("touchend",touchHandler,!0);document.addEventListener("touchcancel",touchHandler,!0);
var mysvgcanvas=function(){return{initSvgCanvas:function(t){window.console||(window.console={},window.console.log=function(t){},window.console.dir=function(t){}),window.opera&&(window.console.log=function(t){opera.postError(t)},window.console.dir=function(t){})}}}(mysvgcanvas||{});$.SvgCanvas=function(t,e){function i(){Mt();var t=[],e={feGaussianBlur:K.exportNoBlur,foreignObject:K.exportNoforeignObject,"[stroke-dasharray]":K.exportNoDashArray},i=$(g);return"font"in $("<canvas>")[0].getContext("2d")||(e.text=K.exportNoText),$.each(e,function(e,r){i.find(e).length&&t.push(r)}),t}function r(t,e){var i,r=svgedit.utilities.getBBox(t);for(i=0;i<2;i++){var n=0===i?"fill":"stroke",a=t.getAttribute(n);if(a&&0===a.indexOf("url(")){var s=svgedit.utilities.getRefElem(a);if("linearGradient"===s.tagName){var o=s.getAttribute("x1")||0,l=s.getAttribute("y1")||0,d=s.getAttribute("x2")||1,g=s.getAttribute("y2")||0;o=r.width*o+r.x,l=r.height*l+r.y,d=r.width*d+r.x,g=r.height*g+r.y;var h=svgedit.math.transformPoint(o,l,e),u=svgedit.math.transformPoint(d,g,e),m={};m.x1=(h.x-r.x)/r.width,m.y1=(h.y-r.y)/r.height,m.x2=(u.x-r.x)/r.width,m.y2=(u.y-r.y)/r.height;var c=s.cloneNode(!0);$(c).attr(m),c.id=St(),svgedit.utilities.findDefs().appendChild(c),t.setAttribute(n,"url(#"+c.id+")")}}}}var n=svgedit.NS,a={show_outside_canvas:!0,selectNew:!0,dimensions:[640,480]};e&&$.extend(a,e);var s=a.dimensions,o=this,l=t.ownerDocument,d=l.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+n.SVG+'" xlinkns="'+n.XLINK+'" width="'+s[0]+'" height="'+s[1]+'" x="'+s[0]+'" y="'+s[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,!0);t.appendChild(d);var g=l.createElementNS(n.SVG,"svg"),h=o.clearSvgContentElement=function(){for(;g.firstChild;)g.removeChild(g.firstChild);$(g).attr({id:"svgcontent",width:s[0],height:s[1],x:s[0],y:s[1],overflow:a.show_outside_canvas?"visible":"hidden",xmlns:n.SVG,"xmlns:se":n.SE,"xmlns:xlink":n.XLINK}).appendTo(d);var t=l.createComment(" Created with wux-editor ");g.appendChild(t)};h();var u="svg_";o.setIdPrefix=function(t){u=t},o.current_drawing_=new svgedit.draw.Drawing(g,u);var m=o.getCurrentDrawing=function(){return o.current_drawing_},c=1,v=null,f={shape:{fill:("none"==a.initFill.color?"":"#")+a.initFill.color,fill_paint:null,fill_opacity:a.initFill.opacity,stroke:"#"+a.initStroke.color,stroke_paint:null,stroke_opacity:a.initStroke.opacity,stroke_width:a.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:a.initOpacity}};f.text=$.extend(!0,{},f.shape),$.extend(f.text,{fill:"#000000",stroke_width:0,font_size:14,font_family:"sans-serif",text_anchor:"middle"});var p=f.shape,b=new Array(1),S=this.addSvgElementFromJson=function(t){var e=svgedit.utilities.getElem(t.attr.id),i=m().getCurrentLayer();return e&&t.element!=e.tagName&&(i.removeChild(e),e=null),e||(e=l.createElementNS(n.SVG,t.element),i&&(v||i).appendChild(e)),t.curStyles&&svgedit.utilities.assignAttributes(e,{fill:p.fill,stroke:p.stroke,"stroke-width":p.stroke_width,"stroke-dasharray":p.stroke_dasharray,"stroke-linejoin":p.stroke_linejoin,"stroke-linecap":p.stroke_linecap,"stroke-opacity":p.stroke_opacity,"fill-opacity":p.fill_opacity,opacity:p.opacity/2,style:"pointer-events:inherit"},100),svgedit.utilities.assignAttributes(e,t.attr,100),svgedit.utilities.cleanupElement(e),e},C=this.addSvgGroupFromJson=function(t){var e=svgedit.utilities.getElem(t.id),i=m().getCurrentLayer();e&&t.group!=e.tagName&&(i.removeChild(e),e=null),e||(e=l.createElementNS(n.SVG,t.group),e.setAttribute("id",t.id),e.setAttribute("type",t.type),i&&(v||i).appendChild(e));for(var r=0;r<t.elements.length;r++){var a=l.createElementNS(n.SVG,t.elements[r].type);if(svgedit.utilities.assignAttributes(a,{"stroke-width":p.stroke_width,"stroke-dasharray":p.stroke_dasharray,"stroke-linejoin":p.stroke_linejoin,"stroke-linecap":p.stroke_linecap,style:"pointer-events:inherit"},100),svgedit.utilities.assignAttributes(a,t.elements[r].attr),"text"===t.elements[r].type)a.textContent=t.elements[r].content;else if("foreignObject"===t.elements[r].type){var s=t.elements[r].content;if(s)for(var o=0;o<s.length;o++){var d=document.createElement(s[o].tag);if(d.tagName=d.tagName.toLowerCase(),"select"===d.tagName.toLowerCase()){var g=document.createElement("option");g.setAttribute("test"," "),d.appendChild(g)}else"button"===d.tagName.toLowerCase()?d.innerHTML="button":"span"===d.tagName.toLowerCase()&&(s[o].value&&(d.innerHTML=s[o].value),s[o].attr&&svgedit.utilities.assignAttributes(d,s[o].attr));svgedit.utilities.assignAttributes(d,s[o].attr),s[o].style&&d.setAttribute("style",s[o].style),"input"===d.tagName.toLowerCase()&&(d.style.backgroundColor=p.fill,d.style.color=p.stroke),a.appendChild(d)}}e.appendChild(a)}return t.curStyles&&svgedit.utilities.assignAttributes(e,{fill:p.fill,stroke:p.stroke,"stroke-width":p.stroke_width,"stroke-dasharray":p.stroke_dasharray,"stroke-linejoin":p.stroke_linejoin,"stroke-linecap":p.stroke_linecap,style:"pointer-events:inherit"},100),svgedit.utilities.assignAttributes(e,t.attr,100),svgedit.utilities.cleanupElement(e),svgedit.onGaugeAdded&&svgedit.onGaugeAdded({id:t.id,type:t.type}),e},w=(o.getTransformList=svgedit.transformlist.getTransformList,svgedit.math.transformPoint),N=o.matrixMultiply=svgedit.math.matrixMultiply,A=o.hasMatrixTransform=svgedit.math.hasMatrixTransform,k=o.transformListToTransform=svgedit.math.transformListToTransform;svgedit.math.snapToAngle,svgedit.math.getMatrix;svgedit.units.init({getBaseUnit:function(){return a.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return g.getAttribute("height")/c},getWidth:function(){return g.getAttribute("width")/c},getRoundDigits:function(){return rt.round_digits}});o.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return l},getDOMContainer:function(){return t},getSVGRoot:function(){return d},getSelectedElements:function(){return b},getSVGContent:function(){return g},getBaseUnit:function(){return a.baseUnit},getSnappingStep:function(){return a.snappingStep}});var E=o.findDefs=svgedit.utilities.findDefs,T=o.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,_=o.getHref=svgedit.utilities.getHref,B=o.setHref=svgedit.utilities.setHref,G=svgedit.utilities.getPathBBox,I=(o.getBBox=svgedit.utilities.getBBox,o.getRotationAngle=svgedit.utilities.getRotationAngle,o.getElem=svgedit.utilities.getElem),M=(o.getRefElem=svgedit.utilities.getRefElem,o.assignAttributes=svgedit.utilities.assignAttributes),L=this.cleanupElement=svgedit.utilities.cleanupElement;svgedit.coords.init({getDrawing:function(){return m()},getGridSnapping:function(){return a.gridSnapping}});var P=this.remapElement=svgedit.coords.remapElement;svgedit.recalculate.init({getSVGRoot:function(){return d},getStartTransform:function(){return at},setStartTransform:function(t){at=t}});var O,D=this.recalculateDimensions=svgedit.recalculate.recalculateDimensions,R=svgedit.getReverseNS(),V=o.sanitizeSvg=svgedit.sanitize.sanitizeSvg,U=svgedit.history.MoveElementCommand,z=svgedit.history.InsertElementCommand,F=svgedit.history.RemoveElementCommand,j=svgedit.history.ChangeElementCommand,H=svgedit.history.BatchCommand;o.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(t,e){var i=svgedit.history.HistoryEventTypes;if(t==i.BEFORE_UNAPPLY||t==i.BEFORE_APPLY)o.clearSelection();else if(t==i.AFTER_APPLY||t==i.AFTER_UNAPPLY){var r=e.elements();o.pathActions.clear(),O("changed",r);var n=e.type(),a=t==i.AFTER_APPLY;if(n==U.type()){var s=a?e.newParent:e.oldParent;s==g&&o.identifyLayers()}else if(n==z.type()||n==F.type())e.parent==g&&o.identifyLayers(),n==z.type()?a&&Q(e.elem):a||Q(e.elem),"use"===e.elem.tagName&&Vt(e.elem);else if(n==j.type()){"title"==e.elem.tagName&&e.elem.parentNode.parentNode==g&&o.identifyLayers();var l=a?e.newValues:e.oldValues;l.stdDeviation&&o.setBlurOffsets(e.elem.parentNode,l.stdDeviation)}}}});var q=function(t){o.undoMgr.addCommandToHistory(t)};svgedit.select.init(a,{createSVGElement:function(t){return o.addSvgElementFromJson(t)},svgRoot:function(){return d},svgContent:function(){return g},currentZoom:function(){return c},getStrokedBBox:function(t){return o.getStrokedBBox([t])}});var W=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return c},getSVGRoot:function(){return d}});var K={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},X="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use",Y=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],Z=$.data,J=document.createElementNS(n.SVG,"animate");$(J).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(d);var Q=function(t){var e,i,r,n=$(t).attr(Y);for(e in n){var a=n[e];if(a&&0===a.indexOf("url(")){var s=svgedit.utilities.getUrlFromAttr(a).substr(1),o=I(s);o||(svgedit.utilities.findDefs().appendChild(ft[s]),delete ft[s])}}var l=t.getElementsByTagName("*");if(l.length)for(i=0,r=l.length;i<r;i++)Q(l[i])},tt={},et=a.imgPath+"logo.png",it=[],rt={round_digits:5},nt=!1,at=null,st="select",ot="none",lt={},dt=f.text,gt=p,ht=null,ut=null,mt=[],ct={},vt=null,ft={};o.clipBoard=[];var pt=this.runExtensions=function(t,e,i){var r=!!i&&[];return $.each(ct,function(n,a){a&&t in a&&(i?r.push(a[t](e)):r=a[t](e))}),r};this.addExtension=function(t,e){var i;t in ct?console.log('Cannot add extension "'+t+'", an extension by that name already exists.'):(i=$.isFunction(e)?e($.extend(o.getPrivateMethods(),{svgroot:d,svgcontent:g,nonce:m().getNonce(),selectorManager:W})):e,ct[t]=i,O("extension_added",i))},this.clickExtension=function(t){if(t in ct){var e=ct[t];e.buttons&&e.buttons[0]&&e.buttons[0].events&&e.buttons[0].events.click()}};var yt=this.round=function(t){return parseInt(t*c,10)/c},xt=this.getIntersectionList=function(t){if(null==ut)return null;var e=v||m().getCurrentLayer();mt.length||(mt=At(e));var i=null;try{i=e.getIntersectionList(t,null)}catch(t){}if(null==i||"function"!=typeof i.item){i=[];var r;if(t)r=t;else{r=ut.getBBox();var n,a={};for(n in r)a[n]=r[n]/c;r=a}for(var s=mt.length;s--;)r.width&&svgedit.math.rectsIntersect(r,mt[s].bbox)&&i.push(mt[s].elem)}return i};getStrokedBBox=this.getStrokedBBox=function(t){if(t||(t=Nt()),!t.length)return!1;var e,i=function(t){try{var e=svgedit.utilities.getBBox(t),i=svgedit.utilities.getRotationAngle(t);if(i&&i%90||svgedit.math.hasMatrixTransform(svgedit.transformlist.getTransformList(t))){var r=!1,a=["ellipse","path","line","polyline","polygon"];if(a.indexOf(t.tagName)>=0)e=r=o.convertToPath(t,!0);else if("rect"==t.tagName){var s=t.getAttribute("rx"),l=t.getAttribute("ry");(s||l)&&(e=r=o.convertToPath(t,!0))}if(!r){var d=t.cloneNode(!0),g=document.createElementNS(n.SVG,"g"),h=t.parentNode;h.appendChild(g),g.appendChild(d),e=svgedit.utilities.bboxToObj(g.getBBox()),h.removeChild(g)}}return e}catch(e){return console.log(t,e),null}};if($.each(t,function(){e||this.parentNode&&(e=i(this))}),null==e)return null;var r=e.x+e.width,a=e.y+e.height,s=e.x,l=e.y,d=function(t){var e=t.getAttribute("stroke-width"),i=0;return"none"==t.getAttribute("stroke")||isNaN(e)||(i+=e/2),i},g=[];return $.each(t,function(t,e){var r=i(e);if(r){var n=d(e);s=Math.min(s,r.x-n),l=Math.min(l,r.y-n),g.push(r)}}),e.x=s,e.y=l,$.each(t,function(t,e){var i=g[t];if(i&&1==e.nodeType){var n=d(e);r=Math.max(r,i.x+i.width+n),a=Math.max(a,i.y+i.height+n)}}),e.width=r-s,e.height=a-l,e};var bt,St,Ct,wt,Nt=this.getVisibleElements=function(t){t||(t=$(g).children());var e=[];return $(t).children().each(function(t,i){try{i.getBBox()&&e.push(i)}catch(t){}}),e.reverse()},At=this.getVisibleElementsAndBBoxes=function(t){t||(t=$(g).children());var e=[];return $(t).children().each(function(t,i){try{i.getBBox()&&e.push({elem:i,bbox:getStrokedBBox([i])})}catch(t){}}),e.reverse()},kt=this.groupSvgElem=function(t){var e=document.createElementNS(n.SVG,"g");t.parentNode.replaceChild(e,t),$(e).append(t).data("gsvg",t)[0].id=St()},Et=function(t){var e=document.createElementNS(t.namespaceURI,t.nodeName),i=t.parentNode;(i&&"foreignObject"===i.nodeName||i.parentNode&&"foreignObject"===i.parentNode.nodeName)&&(e=document.createElement(t.nodeName),e.tagName=e.tagName.toLowerCase()),$.each(t.attributes,function(t,i){"-moz-math-font-style"!=i.localName&&e.setAttribute(i.nodeName,i.value)});var r=e.getAttribute("id");if(r){var n=r.slice(0,1+r.indexOf("_"));e.removeAttribute("id"),e.id=St(),n!==u&&(e.id=e.id.replace(u,n))}if(svgedit.browser.isWebkit()&&"path"==t.nodeName){var a=wt.convertPath(t);e.setAttribute("d",a)}if($.each(t.childNodes,function(t,i){switch(i.nodeType){case 1:e.appendChild(Et(i));break;case 3:e.textContent=i.nodeValue}}),$(t).data("gsvg"))$(e).data("gsvg",e.firstChild);else if($(t).data("symbol")){var s=$(t).data("symbol");$(e).data("ref",s).data("symbol",s)}else"image"==e.tagName&&Ot(e);return e};(function(t){var e={};bt=t.getId=function(){return m().getId()},St=t.getNextId=function(){return m().getNextId()},O=t.call=function(t,i){if(e[t])return e[t](this,i)},t.bind=function(t,i){var r=e[t];return e[t]=i,r}})(o),this.prepareSvg=function(t){this.sanitizeSvg(t.documentElement);var e,i,r,a=t.getElementsByTagNameNS(n.SVG,"path");for(e=0,r=a.length;e<r;++e)i=a[e],i.setAttribute("d",wt.convertPath(i)),wt.fixEnd(i)};var Tt=function(t){if(!svgedit.browser.isGecko())return t;var e=t.cloneNode(!0);return t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t),W.releaseSelector(t),b[0]=e,W.requestSelector(e).showGrips(!0),e};this.setRotationAngle=function(t,e){t=parseFloat(t);var i=b[0],r=i.getAttribute("transform"),n=svgedit.utilities.getBBox(i),a=n.x+n.width/2,s=n.y+n.height/2,o=svgedit.transformlist.getTransformList(i);if(o.numberOfItems>0){var l=o.getItem(0);4==l.type&&o.removeItem(0)}if(0!=t){var g=svgedit.math.transformPoint(a,s,svgedit.math.transformListToTransform(o).matrix),h=d.createSVGTransform();h.setRotate(t,g.x,g.y),o.numberOfItems?o.insertItemBefore(h,0):o.appendItem(h)}else 0==o.numberOfItems&&i.removeAttribute("transform");if(!e){var u=i.getAttribute("transform");i.setAttribute("transform",r),Zt("transform",u,b),O("changed",b)}var m=(svgedit.utilities.getElem("pathpointgrip_container"),W.requestSelector(b[0]));m.resize(),m.updateGripCursors(t)};var _t=this.recalculateAllSelectedDimensions=function(){for(var t="none"==ot?"position":"size",e=new svgedit.history.BatchCommand(t),i=b.length;i--;){var r=b[i],n=svgedit.recalculate.recalculateDimensions(r);n&&e.addSubCommand(n)}e.isEmpty()||(q(e),O("changed",b))},Bt=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],Gt=function(t){console.log([t.a,t.b,t.c,t.d,t.e,t.f])},It=null,Mt=this.clearSelection=function(t){if(null!=b[0]){var e,i,r=b.length;for(e=0;e<r&&(i=b[e],null!=i);++e)W.releaseSelector(i),b[e]=null}t||O("selected",b)},Lt=this.addToSelection=function(t,e){if(0!=t.length){for(var i=0;i<b.length&&null!=b[i];)++i;for(var r=t.length;r--;){var n=t[r];if(n&&svgedit.utilities.getBBox(n)&&("a"===n.tagName&&1===n.childNodes.length&&(n=n.firstChild),b.indexOf(n)==-1)){b[i]=n,i++;var a=W.requestSelector(n);b.length>1&&a.showGrips(!1)}}for(O("selected",b),e||1==b.length?W.requestSelector(b[0]).showGrips(!0):W.requestSelector(b[0]).showGrips(!1),b.sort(function(t,e){return t&&e&&t.compareDocumentPosition?3-(6&e.compareDocumentPosition(t)):null==t?1:void 0});null==b[0];)b.shift(0)}},$t=this.selectOnly=function(t,e){Mt(!0),Lt(t,e)};this.removeFromSelection=function(t){if(null!=b[0]&&0!=t.length){var e,i=0,r=[],n=b.length;for(r.length=n,e=0;e<n;++e){var a=b[e];a&&(t.indexOf(a)==-1?(r[i]=a,i++):W.releaseSelector(a))}b=r}};this.selectAllInCurrentLayer=function(){var t=m().getCurrentLayer();t&&(st="select",$t($(v||t).children()))};var Pt=this.getMouseTarget=function(e){if(null==e)return null;var i=e.target;if(i.correspondingUseElement&&(i=i.correspondingUseElement),[n.MATH,n.HTML].indexOf(i.namespaceURI)>=0&&"svgcanvas"!=i.id)for(;"foreignObject"!=i.nodeName;)if(i=i.parentNode,!i)return d;var r=m().getCurrentLayer();if([d,t,g,r].indexOf(i)>=0)return d;var a=$(i);if(a.closest("#selectorParentGroup").length)return W.selectorParentGroup;for(;i.parentNode!==(v||r);)i=i.parentNode;return i};(function(){var e,i,r=null,n=null,s=null,l=null,g=null,h={},u={minx:null,miny:null,maxx:null,maxy:null},f=0,C={x:0,y:0},w={x:0,y:0},N={x:0,y:0},A={x:0,y:0},k={x:0,y:0},E={x:0,y:0},T=.8,_=10,G=function(t){var e={x:0,y:0},i=C,r=w,n=N,a=A,s=1/6,o=t*t,l=o*t,d=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];return e.x=s*((i.x*d[0][0]+r.x*d[0][1]+n.x*d[0][2]+a.x*d[0][3])*l+(i.x*d[1][0]+r.x*d[1][1]+n.x*d[1][2]+a.x*d[1][3])*o+(i.x*d[2][0]+r.x*d[2][1]+n.x*d[2][2]+a.x*d[2][3])*t+(i.x*d[3][0]+r.x*d[3][1]+n.x*d[3][2]+a.x*d[3][3])),e.y=s*((i.y*d[0][0]+r.y*d[0][1]+n.y*d[0][2]+a.y*d[0][3])*l+(i.y*d[1][0]+r.y*d[1][1]+n.y*d[1][2]+a.y*d[1][3])*o+(i.y*d[2][0]+r.y*d[2][1]+n.y*d[2][2]+a.y*d[2][3])*t+(i.y*d[3][0]+r.y*d[3][1]+n.y*d[3][2]+a.y*d[3][3])),{x:e.x,y:e.y}},I=function(t){if(!o.spaceKey&&1!==t.button){var e=2===t.button;t.altKey&&svgCanvas.cloneSelectedElements(0,0),It=$("#svgcontent g")[0].getScreenCTM().inverse();var i=svgedit.math.transformPoint(t.pageX,t.pageY,It),m=i.x*c,v=i.y*c;t.preventDefault(),e&&(st="select",vt=i);var f=m/c,y=v/c,x=Pt(t);"a"===x.tagName&&1===x.childNodes.length&&(x=x.firstChild);var C=f;l=n=f;var w=y;if(g=s=y,a.gridSnapping&&(f=svgedit.utilities.snapToGrid(f),y=svgedit.utilities.snapToGrid(y),n=svgedit.utilities.snapToGrid(n),s=svgedit.utilities.snapToGrid(s)),x==W.selectorParentGroup&&null!=b[0]){var A=t.target,k=Z(A,"type");"rotate"==k?st="rotate":"resize"==k&&(st="resize",ot=Z(A,"dir")),x=b[0]}at=x.getAttribute("transform");var E,T,_=svgedit.transformlist.getTransformList(x);switch(console.log("mousedown "+st),st){case"select":if(nt=!0,ot="none",e&&(nt=!1),x!=d){if(b.indexOf(x)==-1&&(t.shiftKey||Mt(!0),Lt([x]),ht=x,wt.clear()),!e)for(E=0;E<b.length;++E)if(null!=b[E]){var G=svgedit.transformlist.getTransformList(b[E]);G.numberOfItems?G.insertItemBefore(d.createSVGTransform(),0):G.appendItem(d.createSVGTransform())}}else e||(Mt(),st="multiselect",null==ut&&(ut=W.getRubberBandBox()),l*=c,g*=c,svgedit.utilities.assignAttributes(ut,{x:l,y:g,width:0,height:0,display:"inline"},100));break;case"zoom":nt=!0,null==ut&&(ut=W.getRubberBandBox()),svgedit.utilities.assignAttributes(ut,{x:C*c,y:C*c,width:0,height:0,display:"inline"},100);break;case"resize":nt=!0,n=f,s=y,h=svgedit.utilities.getBBox($("#selectedBox0")[0]);var I={};$.each(h,function(t,e){I[t]=e/c}),h=I;var M=svgedit.utilities.getRotationAngle(x)?1:0;if(svgedit.math.hasMatrixTransform(_))_.insertItemBefore(d.createSVGTransform(),M),_.insertItemBefore(d.createSVGTransform(),M),_.insertItemBefore(d.createSVGTransform(),M);else if(_.appendItem(d.createSVGTransform()),_.appendItem(d.createSVGTransform()),_.appendItem(d.createSVGTransform()),svgedit.browser.supportsNonScalingStroke()){var L=svgedit.browser.isWebkit();if(L)var P=function(t){var e=t.getAttributeNS(null,"stroke");t.removeAttributeNS(null,"stroke"),setTimeout(function(){t.setAttributeNS(null,"stroke",e)},0)};x.style.vectorEffect="non-scaling-stroke",L&&P(x);var O=x.getElementsByTagName("*"),D=O.length;for(E=0;E<D;E++)O[E].style.vectorEffect="non-scaling-stroke",L&&P(O[E])}break;case"fhellipse":case"fhrect":case"fhpath":N.x=C,N.y=w,nt=!0,r=C+","+w+" ",T=0==p.stroke_width?1:p.stroke_width,S({element:"polyline",curStyles:!0,attr:{points:r,id:St(),fill:"none",opacity:p.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}}),u.minx=C,u.maxx=C,u.miny=w,u.maxy=w;break;case"image":nt=!0;var R=S({element:"image",attr:{x:f,y:y,width:0,height:0,id:St(),opacity:p.opacity/2,style:"pointer-events:inherit"}});B(R,et),Ot(R);break;case"square":case"rect":nt=!0,n=f,s=y,S({element:"rect",curStyles:!0,attr:{x:f,y:y,width:0,height:0,id:St(),opacity:p.opacity/2}});break;case"line":nt=!0,T=0==p.stroke_width?1:p.stroke_width,S({element:"line",curStyles:!0,attr:{x1:f,y1:y,x2:f,y2:y,id:St(),stroke:p.stroke,"stroke-width":T,"stroke-dasharray":p.stroke_dasharray,"stroke-linejoin":p.stroke_linejoin,"stroke-linecap":p.stroke_linecap,"stroke-opacity":p.stroke_opacity,fill:"none",opacity:p.opacity/2,style:"pointer-events:none"}});break;case"circle":nt=!0,S({element:"circle",curStyles:!0,attr:{cx:f,cy:y,r:0,id:St(),opacity:p.opacity/2}});break;case"ellipse":nt=!0,S({element:"ellipse",curStyles:!0,attr:{cx:f,cy:y,rx:0,ry:0,id:St(),opacity:p.opacity/2}});break;case"text":nt=!0;S({element:"text",curStyles:!0,attr:{x:f,y:y,id:St(),fill:dt.fill,"stroke-width":dt.stroke_width,"font-size":dt.font_size,"font-family":dt.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:p.opacity}});break;case"path":case"pathedit":n*=c,s*=c,wt.mouseDown(t,x,n,s),nt=!0;break;case"textedit":n*=c,s*=c,Ct.mouseDown(t,x,n,s),nt=!0;break;case"rotate":nt=!0,o.undoMgr.beginUndoableChange("transform",b)}var V=pt("mouseDown",{event:t,start_x:n,start_y:s,selectedElements:b},!0);$.each(V,function(t,e){e&&e.started&&(nt=!0)})}},M=function(t){if(nt&&1!==t.button&&!o.spaceKey){var m,v,p,S,B,I,M,L,P,D,R=b[0],V=svgedit.math.transformPoint(t.pageX,t.pageY,It),U=V.x*c,z=V.y*c,F=svgedit.utilities.getElem(bt()),j=U/c;x=j;var H=z/c;y=H,a.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y)),t.preventDefault();var q;switch(st){case"select":if(null!==b[0]&&(I=x-n,M=y-s,a.gridSnapping&&(I=svgedit.utilities.snapToGrid(I),M=svgedit.utilities.snapToGrid(M)),t.shiftKey&&(v=svgedit.math.snapToAngle(n,s,x,y),x=v.x,y=v.y),0!=I||0!=M)){for(L=b.length,m=0;m<L&&(R=b[m],null!=R);++m){var K=d.createSVGTransform();q=svgedit.transformlist.getTransformList(R),K.setTranslate(I,M),q.numberOfItems?q.replaceItem(K,0):q.appendItem(K),W.requestSelector(R).resize()}O("transition",b)}break;case"multiselect":j*=c,H*=c,svgedit.utilities.assignAttributes(ut,{x:Math.min(l,j),y:Math.min(g,H),width:Math.abs(j-l),height:Math.abs(H-g)},100);var X=[],Y=[],Z=xt();for(L=b.length,m=0;m<L;++m){var J=Z.indexOf(b[m]);J==-1?X.push(b[m]):Z[J]=null}for(L=Z.length,m=0;m<L;++m)Z[m]&&Y.push(Z[m]);X.length>0&&o.removeFromSelection(X),Y.length>0&&Lt(Y);break;case"resize":q=svgedit.transformlist.getTransformList(R);var Q=svgedit.math.hasMatrixTransform(q);D=Q?h:svgedit.utilities.getBBox(R);var tt=D.x,et=D.y,it=D.width,rt=D.height;if(I=x-n,M=y-s,a.gridSnapping&&(I=svgedit.utilities.snapToGrid(I),M=svgedit.utilities.snapToGrid(M),rt=svgedit.utilities.snapToGrid(rt),it=svgedit.utilities.snapToGrid(it)),P=svgedit.utilities.getRotationAngle(R)){var at=Math.sqrt(I*I+M*M),lt=Math.atan2(M,I)-P*Math.PI/180;I=at*Math.cos(lt),M=at*Math.sin(lt)}ot.indexOf("n")==-1&&ot.indexOf("s")==-1&&(M=0),ot.indexOf("e")==-1&&ot.indexOf("w")==-1&&(I=0);var dt=0,gt=0,ht=rt?(rt+M)/rt:1,mt=it?(it+I)/it:1;ot.indexOf("n")>=0&&(ht=rt?(rt-M)/rt:1,gt=rt),ot.indexOf("w")>=0&&(mt=it?(it-I)/it:1,dt=it);var ct=d.createSVGTransform(),vt=d.createSVGTransform(),ft=d.createSVGTransform();if(a.gridSnapping&&(tt=svgedit.utilities.snapToGrid(tt),dt=svgedit.utilities.snapToGrid(dt),et=svgedit.utilities.snapToGrid(et),gt=svgedit.utilities.snapToGrid(gt)),ct.setTranslate(-(tt+dt),-(et+gt)),t.shiftKey&&(1==mt?mt=ht:ht=mt),vt.setScale(mt,ht),ft.setTranslate(tt+dt,et+gt),Q){var yt=P?1:0;q.replaceItem(ct,2+yt),q.replaceItem(vt,1+yt),q.replaceItem(ft,Number(yt))}else{var St=q.numberOfItems;q.replaceItem(ft,St-3),q.replaceItem(vt,St-2),q.replaceItem(ct,St-1)}W.requestSelector(R).resize(),O("transition",b);break;case"zoom":j*=c,H*=c,svgedit.utilities.assignAttributes(ut,{x:Math.min(l*c,j),y:Math.min(g*c,H),width:Math.abs(j-l*c),height:Math.abs(H-g*c)},100);break;case"text":svgedit.utilities.assignAttributes(F,{x:x,y:y},1e3);break;case"line":var Nt=null;window.opera||d.suspendRedraw(1e3),a.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y));var At=x,kt=y;t.shiftKey&&(v=svgedit.math.snapToAngle(n,s,At,kt),At=v.x,kt=v.y),F.setAttributeNS(null,"x2",At),F.setAttributeNS(null,"y2",kt),window.opera||d.unsuspendRedraw(Nt);break;case"foreignObject":case"square":case"rect":case"image":var Et,Tt,_t="square"==st||t.shiftKey,Bt=Math.abs(x-n),Gt=Math.abs(y-s);_t?(Bt=Gt=Math.max(Bt,Gt),Et=n<x?n:n-Bt,Tt=s<y?s:s-Gt):(Et=Math.min(n,x),Tt=Math.min(s,y)),a.gridSnapping&&(Bt=svgedit.utilities.snapToGrid(Bt),Gt=svgedit.utilities.snapToGrid(Gt),Et=svgedit.utilities.snapToGrid(Et),Tt=svgedit.utilities.snapToGrid(Tt)),svgedit.utilities.assignAttributes(F,{width:Bt,height:Gt,x:Et,y:Tt},1e3);break;case"circle":p=$(F).attr(["cx","cy"]),S=p.cx,B=p.cy;var Mt=Math.sqrt((x-S)*(x-S)+(y-B)*(y-B));a.gridSnapping&&(Mt=svgedit.utilities.snapToGrid(Mt)),F.setAttributeNS(null,"r",Mt);break;case"ellipse":p=$(F).attr(["cx","cy"]),S=p.cx,B=p.cy,Nt=null,window.opera||d.suspendRedraw(1e3),a.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),S=svgedit.utilities.snapToGrid(S),y=svgedit.utilities.snapToGrid(y),B=svgedit.utilities.snapToGrid(B)),F.setAttributeNS(null,"rx",Math.abs(x-S));var $t=Math.abs(t.shiftKey?x-S:y-B);F.setAttributeNS(null,"ry",$t),window.opera||d.unsuspendRedraw(Nt);break;case"fhellipse":case"fhrect":u.minx=Math.min(j,u.minx),u.maxx=Math.max(j,u.maxx),u.miny=Math.min(H,u.miny),u.maxy=Math.max(H,u.maxy);case"fhpath":if(A.x=j,A.y=H,C.x&&C.y)for(m=0;m<_-1;m++)e=m/_,i=(m+1)/_,k=G(i),E=k,k=G(e),f+=Math.sqrt((E.x-k.x)*(E.x-k.x)+(E.y-k.y)*(E.y-k.y)),f>T&&(r+=+k.x+","+k.y+" ",F.setAttributeNS(null,"points",r),f-=T);C={x:w.x,y:w.y},w={x:N.x,y:N.y},N={x:A.x,y:A.y};break;case"path":case"pathedit":if(x*=c,y*=c,a.gridSnapping&&(x=svgedit.utilities.snapToGrid(x),y=svgedit.utilities.snapToGrid(y),n=svgedit.utilities.snapToGrid(n),s=svgedit.utilities.snapToGrid(s)),t.shiftKey){var Pt,Ot,Dt=svgedit.path.path;Dt?(Pt=Dt.dragging?Dt.dragging[0]:n,Ot=Dt.dragging?Dt.dragging[1]:s):(Pt=n,Ot=s),v=svgedit.math.snapToAngle(Pt,Ot,x,y),x=v.x,y=v.y}ut&&"none"!==ut.getAttribute("display")&&(j*=c,H*=c,svgedit.utilities.assignAttributes(ut,{x:Math.min(l*c,j),y:Math.min(g*c,H),width:Math.abs(j-l*c),height:Math.abs(H-g*c)},100)),wt.mouseMove(x,y);break;case"textedit":x*=c,y*=c,Ct.mouseMove(U,z);break;case"rotate":D=svgedit.utilities.getBBox(R),S=D.x+D.width/2,B=D.y+D.height/2;var Rt=svgedit.math.getMatrix(R),Vt=svgedit.math.transformPoint(S,B,Rt);if(S=Vt.x,B=Vt.y,P=(Math.atan2(B-y,S-x)*(180/Math.PI)-90)%360,a.gridSnapping&&(P=svgedit.utilities.snapToGrid(P)),t.shiftKey){var Ut=45;P=Math.round(P/Ut)*Ut}o.setRotationAngle(P<-180?360+P:P,!0),O("transition",b)}pt("mouseMove",{event:t,mouse_x:U,mouse_y:z,selected:R})}},P=function(t){if(2!==t.button){var e=ht;if(ht=null,nt){var i=svgedit.math.transformPoint(t.pageX,t.pageY,It),r=i.x*c,n=i.y*c,s=r/c,d=n/c,h=svgedit.utilities.getElem(bt()),v=!1,y=s,x=d,k=!1;nt=!1;var E,T;switch(st){case"resize":case"multiselect":null!=ut&&(ut.setAttribute("display","none"),mt=[]),st="select";case"select":if(null!=b[0]){if(null==b[1]){var _=b[0];switch(_.tagName){case"g":case"use":case"image":case"foreignObject":break;default:gt.fill=_.getAttribute("fill"),gt.fill_opacity=_.getAttribute("fill-opacity"),gt.stroke=_.getAttribute("stroke"),gt.stroke_opacity=_.getAttribute("stroke-opacity"),gt.stroke_width=_.getAttribute("stroke-width"),gt.stroke_dasharray=_.getAttribute("stroke-dasharray"),gt.stroke_linejoin=_.getAttribute("stroke-linejoin"),gt.stroke_linecap=_.getAttribute("stroke-linecap")}"text"==_.tagName&&(dt.font_size=_.getAttribute("font-size"),dt.font_family=_.getAttribute("font-family"),dt.text_anchor=_.getAttribute("text-anchor")),W.requestSelector(_).showGrips(!0)}if(_t(),y!=l||x!=g){var B,G=b.length;for(B=0;B<G&&null!=b[B];++B)b[B].firstChild||W.requestSelector(b[B]).resize()}else T=t.target,"path"===b[0].nodeName&&null==b[1]?wt.select(b[0]):t.shiftKey&&e!=T&&o.removeFromSelection([T]);if(svgedit.browser.supportsNonScalingStroke()){var I=b[0];I&&(I.removeAttribute("style"),svgedit.utilities.walkTree(I,function(t){t.parentElement&&"foreignObject"===t.parentElement.nodeName||t.removeAttribute("style")}))}var M=pt("mouseUp",{event:t,mouse_x:r,mouse_y:n,selected:b[0]})}return;case"zoom":null!=ut&&ut.setAttribute("display","none");var P=t.shiftKey?.5:2;return void O("zoomed",{x:Math.min(l,y),y:Math.min(g,x),width:Math.abs(y-l),height:Math.abs(x-g),factor:P});case"fhpath":f=0,C={x:0,y:0},w={x:0,y:0},N={x:0,y:0},A={x:0,y:0};var D=h.getAttribute("points"),R=D.indexOf(",");v=R>=0?D.indexOf(",",R+1)>=0:D.indexOf(" ",D.indexOf(" ")+1)>=0,v&&(h=wt.smoothPolylineIntoPath(h));break;case"line":E=$(h).attr(["x1","x2","y1","y2"]),v=E.x1!=E.x2||E.y1!=E.y2;break;case"foreignObject":case"square":case"rect":case"image":E=$(h).attr(["width","height"]),v=0!=E.width||0!=E.height||"image"===st;break;case"circle":v=0!=h.getAttribute("r");break;case"ellipse":E=$(h).attr(["rx","ry"]),v=null!=E.rx||null!=E.ry;break;case"fhellipse":u.maxx-u.minx>0&&u.maxy-u.miny>0&&(h=S({element:"ellipse",curStyles:!0,attr:{cx:(u.minx+u.maxx)/2,cy:(u.miny+u.maxy)/2,rx:(u.maxx-u.minx)/2,ry:(u.maxy-u.miny)/2,id:bt()}}),O("changed",[h]),v=!0);break;case"fhrect":u.maxx-u.minx>0&&u.maxy-u.miny>0&&(h=S({element:"rect",curStyles:!0,attr:{x:u.minx,y:u.miny,width:u.maxx-u.minx,height:u.maxy-u.miny,id:bt()}}),O("changed",[h]),v=!0);break;case"text":v=!0,$t([h]),Ct.start(h);break;case"path":h=null,nt=!0;var V=wt.mouseUp(t,h,r,n);h=V.element,v=V.keep;break;case"pathedit":v=!0,h=null,wt.mouseUp(t);break;case"textedit":v=!1,h=null,Ct.mouseUp(t,r,n);break;case"rotate":v=!0,h=null,st="select";var U=o.undoMgr.finishUndoableChange();U.isEmpty()||q(U),_t(),O("changed",b)}var M=pt("mouseUp",{event:t,mouse_x:r,mouse_y:n},!0);if($.each(M,function(t,e){e&&(v=e.keep||v,h=e.element,nt=e.started||nt)}),v||null==h){if(null!=h){o.addedNew=!0,k&&svgedit.units.convertAttrs(h);var z,F=.2;if(J.beginElement&&h.getAttribute("opacity")!=p.opacity){z=$(J).clone().attr({to:p.opacity,dur:F}).appendTo(h);try{z[0].beginElement()}catch(t){}}else F=0;setTimeout(function(){z&&z.remove(),h.setAttribute("opacity",p.opacity),h.setAttribute("style","pointer-events:inherit"),L(h),"path"===st?wt.toEditMode(h):a.selectNew&&$t([h],!0),q(new svgedit.history.InsertElementCommand(h)),O("changed",[h])},1e3*F)}}else{for(m().releaseId(bt()),h.parentNode.removeChild(h),h=null,T=t.target;"g"==T.parentNode.parentNode.tagName;)T=T.parentNode;"path"==st&&drawn_path||"selectorParentGroup"==T.parentNode.id||"svgcanvas"==T.id||"svgroot"==T.id||(o.setMode("select"),$t([T],!0))}at=null}}},D=function(t){var e=t.target,i=e.parentNode;if(i!==v){var r=Pt(t),n=r.tagName;if("text"===n&&"textedit"!==st){var a=svgedit.math.transformPoint(t.pageX,t.pageY,It);Ct.select(r,a.x,a.y)}"g"!==n&&"a"!==n||!svgedit.utilities.getRotationAngle(r)||(Jt(r),r=b[0],Mt(!0)),v&&jt(),"g"!==i.tagName&&"a"!==i.tagName||i===m().getCurrentLayer()||r===W.selectorParentGroup||Ht(r)}},R=function(t){return t.preventDefault(),!1};$(t).mousedown(I).mousemove(M).click(R).dblclick(D).mouseup(P),$(t).bind("mousewheel DOMMouseScroll",function(t){t.preventDefault();var e=t.originalEvent;It=$("#svgcontent g")[0].getScreenCTM().inverse();var i=svgedit.math.transformPoint(e.pageX,e.pageY,It),r={x:i.x,y:i.y,width:0,height:0},n=e.wheelDelta?e.wheelDelta:e.detail?-e.detail:0;n&&(r.factor=Math.max(.75,Math.min(4/3,n)),console.log("f:"+r.factor+"  d:"+n+"  w:"+e.wheelDelta+"  e:"+e.detail),O("zoomed",r))})})();var Ot=function(t){$(t).click(function(t){t.preventDefault()})};Ct=o.textActions=function(){function t(t){var e=""===m.value;if($(m).focus(),!arguments.length)if(e)t=0;else{if(m.selectionEnd!==m.selectionStart)return;t=m.selectionEnd}var i;i=N[t],e||m.setSelectionRange(t,t),v=svgedit.utilities.getElem("text_cursor"),
v||(v=document.createElementNS(n.SVG,"line"),svgedit.utilities.assignAttributes(v,{id:"text_cursor",stroke:"#333","stroke-width":1}),v=svgedit.utilities.getElem("selectorParentGroup").appendChild(v)),p||(p=setInterval(function(){var t="none"===v.getAttribute("display");v.setAttribute("display",t?"inline":"none")},600));var r=l(i.x,y.y),a=l(i.x,y.y+y.height);svgedit.utilities.assignAttributes(v,{x1:r.x,y1:r.y,x2:a.x,y2:a.y,visibility:"visible",display:"inline"}),f&&f.setAttribute("d","")}function e(e,i,r){if(e===i)return void t(i);r||m.setSelectionRange(e,i),f=svgedit.utilities.getElem("text_selectblock"),f||(f=document.createElementNS(n.SVG,"path"),svgedit.utilities.assignAttributes(f,{id:"text_selectblock",fill:"green",opacity:.5,style:"pointer-events:none"}),svgedit.utilities.getElem("selectorParentGroup").appendChild(f));var a=N[e],s=N[i];v.setAttribute("visibility","hidden");var o=l(a.x,y.y),d=l(a.x+(s.x-a.x),y.y),g=l(a.x,y.y+y.height),h=l(a.x+(s.x-a.x),y.y+y.height),u="M"+o.x+","+o.y+" L"+d.x+","+d.y+" "+h.x+","+h.y+" "+g.x+","+g.y+"z";svgedit.utilities.assignAttributes(f,{d:u,display:"inline"})}function i(t,e){var i=d.createSVGPoint();if(i.x=t,i.y=e,1==N.length)return 0;var r=u.getCharNumAtPosition(i);r<0?(r=N.length-2,t<=N[0].x&&(r=0)):r>=N.length-2&&(r=N.length-2);var n=N[r],a=n.x+n.width/2;return t>a&&r++,r}function r(e,r){t(i(e,r))}function a(t,r,n){var a=m.selectionStart,s=i(t,r),o=Math.min(a,s),l=Math.max(a,s);e(o,l,!n)}function s(t,e){var i={x:t,y:e};if(i.x/=c,i.y/=c,x){var r=svgedit.math.transformPoint(i.x,i.y,x.inverse());i.x=r.x,i.y=r.y}return i}function l(t,e){var i={x:t,y:e};if(x){var r=svgedit.math.transformPoint(i.x,i.y,x);i.x=r.x,i.y=r.y}return i.x*=c,i.y*=c,i}function g(t){e(0,u.textContent.length),$(this).unbind(t)}function h(t){if(w&&u){var r=svgedit.math.transformPoint(t.pageX,t.pageY,It),n=r.x*c,a=r.y*c,o=s(n,a),l=i(o.x,o.y),d=u.textContent,h=d.substr(0,l).replace(/[a-z0-9]+$/i,"").length,m=d.substr(l).match(/^[a-z0-9]+/i),v=(m?m[0].length:0)+l;e(h,v),$(t.target).click(g),setTimeout(function(){$(t.target).unbind("click",g)},300)}}var u,m,v,f,p,y,x,S,C,w,N=[];return{select:function(t,e,i){u=t,Ct.toEditMode(e,i)},start:function(t){u=t,Ct.toEditMode()},mouseDown:function(t,e,i,n){var a=s(i,n);m.focus(),r(a.x,a.y),S=i,C=n},mouseMove:function(t,e){var i=s(t,e);a(i.x,i.y)},mouseUp:function(t,e,i){var r=s(e,i);a(r.x,r.y,!0),t.target!==u&&e<S+2&&e>S-2&&i<C+2&&i>C-2&&Ct.toSelectMode(!0)},setCursor:t,toEditMode:function(e,i){w=!1,st="textedit",W.requestSelector(u).showGrips(!1);W.requestSelector(u).selectorRect;if(Ct.init(),$(u).css("cursor","text"),arguments.length){var n=s(e,i);r(n.x,n.y)}else t();setTimeout(function(){w=!0},300)},toSelectMode:function(t){st="select",clearInterval(p),p=null,f&&$(f).attr("display","none"),v&&$(v).attr("visibility","hidden"),$(u).css("cursor","move"),t&&(Mt(),$(u).css("cursor","move"),O("selected",[u]),Lt([u],!0)),u&&!u.textContent.length&&o.deleteSelectedElements(),$(m).blur(),u=!1},setInputElem:function(t){m=t},clear:function(){"textedit"==st&&Ct.toSelectMode()},init:function(t){if(u){var i,r;u.parentNode||(u=b[0],W.requestSelector(u).showGrips(!1));var n=u.textContent,a=n.length,s=u.getAttribute("transform");for(y=svgedit.utilities.getBBox(u),x=s?svgedit.math.getMatrix(u):null,N=[],N.length=a,m.focus(),$(u).unbind("dblclick",h).dblclick(h),a||(r={x:y.x+y.width/2,width:0}),i=0;i<a;i++){var l=u.getStartPositionOfChar(i);if(r=u.getEndPositionOfChar(i),!svgedit.browser.supportsGoodTextCharPos()){var d=o.contentW*c;l.x-=d,r.x-=d,l.x/=c,r.x/=c}N[i]={x:l.x,y:y.y,width:r.x-l.x,height:y.height}}N.push({x:r.x,width:0}),e(m.selectionStart,m.selectionEnd,!0)}}}}(),wt=o.pathActions=function(){function e(t){t.setAttribute("d",wt.convertPath(t))}var i,s,l,d=!1;svgedit.path.Path.prototype.endChanges=function(t){svgedit.browser.isWebkit()&&e(this.elem);var i=new svgedit.history.ChangeElementCommand(this.elem,{d:this.last_d},t);q(i),O("changed",[this.elem])},svgedit.path.Path.prototype.addPtsToSelection=function(t){var e,i;for($.isArray(t)||(t=[t]),e=0;e<t.length;e++){var r=t[e];i=this.segs[r],i.ptgrip&&this.selected_pts.indexOf(r)==-1&&r>=0&&this.selected_pts.push(r)}this.selected_pts.sort(),e=this.selected_pts.length;var n=[];for(n.length=e;e--;){var a=this.selected_pts[e];i=this.segs[a],i.select(!0),n[e]=i.ptgrip}wt.canDeleteNodes=!0,wt.closed_subpath=this.subpathIsClosed(this.selected_pts[0]),O("selected",n)},i=null;var g=null,h=!1,u=function(t){var e,i=t.points,r=i.numberOfItems;if(r>=4){var n=i.getItem(0),a=null,s=[];for(s.push(["M",n.x,",",n.y," C"].join("")),e=1;e<=r-4;e+=3){var o=i.getItem(e),l=i.getItem(e+1),d=i.getItem(e+2);if(a){var g=svgedit.path.smoothControlPoints(a,o,n);if(g&&2==g.length){var h=s[s.length-1].split(",");h[2]=g[0].x,h[3]=g[0].y,s[s.length-1]=h.join(","),o=g[1]}}s.push([o.x,o.y,l.x,l.y,d.x,d.y].join(",")),n=d,a=l}for(s.push("L");e<r;){var u=i.getItem(e);s.push([u.x,u.y].join(",")),e++}s=s.join(" "),t=S({element:"path",curStyles:!0,attr:{id:bt(),d:s,fill:"none"}})}return t};return{mouseDown:function(e,i,r,o){var l;if("path"!==st){if(svgedit.path.path){svgedit.path.path.storeD(),l=e.target.id;var h;if("pathpointgrip_"==l.substr(0,14)){h=svgedit.path.path.cur_pt=parseInt(l.substr(14)),svgedit.path.path.dragging=[r,o];var u=svgedit.path.path.segs[h];e.shiftKey?u.selected?svgedit.path.path.removePtFromSelection(h):svgedit.path.path.addPtsToSelection(h):((svgedit.path.path.selected_pts.length<=1||!u.selected)&&svgedit.path.path.clearSelection(),svgedit.path.path.addPtsToSelection(h))}else if(0==l.indexOf("ctrlpointgrip_")){svgedit.path.path.dragging=[r,o];var m=l.split("_")[1].split("c");h=Number(m[0]);var v=Number(m[1]);svgedit.path.path.selectPt(h,v)}svgedit.path.path.dragging||(null==ut&&(ut=W.getRubberBandBox()),svgedit.utilities.assignAttributes(ut,{x:r*c,y:o*c,width:0,height:0,display:"inline"},100))}}else{mouse_x=r,mouse_y=o;var f=mouse_x/c,y=mouse_y/c,x=svgedit.utilities.getElem("path_stretch_line");s=[f,y],a.gridSnapping&&(f=svgedit.utilities.snapToGrid(f),y=svgedit.utilities.snapToGrid(y),mouse_x=svgedit.utilities.snapToGrid(mouse_x),mouse_y=svgedit.utilities.snapToGrid(mouse_y)),x||(x=document.createElementNS(n.SVG,"path"),svgedit.utilities.assignAttributes(x,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"}),x=svgedit.utilities.getElem("selectorParentGroup").appendChild(x)),x.setAttribute("display","inline");var b,C=null;if(g){for(var w=g.pathSegList,N=w.numberOfItems,A=6/c,k=!1;N;){N--;var E=w.getItem(N),T=E.x,_=E.y;if(f>=T-A&&f<=T+A&&y>=_-A&&y<=_+A){k=!0;break}}l=bt(),svgedit.path.removePath_(l);var B,G,I=svgedit.utilities.getElem(l),M=w.numberOfItems;if(k){if(N<=1&&M>=2){var L=w.getItem(0).x,P=w.getItem(0).y;G=x.pathSegList.getItem(1),B=4===G.pathSegType?g.createSVGPathSegLinetoAbs(L,P):g.createSVGPathSegCurvetoCubicAbs(L,P,G.x1/c,G.y1/c,L,P);var O=g.createSVGPathSegClosePath();w.appendItem(B),w.appendItem(O)}else if(M<3)return C=!1;if($(x).remove(),element=I,g=null,nt=!1,d){svgedit.path.path.matrix&&svgedit.coords.remapElement(I,{},svgedit.path.path.matrix.inverse());var D=I.getAttribute("d"),R=$(svgedit.path.path.elem).attr("d");return $(svgedit.path.path.elem).attr("d",R+D),$(I).remove(),svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath(),svgedit.path.path.init(),wt.toEditMode(svgedit.path.path.elem),svgedit.path.path.selectPt(),!1}}else{if(!$.contains(t,Pt(e)))return console.log("Clicked outside canvas"),!1;var V=g.pathSegList.numberOfItems,U=g.pathSegList.getItem(V-1),z=U.x,F=U.y;if(e.shiftKey){var j=svgedit.math.snapToAngle(z,F,f,y);f=j.x,y=j.y}G=x.pathSegList.getItem(1),B=4===G.pathSegType?g.createSVGPathSegLinetoAbs(yt(f),yt(y)):g.createSVGPathSegCurvetoCubicAbs(yt(f),yt(y),G.x1/c,G.y1/c,G.x2/c,G.y2/c),g.pathSegList.appendItem(B),f*=c,y*=c,x.setAttribute("d",["M",f,y,f,y].join(" ")),b=V,d&&(b+=svgedit.path.path.segs.length),svgedit.path.addPointGrip(b,f,y)}}else d_attr="M"+f+","+y+" ",g=S({element:"path",curStyles:!0,attr:{d:d_attr,id:St(),opacity:p.opacity/2}}),x.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" ")),b=d?svgedit.path.path.segs.length:0,svgedit.path.addPointGrip(b,mouse_x,mouse_y)}},mouseMove:function(t,e){if(h=!0,"path"!==st)if(svgedit.path.path.dragging){var i=svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path),r=svgedit.path.getPointFromGrip({x:t,y:e},svgedit.path.path),n=r.x-i.x,a=r.y-i.y;svgedit.path.path.dragging=[t,e],svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(n,a):svgedit.path.path.movePts(n,a)}else svgedit.path.path.selected_pts=[],svgedit.path.path.eachSeg(function(t){var e=this;if(e.next||e.prev){var i=(e.item,ut.getBBox()),r=svgedit.path.getGripPt(e),n={x:r.x,y:r.y,width:0,height:0},a=svgedit.math.rectsIntersect(i,n);this.select(a),a&&svgedit.path.path.selected_pts.push(e.index)}});else{if(!g)return;var o=g.pathSegList,d=o.numberOfItems-1;if(s){var u=svgedit.path.addCtrlGrip("1c1"),m=svgedit.path.addCtrlGrip("0c2");u.setAttribute("cx",t),u.setAttribute("cy",e),u.setAttribute("display","inline");var v=s[0],f=s[1],p=(o.getItem(d),t/c),y=e/c,x=v+(v-p),b=f+(f-y);m.setAttribute("cx",x*c),m.setAttribute("cy",b*c),m.setAttribute("display","inline");var S=svgedit.path.getCtrlLine(1);if(svgedit.utilities.assignAttributes(S,{x1:t,y1:e,x2:x*c,y2:b*c,display:"inline"}),0===d)l=[t,e];else{var C=o.getItem(d-1),w=C.x,N=C.y;6===C.pathSegType?(w+=w-C.x2,N+=N-C.y2):l&&(w=l[0]/c,N=l[1]/c),svgedit.path.replacePathSeg(6,d,[v,f,w,N,x,b],g)}}else{var A=svgedit.utilities.getElem("path_stretch_line");if(A){var k=o.getItem(d);if(6===k.pathSegType){var E=k.x+(k.x-k.x2),T=k.y+(k.y-k.y2);svgedit.path.replacePathSeg(6,1,[t,e,E*c,T*c,t,e],A)}else l?svgedit.path.replacePathSeg(6,1,[t,e,l[0],l[1],t,e],A):svgedit.path.replacePathSeg(4,1,[t,e],A)}}}},mouseUp:function(t,e,i,r){if("path"===st)return s=null,g||(e=svgedit.utilities.getElem(bt()),nt=!1,l=null),{keep:!0,element:e};if(svgedit.path.path.dragging){var n=svgedit.path.path.cur_pt;svgedit.path.path.dragging=!1,svgedit.path.path.dragctrl=!1,svgedit.path.path.update(),h&&svgedit.path.path.endChanges("Move path point(s)"),t.shiftKey||h||svgedit.path.path.selectPt(n)}else ut&&"none"!=ut.getAttribute("display")?(ut.setAttribute("display","none"),ut.getAttribute("width")<=2&&ut.getAttribute("height")<=2&&wt.toSelectMode(t.target)):wt.toSelectMode(t.target);h=!1},toEditMode:function(t){svgedit.path.path=svgedit.path.getPath_(t),st="pathedit",Mt(),svgedit.path.path.show(!0).update(),svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem),d=!1},toSelectMode:function(t){var e=t==svgedit.path.path.elem;st="select",svgedit.path.path.show(!1),i=!1,Mt(),svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath(),e&&(O("selected",[t]),Lt([t],!0))},addSubPath:function(t){t?(st="path",d=!0):(wt.clear(!0),wt.toEditMode(svgedit.path.path.elem))},select:function(t){i===t?(wt.toEditMode(t),st="pathedit"):i=t},reorient:function(){var t=b[0];if(t){var e=svgedit.utilities.getRotationAngle(t);if(0!=e){var i=new svgedit.history.BatchCommand("Reorient path"),r={d:t.getAttribute("d"),transform:t.getAttribute("transform")};i.addSubCommand(new svgedit.history.ChangeElementCommand(t,r)),Mt(),this.resetOrientation(t),q(i),svgedit.path.getPath_(t).show(!1).matrix=null,this.clear(),Lt([t],!0),O("changed",b)}}},clear:function(t){if(i=null,g){var e=svgedit.utilities.getElem(bt());$(svgedit.utilities.getElem("path_stretch_line")).remove(),$(e).remove(),$(svgedit.utilities.getElem("pathpointgrip_container")).find("*").attr("display","none"),g=l=null,nt=!1}else"pathedit"==st&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(!1)},resetOrientation:function(t){if(null==t||"path"!=t.nodeName)return!1;var e=svgedit.transformlist.getTransformList(t),i=svgedit.math.transformListToTransform(e).matrix;e.clear(),t.removeAttribute("transform");var n,a=t.pathSegList,s=a.numberOfItems;for(n=0;n<s;++n){var o=a.getItem(n),l=o.pathSegType;if(1!=l){var d=[];$.each(["",1,2],function(t,e){var r=o["x"+e],n=o["y"+e];if(void 0!==r&&void 0!==n){var a=svgedit.math.transformPoint(r,n,i);d.splice(d.length,0,a.x,a.y)}}),svgedit.path.replacePathSeg(l,n,d,t)}}r(t,i)},zoomChange:function(){"pathedit"==st&&svgedit.path.path.update()},getNodePoint:function(){var t=svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1,e=svgedit.path.path.segs[t];return{x:e.item.x,y:e.item.y,type:e.type}},linkControlPoints:function(t){svgedit.path.setLinkControlPoints(t)},clonePathNode:function(){svgedit.path.path.storeD();for(var t=svgedit.path.path.selected_pts,e=(svgedit.path.path.segs,t.length),i=[];e--;){var r=t[e];svgedit.path.path.addSeg(r),i.push(r+e),i.push(r+e+1)}svgedit.path.path.init().addPtsToSelection(i),svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var t=svgedit.path.path.selected_pts;if(1===t.length){var e=svgedit.path.path.elem,i=e.pathSegList,r=(i.numberOfItems,t[0]),n=null,a=null;if(svgedit.path.path.eachSeg(function(t){return 2===this.type&&t<=r&&(a=this.item),t<=r||(2===this.type?(n=t,!1):1===this.type?(n=!1,!1):void 0)}),null==n&&(n=svgedit.path.path.segs.length-1),n!==!1){var s=e.createSVGPathSegLinetoAbs(a.x,a.y),o=e.createSVGPathSegClosePath();return n==svgedit.path.path.segs.length-1?(i.appendItem(s),i.appendItem(o)):(svgedit.path.insertItemBefore(e,o,n),svgedit.path.insertItemBefore(e,s,n)),void svgedit.path.path.init().selectPt(n+1)}var l=svgedit.path.path.segs[r];if(l.mate)return i.removeItem(r),i.removeItem(r),void svgedit.path.path.init().selectPt(r-1);var d,g,h;for(d=0;d<i.numberOfItems;d++){var u=i.getItem(d);if(2===u.pathSegType)g=d;else if(d===r)i.removeItem(g);else if(1===u.pathSegType&&r<d){h=d-1,i.removeItem(d);break}}for(var m=r-g-1;m--;)svgedit.path.insertItemBefore(e,i.getItem(g),h);var c=i.getItem(g);svgedit.path.replacePathSeg(2,g,[c.x,c.y]),d=r,svgedit.path.path.init().selectPt(0)}},deletePathNode:function(){if(wt.canDeleteNodes){svgedit.path.path.storeD();for(var t=svgedit.path.path.selected_pts,e=t.length;e--;){var i=t[e];svgedit.path.path.deleteSeg(i)}var r=function(){var t=svgedit.path.path.elem.pathSegList,e=t.numberOfItems,i=function(e,i){for(;i--;)t.removeItem(e)};if(e<=1)return!0;for(;e--;){var n=t.getItem(e);if(1===n.pathSegType){var a=t.getItem(e-1),s=t.getItem(e-2);if(2===a.pathSegType){i(e-1,2),r();break}if(2===s.pathSegType){i(e-2,3),r();break}}else if(2===n.pathSegType&&e>0){var o=t.getItem(e-1).pathSegType;if(2===o){i(e-1,1),r();break}if(1===o&&t.numberOfItems-1===e){i(e,1),r();break}}}return!1};if(r(),svgedit.path.path.elem.pathSegList.numberOfItems<=1)return wt.toSelectMode(svgedit.path.path.elem),void o.deleteSelectedElements();if(svgedit.path.path.init(),svgedit.path.path.clearSelection(),window.opera){var n=$(svgedit.path.path.elem);n.attr("d",n.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}},smoothPolylineIntoPath:u,setSegType:function(t){svgedit.path.path.setSegType(t)},moveNode:function(t,e){var i=svgedit.path.path.selected_pts;if(i.length){svgedit.path.path.storeD();var r=svgedit.path.path.segs[i[0]],n={x:0,y:0};n[t]=e-r.item[t],r.move(n.x,n.y),svgedit.path.path.endChanges("Move path point")}},fixEnd:function(t){var i,r,n=t.pathSegList,a=n.numberOfItems;for(i=0;i<a;++i){var s=n.getItem(i);if(2===s.pathSegType&&(r=s),1===s.pathSegType){var o=n.getItem(i-1);if(o.x!=r.x||o.y!=r.y){var l=t.createSVGPathSegLinetoAbs(r.x,r.y);svgedit.path.insertItemBefore(t,l,i),wt.fixEnd(t);break}}}svgedit.browser.isWebkit()&&e(t)},convertPath:function(t,e){var i,r=t.pathSegList,n=r.numberOfItems,a=0,s=0,o="",l=null;for(i=0;i<n;++i){var d=r.getItem(i),g=d.x||0,h=d.y||0,u=d.x1||0,m=d.y1||0,c=d.x2||0,v=d.y2||0,f=d.pathSegType,p=Bt[f]["to"+(e?"Lower":"Upper")+"Case"](),y=function(t,e,i){e=e?" "+e.join(" "):"",i=i?" "+svgedit.units.shortFloat(i):"",$.each(t,function(e,i){t[e]=svgedit.units.shortFloat(i)}),o+=p+t.join(" ")+e+i};switch(f){case 1:o+="z";break;case 12:g-=a;case 13:e?(a+=g,p="l"):(g+=a,a=g,p="L"),y([[g,s]]);break;case 14:h-=s;case 15:e?(s+=h,p="l"):(h+=s,s=h,p="L"),y([[a,h]]);break;case 2:case 4:case 18:g-=a,h-=s;case 5:case 3:l&&1===r.getItem(i-1).pathSegType&&!e&&(a=l[0],s=l[1]);case 19:e?(a+=g,s+=h):(g+=a,h+=s,a=g,s=h),3===f&&(l=[a,s]),y([[g,h]]);break;case 6:g-=a,u-=a,c-=a,h-=s,m-=s,v-=s;case 7:e?(a+=g,s+=h):(g+=a,u+=a,c+=a,h+=s,m+=s,v+=s,a=g,s=h),y([[u,m],[c,v],[g,h]]);break;case 8:g-=a,u-=a,h-=s,m-=s;case 9:e?(a+=g,s+=h):(g+=a,u+=a,h+=s,m+=s,a=g,s=h),y([[u,m],[g,h]]);break;case 10:g-=a,h-=s;case 11:e?(a+=g,s+=h):(g+=a,h+=s,a=g,s=h),y([[d.r1,d.r2]],[d.angle,d.largeArcFlag?1:0,d.sweepFlag?1:0],[g,h]);break;case 16:g-=a,c-=a,h-=s,v-=s;case 17:e?(a+=g,s+=h):(g+=a,c+=a,h+=s,v+=s,a=g,s=h),y([[c,v],[g,h]])}}return o}}}();var Dt=this.removeUnusedDefElems=function(){var t=g.getElementsByTagNameNS(n.SVG,"defs");if(!t||!t.length)return 0;var e,i,r=[],a=0,s=["fill","stroke","filter","marker-start","marker-mid","marker-end"],o=s.length,l=g.getElementsByTagNameNS(n.SVG,"*"),d=l.length;for(e=0;e<d;e++){var h=l[e];for(i=0;i<o;i++){var u=svgedit.utilities.getUrlFromAttr(h.getAttribute(s[i]));u&&r.push(u.substr(1))}var m=_(h);m&&0===m.indexOf("#")&&r.push(m.substr(1))}var c=$(t).find("linearGradient, radialGradient, filter, marker, svg, symbol");for(e=c.length;e--;){var v=c[e],f=v.id;r.indexOf(f)<0&&(ft[f]=v,v.parentNode.removeChild(v),a++)}return a};this.svgCanvasToString=function(){for(;Dt()>0;);wt.clear(!0),$.each(g.childNodes,function(t,e){t&&8===e.nodeType&&e.data.indexOf("Created with")>=0&&g.insertBefore(e,g.firstChild)}),v&&(jt(),$t([v]));var t=[];$(g).find("g:data(gsvg)").each(function(){var e,i=this.attributes,r=i.length;for(e=0;e<r;e++)"id"!=i[e].nodeName&&"style"!=i[e].nodeName||r--;if(r<=0){var n=this.firstChild;t.push(n),$(this).replaceWith(n)}});var e=this.svgToString(g,0);return t.length&&$(t).each(function(){kt(this)}),e},this.svgToString=function(t,e){var i=[],r=svgedit.utilities.toXml,s=a.baseUnit,o=new RegExp("^-?[\\d\\.]+"+s+"$");if(t){L(t);var l,d,g=t.attributes,h=t.childNodes;for(d=0;d<e;d++)i.push(" ");if(i.push("<"),i.push(t.nodeName),"svgcontent"===t.id){var u=qt(),m="";"px"!==s&&(u.w=svgedit.units.convertUnit(u.w,s)+s,u.h=svgedit.units.convertUnit(u.h,s)+s),i.push(' width="'+u.w+'" height="'+u.h+'"'+m+' xmlns="'+n.SVG+'"');var c={};$(t).find("*").andSelf().each(function(){var t=this.namespaceURI;t&&!c[t]&&R[t]&&"xmlns"!==R[t]&&"xml"!==R[t]&&(c[t]=!0,i.push(" xmlns:"+R[t]+'="'+t+'"')),$.each(this.attributes,function(t,e){var r=e.namespaceURI;r&&!c[r]&&"xmlns"!==R[r]&&"xml"!==R[r]&&(c[r]=!0,i.push(" xmlns:"+R[r]+'="'+r+'"'))})}),d=g.length;for(var v=["width","height","xmlns","x","y","viewBox","id","overflow"];d--;){l=g.item(d);var f=r(l.value);0!==l.nodeName.indexOf("xmlns:")&&""!=f&&v.indexOf(l.localName)==-1&&(l.namespaceURI&&!R[l.namespaceURI]||(i.push(" "),i.push(l.nodeName),i.push('="'),i.push(f),i.push('"')))}}else{if("defs"===t.nodeName&&!t.firstChild)return;var p=["-moz-math-font-style","_moz-math-font-style"];for(d=g.length-1;d>=0;d--){l=g.item(d);var f=r(l.value);if(!(p.indexOf(l.localName)>=0)&&""!=f){if(0===f.indexOf("pointer-events"))continue;if("class"===l.localName&&0===f.indexOf("se_"))continue;if(i.push(" "),"d"===l.localName&&(f=wt.convertPath(t,!1)),isNaN(f)?o.test(f)&&(f=svgedit.units.shortFloat(f)+s):f=svgedit.units.shortFloat(f),rt.apply&&"image"===t.nodeName&&"href"===l.localName&&rt.images&&"embed"===rt.images){var y=tt[f];y&&(f=y)}l.namespaceURI&&l.namespaceURI!=n.SVG&&!R[l.namespaceURI]||(i.push(l.nodeName),i.push('="'),i.push(f),i.push('"'))}}}if(t.hasChildNodes()){i.push(">"),e++;var x=!1;for(d=0;d<h.length;d++){var b=h.item(d);switch(b.nodeType){case 1:i.push("\n"),i.push(this.svgToString(h.item(d),e));break;case 3:var S=b.nodeValue.replace(/^\s+|\s+$/g,"");""!=S&&(x=!0,i.push(String(r(S))));break;case 4:i.push("\n"),i.push(new Array(e+1).join(" ")),i.push("<![CDATA["),i.push(b.nodeValue),i.push("]]>");break;case 8:i.push("\n"),i.push(new Array(e+1).join(" ")),i.push("<!--"),i.push(b.data),i.push("-->")}}if(e--,!x)for(i.push("\n"),d=0;d<e;d++)i.push(" ");i.push("</"),i.push(t.nodeName),i.push(">")}else i.push("/>")}return i.join("")},this.embedImage=function(t,e){$(new Image).load(function(){var i=document.createElement("canvas");i.width=this.width,i.height=this.height,i.getContext("2d").drawImage(this,0,0);try{var r=";svgedit_url="+encodeURIComponent(t);r=i.toDataURL().replace(";base64",r+";base64"),tt[t]=r}catch(e){tt[t]=!1}et=t,e&&e(tt[t])}).attr("src",t)},this.setGoodImage=function(t){et=t},this.open=function(){},this.save=function(t){Mt(),t&&$.extend(rt,t),rt.apply=!0;var e=this.svgCanvasToString();O("saved",e)},this.rasterExport=function(t,e,r){var n="image/"+t.toLowerCase(),a=i(),s=this.svgCanvasToString();svgedit.utilities.buildCanvgCallback(function(){var i=t||"PNG";$("#export_canvas").length||$("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var o=$("#export_canvas")[0];o.width=svgCanvas.contentW,o.height=svgCanvas.contentH,canvg(o,s,{renderCallback:function(){var l=("ICO"===i?"BMP":i).toLowerCase(),d=e?o.toDataURL("image/"+l,e):o.toDataURL("image/"+l);O("exported",{datauri:d,svg:s,issues:a,type:t,mimeType:n,quality:e,exportWindowName:r})}})})()},this.exportPDF=function(t,e){var r=this;svgedit.utilities.buildJSPDFCallback(function(){var n=qt(),a=n.w>n.h?"landscape":"portrait",s="pt",o=jsPDF({orientation:a,unit:s,format:[n.w,n.h]}),l=Wt();o.setProperties({title:l});var d=i(),g=r.svgCanvasToString();o.addSVG(g,0,0);var h={svg:g,issues:d,exportWindowName:t},u=e||"dataurlstring";h[u]=o.output(u),O("exportedPDF",h)})()},this.getSvgString=function(){return rt.apply=!1,this.svgCanvasToString()},this.randomizeIds=function(t){arguments.length>0&&0==t?svgedit.draw.randomizeIds(!1,m()):svgedit.draw.randomizeIds(!0,m())};var Rt=this.uniquifyElems=function(t){var e={},i=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];svgedit.utilities.walkTree(t,function(t){if(1==t.nodeType){t.id&&(t.id in e||(e[t.id]={elem:null,attrs:[],hrefs:[]}),e[t.id].elem=t),$.each(Y,function(i,r){var n=t.getAttributeNode(r);if(n){var a=svgedit.utilities.getUrlFromAttr(n.value),s=a?a.substr(1):null;s&&(s in e||(e[s]={elem:null,attrs:[],hrefs:[]}),e[s].attrs.push(n))}});var r=svgedit.utilities.getHref(t);if(r&&i.indexOf(t.nodeName)>=0){var n=r.substr(1);n&&(n in e||(e[n]={elem:null,attrs:[],hrefs:[]}),e[n].hrefs.push(t))}}});var r;for(r in e)if(r){var n=e[r].elem;if(n){var a=St();n.id=a;for(var s=e[r].attrs,o=s.length;o--;){var l=s[o];l.ownerElement.setAttribute(l.name,"url(#"+a+")")}for(var d=e[r].hrefs,g=d.length;g--;){var h=d[g];svgedit.utilities.setHref(h,"#"+a)}}}},Vt=this.setUseData=function(t){var e=$(t);"use"!==t.tagName&&(e=e.find("use")),e.each(function(){var t=_(this).substr(1),e=svgedit.utilities.getElem(t);e&&($(this).data("ref",e),"symbol"!=e.tagName&&"svg"!=e.tagName||$(this).data("symbol",e).data("ref",e))})},Ut=this.convertGradients=function(t){var e=$(t).find("linearGradient, radialGradient");!e.length&&svgedit.browser.isWebkit()&&(e=$(t).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=0})),e.each(function(){var t=this;if("userSpaceOnUse"===$(t).attr("gradientUnits")){var e=$(g).find('[fill="url(#'+t.id+')"],[stroke="url(#'+t.id+')"]');if(!e.length)return;var i=svgedit.utilities.getBBox(e[0]);if(!i)return;if("linearGradient"===t.tagName){var r=$(t).attr(["x1","y1","x2","y2"]),n=t.gradientTransform.baseVal;if(n&&n.numberOfItems>0){var a=svgedit.math.transformListToTransform(n).matrix,s=svgedit.math.transformPoint(r.x1,r.y1,a),o=svgedit.math.transformPoint(r.x2,r.y2,a);r.x1=s.x,r.y1=s.y,r.x2=o.x,r.y2=o.y,t.removeAttribute("gradientTransform")}$(t).attr({x1:(r.x1-i.x)/i.width,y1:(r.y1-i.y)/i.height,x2:(r.x2-i.x)/i.width,y2:(r.y2-i.y)/i.height}),t.removeAttribute("gradientUnits")}}})},zt=this.convertToGroup=function(t){t||(t=b[0]);var e,i=$(t),r=new svgedit.history.BatchCommand;if(i.data("gsvg")){var a=t.firstChild,s=$(a).attr(["x","y"]);$(t.firstChild.firstChild).unwrap(),$(t).removeData("gsvg");var o=svgedit.transformlist.getTransformList(t),h=d.createSVGTransform();h.setTranslate(s.x,s.y),o.appendItem(h),svgedit.recalculate.recalculateDimensions(t),O("selected",[t])}else if(i.data("symbol")){t=i.data("symbol"),e=i.attr("transform");var u=i.attr(["x","y"]),m=t.getAttribute("viewBox");if(m){var c=m.split(" ");u.x-=+c[0],u.y-=+c[1]}e+=" translate("+(u.x||0)+","+(u.y||0)+")";var v=i.prev();r.addSubCommand(new svgedit.history.RemoveElementCommand(i[0],i[0].nextSibling,i[0].parentNode)),i.remove();var f,p=$(g).find("use:data(symbol)").length,y=l.createElementNS(n.SVG,"g"),x=t.childNodes;for(f=0;f<x.length;f++)y.appendChild(x[f].cloneNode(!0));if(svgedit.browser.isGecko()){var S=$(svgedit.utilities.findDefs()).children("linearGradient,radialGradient,pattern").clone();$(y).append(S)}e&&y.setAttribute("transform",e);var C=t.parentNode;if(Rt(y),svgedit.browser.isGecko()&&$(E()).append($(y).find("linearGradient,radialGradient,pattern")),y.id=St(),v.after(y),C){if(!p){var w=t.nextSibling;C.removeChild(t),r.addSubCommand(new svgedit.history.RemoveElementCommand(t,w,C))}r.addSubCommand(new svgedit.history.InsertElementCommand(y))}Vt(y),Ut(svgedit.browser.isGecko()?svgedit.utilities.findDefs():y),svgedit.utilities.walkTreePost(y,function(t){try{svgedit.recalculate.recalculateDimensions(t)}catch(t){console.log(t)}}),$(y).find(X).each(function(){this.id||(this.id=St())}),$t([y]);var N=Jt(y,!0);N&&r.addSubCommand(N),q(r)}else console.log("Unexpected element to ungroup:",t)};this.setSvgString=function(t){try{var e=svgedit.utilities.text2xml(t);this.prepareSvg(e);var i=new svgedit.history.BatchCommand("Change Source"),r=g.nextSibling,s=d.removeChild(g);i.addSubCommand(new svgedit.history.RemoveElementCommand(s,r,d)),g=l.adoptNode?l.adoptNode(e.documentElement):l.importNode(e.documentElement,!0),d.appendChild(g);var h=$(g);o.current_drawing_=new svgedit.draw.Drawing(g,u);var v=m().getNonce();v?O("setnonce",v):O("unsetnonce"),h.find("image").each(function(){var t=this;Ot(t);var e=_(this);if(e){if(0===e.indexOf("data:")){var i=e.match(/svgedit_url=(.*?);/);if(i){var r=decodeURIComponent(i[1]);$(new Image).load(function(){t.setAttributeNS(n.XLINK,"xlink:href",r)}).attr("src",r)}}o.embedImage(e)}}),h.find("svg").each(function(){if(!$(this).closest("defs").length){Rt(this);var t=this.parentNode;1===t.childNodes.length&&"g"===t.nodeName?($(t).data("gsvg",this),t.id=t.id||St()):kt(this)}}),svgedit.browser.isGecko()&&h.find("linearGradient, radialGradient, pattern").appendTo(svgedit.utilities.findDefs()),Vt(h),Ut(h[0]),svgedit.utilities.walkTreePost(g,function(t){try{svgedit.recalculate.recalculateDimensions(t)}catch(t){console.log(t)}});var f={id:"svgcontent",overflow:a.show_outside_canvas?"visible":"hidden"},p=!1;if(h.attr("viewBox")){var y=h.attr("viewBox").split(" ");f.width=y[2],f.height=y[3]}else $.each(["width","height"],function(t,e){var i=h.attr(e);i||(i="100%"),"%"===String(i).substr(-1)?p=!0:f[e]=svgedit.units.convertToNum(e,i)});if(Ft(),h.children().find(X).each(function(){this.id||(this.id=St())}),p){var x=getStrokedBBox();f.width=x.width+x.x,f.height=x.height+x.y}f.width<=0&&(f.width=100),f.height<=0&&(f.height=100),h.attr(f),this.contentW=f.width,this.contentH=f.height,i.addSubCommand(new svgedit.history.InsertElementCommand(g));var b=h.attr(["width","height"]);i.addSubCommand(new svgedit.history.ChangeElementCommand(d,b)),c=1,svgedit.transformlist.resetListMap(),Mt(),svgedit.path.clearData(),d.appendChild(W.selectorParentGroup),q(i),O("changed",[g])}catch(t){return console.log(t),!1}return!0},this.importSvgString=function(t){var e,i;try{var r=svgedit.utilities.encode64(t.length+t).substr(0,32),a=!1;lt[r]&&$(lt[r].symbol).parents("#svgroot").length&&(a=!0);var s,o=new svgedit.history.BatchCommand("Import Image");if(a)s=lt[r].symbol,i=lt[r].xform;else{var d=svgedit.utilities.text2xml(t);this.prepareSvg(d);var h;h=l.adoptNode?l.adoptNode(d.documentElement):l.importNode(d.documentElement,!0),Rt(h);var u=svgedit.units.convertToNum("width",h.getAttribute("width")),c=svgedit.units.convertToNum("height",h.getAttribute("height")),f=h.getAttribute("viewBox"),p=f?f.split(" "):[0,0,u,c];for(e=0;e<4;++e)p[e]=+p[e];var y=(+g.getAttribute("width"),+g.getAttribute("height"));i=c>u?"scale("+y/3/p[3]+")":"scale("+y/3/p[2]+")",i="translate(0) "+i+" translate(0)",s=l.createElementNS(n.SVG,"symbol");var x=svgedit.utilities.findDefs();for(svgedit.browser.isGecko()&&$(h).find("linearGradient, radialGradient, pattern").appendTo(x);h.firstChild;){var b=h.firstChild;s.appendChild(b)}var S,C=h.attributes;for(S=0;S<C.length;S++){var w=C[S];s.setAttribute(w.nodeName,w.value)}s.id=St(),lt[r]={symbol:s,xform:i},svgedit.utilities.findDefs().appendChild(s),o.addSubCommand(new svgedit.history.InsertElementCommand(s))}var N=l.createElementNS(n.SVG,"use");N.id=St(),B(N,"#"+s.id),(v||m().getCurrentLayer()).appendChild(N),o.addSubCommand(new svgedit.history.InsertElementCommand(N)),Mt(),N.setAttribute("transform",i),svgedit.recalculate.recalculateDimensions(N),$(N).data("symbol",s).data("ref",s),Lt([N]),q(o),O("changed",[g])}catch(t){return console.log(t),!1}return!0};var Ft=o.identifyLayers=function(){jt(),m().identifyLayers()};this.createLayer=function(t){var e=new svgedit.history.BatchCommand("Create Layer"),i=m().createLayer(t);e.addSubCommand(new svgedit.history.InsertElementCommand(i)),q(e),Mt(),O("changed",[i])},this.cloneLayer=function(t){var e=new svgedit.history.BatchCommand("Duplicate Layer"),i=l.createElementNS(n.SVG,"g"),r=l.createElementNS(n.SVG,"title");r.textContent=t,i.appendChild(r);var a=m().getCurrentLayer();$(a).after(i);var s,d=a.childNodes;for(s=0;s<d.length;s++){var g=d[s];"title"!=g.localName&&i.appendChild(Et(g))}Mt(),Ft(),e.addSubCommand(new svgedit.history.InsertElementCommand(i)),q(e),o.setCurrentLayer(t),O("changed",[i])},this.deleteCurrentLayer=function(){var t=m().getCurrentLayer(),e=t.nextSibling,i=t.parentNode;if(t=m().deleteCurrentLayer()){var r=new svgedit.history.BatchCommand("Delete Layer");return r.addSubCommand(new svgedit.history.RemoveElementCommand(t,e,i)),q(r),Mt(),O("changed",[i]),!0}return!1},this.setCurrentLayer=function(t){var e=m().setCurrentLayer(svgedit.utilities.toXml(t));return e&&Mt(),e},this.renameCurrentLayer=function(t){var e,i=m();if(i.current_layer){var r=i.current_layer;if(!o.setCurrentLayer(t)){var n=new svgedit.history.BatchCommand("Rename Layer");for(e=0;e<i.getNumLayers()&&i.all_layers[e][1]!=r;++e);var a=i.getLayerName(e);i.all_layers[e][0]=svgedit.utilities.toXml(t);var s=r.childNodes.length;for(e=0;e<s;++e){var l=r.childNodes.item(e);if(l&&"title"==l.tagName){for(;l.firstChild;)l.removeChild(l.firstChild);return l.textContent=t,n.addSubCommand(new svgedit.history.ChangeElementCommand(l,{"#text":a})),q(n),O("changed",[r]),!0}}}i.current_layer=r}return!1},this.setCurrentLayerPosition=function(t){var e,i=m();if(i.current_layer&&t>=0&&t<i.getNumLayers()){for(e=0;e<i.getNumLayers()&&i.all_layers[e][1]!=i.current_layer;++e);if(e==i.getNumLayers())return!1;if(e!=t){var r=null,n=i.current_layer.nextSibling;return t>e?t<i.getNumLayers()-1&&(r=i.all_layers[t+1][1]):r=i.all_layers[t][1],g.insertBefore(i.current_layer,r),q(new svgedit.history.MoveElementCommand(i.current_layer,n,g)),Ft(),o.setCurrentLayer(i.getLayerName(t)),!0}}return!1},this.setLayerVisibility=function(t,e){var i=m(),r=i.getLayerVisibility(t),n=i.setLayerVisibility(t,e);if(!n)return!1;var a=r?"inline":"none";return q(new svgedit.history.ChangeElementCommand(n,{display:a},"Layer Visibility")),n==i.getCurrentLayer()&&(Mt(),wt.clear()),!0},this.moveSelectedToLayer=function(t){var e,i=null,r=m();for(e=0;e<r.getNumLayers();++e)if(r.getLayerName(e)==t){i=r.all_layers[e][1];break}if(!i)return!1;var n=new svgedit.history.BatchCommand("Move Elements to Layer"),a=b;for(e=a.length;e--;){var s=a[e];if(s){var o=s.nextSibling,l=s.parentNode;i.appendChild(s),n.addSubCommand(new svgedit.history.MoveElementCommand(s,o,l));
}}return q(n),!0},this.mergeLayer=function(t){var e=new svgedit.history.BatchCommand("Merge Layer"),i=m(),r=$(i.current_layer).prev()[0];if(r){var n=i.current_layer.childNodes,a=(n.length,i.current_layer.nextSibling);for(e.addSubCommand(new svgedit.history.RemoveElementCommand(i.current_layer,a,g));i.current_layer.firstChild;){var s=i.current_layer.firstChild;if("title"!=s.localName){var o=s.nextSibling;r.appendChild(s),e.addSubCommand(new svgedit.history.MoveElementCommand(s,o,i.current_layer))}else{var l=s.nextSibling;e.addSubCommand(new svgedit.history.RemoveElementCommand(s,l,i.current_layer)),i.current_layer.removeChild(s)}}return g.removeChild(i.current_layer),t||(Mt(),Ft(),O("changed",[g]),q(e)),i.current_layer=r,e}},this.mergeAllLayers=function(){var t=new svgedit.history.BatchCommand("Merge all Layers"),e=m();for(e.current_layer=e.all_layers[e.getNumLayers()-1][1];$(g).children("g").length>1;)t.addSubCommand(o.mergeLayer(!0));Mt(),Ft(),O("changed",[g]),q(t)};var jt=this.leaveContext=function(){var t,e=it.length;if(e){for(t=0;t<e;t++){var i=it[t],r=Z(i,"orig_opac");1!==r?i.setAttribute("opacity",r):i.removeAttribute("opacity"),i.setAttribute("style","pointer-events: inherit")}it=[],Mt(!0),O("contextset",null)}v=null},Ht=this.setContext=function(t){jt(),"string"==typeof t&&(t=svgedit.utilities.getElem(t)),v=t,$(t).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var t=this.getAttribute("opacity")||1;Z(this,"orig_opac",t),this.setAttribute("opacity",.33*t),this.setAttribute("style","pointer-events: none"),it.push(this)}),Mt(),O("contextset",v)};this.clear=function(){wt.clear(),Mt(),o.clearSvgContentElement(),o.current_drawing_=new svgedit.draw.Drawing(g),o.createLayer("Layer 1"),o.undoMgr.resetUndoStack(),W.initGroup(),ut=W.getRubberBandBox(),O("cleared")},this.linkControlPoints=wt.linkControlPoints,this.getContentElem=function(){return g},this.getRootElem=function(){return d},this.getSelectedElems=function(){return b};var qt=this.getResolution=function(){var t=g.getAttribute("width")/c,e=g.getAttribute("height")/c;return{w:t,h:e,zoom:c}};this.getZoom=function(){return c},this.getVersion=function(){return"svgcanvas.js ($Rev$)"},this.setUiStrings=function(t){$.extend(K,t.notification)},this.setConfig=function(t){$.extend(a,t)},this.getTitle=function(t){var e;if(t=t||b[0]){t=$(t).data("gsvg")||$(t).data("symbol")||t;var i=t.childNodes;for(e=0;e<i.length;e++)if("title"==i[e].nodeName)return i[e].textContent;return""}},this.setGroupTitle=function(t){var e=b[0];e=$(e).data("gsvg")||e;var i=$(e).children("title"),r=new svgedit.history.BatchCommand("Set Label");if(t.length)if(i.length){var a=i[0];r.addSubCommand(new svgedit.history.ChangeElementCommand(a,{"#text":a.textContent})),a.textContent=t}else a=l.createElementNS(n.SVG,"title"),a.textContent=t,$(e).prepend(a),r.addSubCommand(new svgedit.history.InsertElementCommand(a));else{var s=i.nextSibling;r.addSubCommand(new svgedit.history.RemoveElementCommand(i[0],s,e)),i.remove()}q(r)};var Wt=this.getDocumentTitle=function(){return o.getTitle(g)};this.setDocumentTitle=function(t){var e,i=g.childNodes,r=!1,a="",s=new svgedit.history.BatchCommand("Change Image Title");for(e=0;e<i.length;e++)if("title"==i[e].nodeName){r=i[e],a=r.textContent;break}r||(r=l.createElementNS(n.SVG,"title"),g.insertBefore(r,g.firstChild)),t.length?r.textContent=t:r.parentNode.removeChild(r),s.addSubCommand(new svgedit.history.ChangeElementCommand(r,{"#text":a})),q(s)},this.getEditorNS=function(t){return t&&g.setAttribute("xmlns:se",n.SE),n.SE},this.setResolution=function(t,e){var i,r=qt(),n=r.w,a=r.h;if("fit"==t){var s=getStrokedBBox();if(!s)return!1;i=new svgedit.history.BatchCommand("Fit Canvas to Content");var l=Nt();Lt(l);var h=[],u=[];$.each(l,function(t,e){h.push(s.x*-1),u.push(s.y*-1)});var m=o.moveSelectedElements(h,u,!0);i.addSubCommand(m),Mt(),t=Math.round(s.width),e=Math.round(s.height)}if(t!=n||e!=a){var v=d.suspendRedraw(1e3);i||(i=new svgedit.history.BatchCommand("Change Image Dimensions")),t=svgedit.units.convertToNum("width",t),e=svgedit.units.convertToNum("height",e),g.setAttribute("width",t),g.setAttribute("height",e),this.contentW=t,this.contentH=e,i.addSubCommand(new svgedit.history.ChangeElementCommand(g,{width:n,height:a})),g.setAttribute("viewBox",[0,0,t/c,e/c].join(" ")),i.addSubCommand(new svgedit.history.ChangeElementCommand(g,{viewBox:["0 0",n,a].join(" ")})),q(i),d.unsuspendRedraw(v),O("changed",[g])}return!0},this.getOffset=function(){return $(g).attr(["x","y"])},this.setBBoxZoom=function(t,e,i){var r,n=.85,a=function(t){if(!t)return!1;var r=Math.round(e/t.width*100*n)/100,a=Math.round(i/t.height*100*n)/100,s=Math.min(r,a);return o.setZoom(s),{zoom:s,bbox:t}};if("object"==typeof t){if(r=t,0==r.width||0==r.height){var s=r.zoom?r.zoom:c*r.factor;return o.setZoom(s),{zoom:c,bbox:r}}return a(r)}switch(t){case"selection":if(!b[0])return;var l=$.map(b,function(t){if(t)return t});r=getStrokedBBox(l);break;case"canvas":var d=qt();n=.95,r={width:d.w,height:d.h,x:0,y:0};break;case"content":r=getStrokedBBox();break;case"layer":r=getStrokedBBox(Nt(m().getCurrentLayer()));break;default:return}return a(r)},this.setZoom=function(t){var e=qt();g.setAttribute("viewBox","0 0 "+e.w/t+" "+e.h/t),c=t,$.each(b,function(t,e){e&&W.requestSelector(e).resize()}),wt.zoomChange(),pt("zoomChanged",t)},this.getMode=function(){return st},this.setMode=function(t){wt.clear(!0),Ct.clear(),gt=b[0]&&"text"==b[0].nodeName?dt:p,st=t},this.getColor=function(t){return gt[t]},this.setColor=function(t,e,i){function r(t){"g"!=t.nodeName&&n.push(t)}p[t]=e,gt[t+"_paint"]={type:"solidColor"};for(var n=[],a=b.length;a--;){var s=b[a];if(s)if("g"==s.tagName){var o=s.id.substr(0,3);if("GXP"===o)continue;"MTR"===o?svgedit.utilities.walkTree(s,function(e){e.hasAttribute(t)&&"sMTR"!=e.id.substr(0,4)&&n.push(e)}):["CPS","VLA","EHS"].includes(o)?svgedit.utilities.walkTree(s,function(e){e.hasAttribute(t)&&n.push(e)}):svgedit.utilities.walkTree(s,r)}else"fill"==t?"polyline"!=s.tagName&&"line"!=s.tagName&&n.push(s):n.push(s)}n.length>0&&(i?Yt(t,e,n):(Zt(t,e,n),O("changed",n)))};var Kt=this.setGradient=function(t){if(gt[t+"_paint"]&&"solidColor"!=gt[t+"_paint"].type){var e=o[t+"Grad"],i=Xt(e),r=svgedit.utilities.findDefs();if(i)e=i;else{e=r.appendChild(l.importNode(e,!0)),e.id=St()}o.setColor(t,"url(#"+e.id+")")}},Xt=function(t){for(var e=svgedit.utilities.findDefs(),i=$(e).find("linearGradient, radialGradient"),r=i.length,a=["r","cx","cy","fx","fy"];r--;){var s=i[r];if("linearGradient"==t.tagName){if(t.getAttribute("x1")!=s.getAttribute("x1")||t.getAttribute("y1")!=s.getAttribute("y1")||t.getAttribute("x2")!=s.getAttribute("x2")||t.getAttribute("y2")!=s.getAttribute("y2"))continue}else{var o=$(t).attr(a),l=$(s).attr(a),d=!1;if($.each(a,function(t,e){o[e]!=l[e]&&(d=!0)}),d)continue}var g=t.getElementsByTagNameNS(n.SVG,"stop"),h=s.getElementsByTagNameNS(n.SVG,"stop");if(g.length==h.length){for(var u=g.length;u--;){var m=g[u],c=h[u];if(m.getAttribute("offset")!=c.getAttribute("offset")||m.getAttribute("stop-opacity")!=c.getAttribute("stop-opacity")||m.getAttribute("stop-color")!=c.getAttribute("stop-color"))break}if(u==-1)return s}}return null};this.setPaint=function(t,e){var i=new $.jGraduate.Paint(e);switch(this.setPaintOpacity(t,i.alpha/100,!0),gt[t+"_paint"]=i,i.type){case"solidColor":this.setColor(t,"none"!=i.solidColor?"#"+i.solidColor:"none");break;case"linearGradient":case"radialGradient":o[t+"Grad"]=i[i.type],Kt(t)}},this.setStrokePaint=function(t){this.setPaint("stroke",t)},this.setFillPaint=function(t){this.setPaint("fill",t)},this.getStrokeWidth=function(){return gt.stroke_width},this.setStrokeWidth=function(t){function e(t){"g"!=t.nodeName&&i.push(t)}if(0==t&&["line","path"].indexOf(st)>=0)return void o.setStrokeWidth(1);gt.stroke_width=t;for(var i=[],r=b.length;r--;){var n=b[r];n&&("g"==n.tagName?svgedit.utilities.walkTree(n,e):i.push(n))}i.length>0&&(Zt("stroke-width",t,i),O("changed",b))},this.setStrokeAttr=function(t,e){p[t.replace("-","_")]=e;for(var i=[],r=b.length;r--;){var n=b[r];n&&("g"==n.tagName?svgedit.utilities.walkTree(n,function(t){"g"!=t.nodeName&&i.push(t)}):i.push(n))}i.length>0&&(Zt(t,e,i),O("changed",b))},this.getStyle=function(){return p},this.getOpacity=function(){return p.opacity},this.setOpacity=function(t){p.opacity=t,Zt("opacity",t)},this.getFillOpacity=function(){return p.fill_opacity},this.getStrokeOpacity=function(){return p.stroke_opacity},this.setPaintOpacity=function(t,e,i){p[t+"_opacity"]=e,i?Yt(t+"-opacity",e):Zt(t+"-opacity",e)},this.getPaintOpacity=function(t){return"fill"===t?this.getFillOpacity():this.getStrokeOpacity()},this.getBlur=function(t){var e=0;if(t){var i=t.getAttribute("filter");if(i){var r=svgedit.utilities.getElem(t.id+"_blur");r&&(e=r.firstChild.getAttribute("stdDeviation"))}}return e},function(){function t(){var t=o.undoMgr.finishUndoableChange();e.addSubCommand(t),q(e),e=null,i=null}var e=null,i=null,r=!1;o.setBlurNoUndo=function(t){if(!i)return void o.setBlur(t);if(0===t)Yt("filter",""),r=!0;else{var e=b[0];r&&Yt("filter","url(#"+e.id+"_blur)"),svgedit.browser.isWebkit()&&(console.log("e",e),e.removeAttribute("filter"),e.setAttribute("filter","url(#"+e.id+"_blur)")),Yt("stdDeviation",t,[i.firstChild]),o.setBlurOffsets(i,t)}},o.setBlurOffsets=function(t,e){e>3?svgedit.utilities.assignAttributes(t,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100):svgedit.browser.isWebkit()||(t.removeAttribute("x"),t.removeAttribute("y"),t.removeAttribute("width"),t.removeAttribute("height"))},o.setBlur=function(r,n){if(e)return void t();var a=b[0],s=a.id;i=svgedit.utilities.getElem(s+"_blur"),r-=0;var l=new svgedit.history.BatchCommand;if(i)0===r&&(i=null);else{var d=S({element:"feGaussianBlur",attr:{in:"SourceGraphic",stdDeviation:r}});i=S({element:"filter",attr:{id:s+"_blur"}}),i.appendChild(d),svgedit.utilities.findDefs().appendChild(i),l.addSubCommand(new svgedit.history.InsertElementCommand(i))}var g={filter:a.getAttribute("filter")};return 0===r?(a.removeAttribute("filter"),void l.addSubCommand(new svgedit.history.ChangeElementCommand(a,g))):(Zt("filter","url(#"+s+"_blur)"),l.addSubCommand(new svgedit.history.ChangeElementCommand(a,g)),o.setBlurOffsets(i,r),e=l,o.undoMgr.beginUndoableChange("stdDeviation",[i?i.firstChild:null]),void(n&&(o.setBlurNoUndo(r),t())))}}(),this.getBold=function(){var t=b[0];return null!=t&&"text"==t.tagName&&null==b[1]&&"bold"==t.getAttribute("font-weight")},this.setBold=function(t){var e=b[0];null!=e&&"text"==e.tagName&&null==b[1]&&Zt("font-weight",t?"bold":"normal"),b[0].textContent||Ct.setCursor()},this.getItalic=function(){var t=b[0];return null!=t&&"text"==t.tagName&&null==b[1]&&"italic"==t.getAttribute("font-style")},this.setItalic=function(t){var e=b[0];null!=e&&"text"==e.tagName&&null==b[1]&&Zt("font-style",t?"italic":"normal"),b[0].textContent||Ct.setCursor()},this.getFontFamily=function(){return dt.font_family},this.setFontFamily=function(t){dt.font_family=t,Zt("font-family",t),b[0]&&!b[0].textContent&&Ct.setCursor()},this.setTextAlign=function(t){dt.text_anchor=t,Zt("text-anchor",t),b[0]&&!b[0].textContent&&Ct.setCursor()},this.setFontColor=function(t){dt.fill=t,Zt("fill",t)},this.getFontColor=function(){return dt.fill},this.getFontSize=function(){return dt.font_size},this.setFontSize=function(t){dt.font_size=t,Zt("font-size",t),b[0].textContent||Ct.setCursor()},this.getText=function(){var t=b[0];return null==t?"":t.textContent},this.setTextContent=function(t){Zt("#text",t),Ct.init(t),Ct.setCursor()},this.setImageURL=function(t){var e=b[0];if(e){var i=$(e).attr(["width","height"]),r=!i.width||!i.height,n=_(e);if(n!==t)r=!0;else if(!r)return;var a=new svgedit.history.BatchCommand("Change Image URL");B(e,t),a.addSubCommand(new svgedit.history.ChangeElementCommand(e,{"#href":n})),r?$(new Image).load(function(){var t=$(e).attr(["width","height"]);$(e).attr({width:this.width,height:this.height}),W.requestSelector(e).resize(),a.addSubCommand(new svgedit.history.ChangeElementCommand(e,t)),q(a),O("changed",[e])}).attr("src",t):q(a)}},this.setLinkURL=function(t){var e=b[0];if(e){if("a"!==e.tagName){var i=$(e).parents("a");if(!i.length)return;e=i[0]}var r=_(e);if(r!==t){var n=new svgedit.history.BatchCommand("Change Link URL");B(e,t),n.addSubCommand(new svgedit.history.ChangeElementCommand(e,{"#href":r})),q(n)}}},this.setRectRadius=function(t){var e=b[0];if(null!=e&&"rect"==e.tagName){var i=e.getAttribute("rx");i!=t&&(e.setAttribute("rx",t),e.setAttribute("ry",t),q(new svgedit.history.ChangeElementCommand(e,{rx:i,ry:i},"Radius")),O("changed",[e]))}},this.makeHyperlink=function(t){o.groupSelectedElements("a",t)},this.removeHyperlink=function(){o.ungroupSelectedElement()},this.setSegType=function(t){wt.setSegType(t)},this.convertToPath=function(t,e){if(null==t){return void $.each(b,function(t,e){e&&o.convertToPath(e)})}if(!e)var i=new svgedit.history.BatchCommand("Convert element to Path");var r=e?{}:{fill:p.fill,"fill-opacity":p.fill_opacity,stroke:p.stroke,"stroke-width":p.stroke_width,"stroke-dasharray":p.stroke_dasharray,"stroke-linejoin":p.stroke_linejoin,"stroke-linecap":p.stroke_linecap,"stroke-opacity":p.stroke_opacity,opacity:p.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){t.getAttribute(this)&&(r[this]=t.getAttribute(this))});var n=S({element:"path",attr:r}),a=t.getAttribute("transform");a&&n.setAttribute("transform",a);var s=t.id,l=t.parentNode;t.nextSibling?l.insertBefore(n,t):l.appendChild(n);var d,g,h="",u=function(t){$.each(t,function(t,e){var i,r=e[0],n=e[1];for(h+=r,i=0;i<n.length;i+=2)h+=n[i]+","+n[i+1]+" "})},m=1.81;switch(t.tagName){case"ellipse":case"circle":d=$(t).attr(["rx","ry","cx","cy"]);var c=d.cx,v=d.cy;g=d.rx,ry=d.ry,"circle"==t.tagName&&(g=ry=$(t).attr("r")),u([["M",[c-g,v]],["C",[c-g,v-ry/m,c-g/m,v-ry,c,v-ry]],["C",[c+g/m,v-ry,c+g,v-ry/m,c+g,v]],["C",[c+g,v+ry/m,c+g/m,v+ry,c,v+ry]],["C",[c-g/m,v+ry,c-g,v+ry/m,c-g,v]],["Z",[]]]);break;case"path":h=t.getAttribute("d");break;case"line":d=$(t).attr(["x1","y1","x2","y2"]),h="M"+d.x1+","+d.y1+"L"+d.x2+","+d.y2;break;case"polyline":case"polygon":h="M"+t.getAttribute("points");break;case"rect":var f=$(t).attr(["rx","ry"]);g=f.rx,ry=f.ry;var y=t.getBBox(),x=y.x,C=y.y,w=y.width,N=y.height;m=4-m,u(g||ry?[["M",[x,C+ry]],["C",[x,C+ry/m,x+g/m,C,x+g,C]],["L",[x+w-g,C]],["C",[x+w-g/m,C,x+w,C+ry/m,x+w,C+ry]],["L",[x+w,C+N-ry]],["C",[x+w,C+N-ry/m,x+w-g/m,C+N,x+w-g,C+N]],["L",[x+g,C+N]],["C",[x+g/m,C+N,x,C+N-ry/m,x,C+N-ry]],["L",[x,C+ry]],["Z",[]]]:[["M",[x,C]],["L",[x+w,C]],["L",[x+w,C+N]],["L",[x,C+N]],["L",[x,C]],["Z",[]]]);break;default:n.parentNode.removeChild(n)}if(h&&n.setAttribute("d",h),e){wt.resetOrientation(n);var A=!1;try{A=n.getBBox()}catch(t){}return n.parentNode.removeChild(n),A}if(a){var k=svgedit.transformlist.getTransformList(n);svgedit.math.hasMatrixTransform(k)&&wt.resetOrientation(n)}var E=t.nextSibling;i.addSubCommand(new svgedit.history.RemoveElementCommand(t,E,l)),i.addSubCommand(new svgedit.history.InsertElementCommand(n)),Mt(),t.parentNode.removeChild(t),n.setAttribute("id",s),n.removeAttribute("visibility"),Lt([n],!0),q(i)};var Yt=function(t,e,i){var r=d.suspendRedraw(1e3);"pathedit"==st&&wt.moveNode(t,e),i=i||b;for(var n=i.length,a=["g","polyline","path"],s=["transform","opacity","filter"];n--;){var l=i[n];if(null!=l)if(("x"===t||"y"===t)&&a.indexOf(l.tagName)>=0){var g=getStrokedBBox([l]),h="x"===t?e-g.x:0,u="y"===t?e-g.y:0;o.moveSelectedElements(h*c,u*c,!0)}else{"g"===l.tagName&&s.indexOf(t)>=0;var m="#text"===t?l.textContent:l.getAttribute(t);if(null==m&&(m=""),m!==String(e)){if("#text"==t){svgedit.utilities.getBBox(l).width;l.textContent=e,/rotate/.test(l.getAttribute("transform"))&&(l=Tt(l))}else"#href"==t?B(l,e):(l.setAttribute(t,e),pt("setGaugeAttribute",{elem:l,attr:t,value:e}));"textedit"===st&&"#text"!==t&&l.textContent.length&&Ct.toSelectMode(l),svgedit.browser.isGecko()&&"text"===l.nodeName&&/rotate/.test(l.getAttribute("transform"))&&(0===String(e).indexOf("url")||["font-size","font-family","x","y"].indexOf(t)>=0&&l.textContent)&&(l=Tt(l)),b.indexOf(l)>=0&&setTimeout(function(){l.parentNode&&W.requestSelector(l).resize()},0);var v=svgedit.utilities.getRotationAngle(l);if(0!=v&&"transform"!=t)for(var f=svgedit.transformlist.getTransformList(l),p=f.numberOfItems;p--;){var y=f.getItem(p);if(4==y.type){f.removeItem(p);var x=svgedit.utilities.getBBox(l),S=svgedit.math.transformPoint(x.x+x.width/2,x.y+x.height/2,svgedit.math.transformListToTransform(f).matrix),C=S.x,w=S.y,N=d.createSVGTransform();N.setRotate(v,C,w),f.insertItemBefore(N,p);break}}}}}d.unsuspendRedraw(r)},Zt=this.changeSelectedAttribute=function(t,e,i){i=i||b,1===i.length&&0==i[0].id.indexOf("HX")&&(i=i[0].childNodes),o.undoMgr.beginUndoableChange(t,i);i.length;Yt(t,e,i);var r=o.undoMgr.finishUndoableChange();r.isEmpty()||q(r)};this.deleteSelectedElements=function(){var t,e=new svgedit.history.BatchCommand("Delete Elements"),i=b.length,r=[];for(t=0;t<i;++t){var n=b[t];if(null==n)break;var a=n.parentNode,s=n;W.releaseSelector(s),svgedit.path.removePath_(s.id),"a"===a.tagName&&1===a.childNodes.length&&(s=a,a=a.parentNode);var o=s.nextSibling,l=a.removeChild(s);r.push(n),b[t]=null,e.addSubCommand(new F(l,o,a))}return e.isEmpty()||q(e),O("changed",r),Mt(),r},this.cutSelectedElements=function(){var t,e=new svgedit.history.BatchCommand("Cut Elements"),i=b.length,r=[];for(t=0;t<i;++t){var n=b[t];if(null==n)break;var a=n.parentNode,s=n;W.releaseSelector(s),svgedit.path.removePath_(s.id);var l=s.nextSibling,d=a.removeChild(s);r.push(n),b[t]=null,e.addSubCommand(new F(d,l,a))}e.isEmpty()||q(e),O("changed",r),Mt(),o.clipBoard=r},this.copySelectedElements=function(){o.clipBoard=$.merge([],b)},this.pasteElements=function(t,e,i){var r=o.clipBoard,n=r.length;if(n){for(var a=[],s=new svgedit.history.BatchCommand("Paste elements");n--;){var l=r[n];if(l){var d=Et(l);svgedit.utilities.getElem(l.id)||(d.id=l.id),a.push(d),(v||m().getCurrentLayer()).appendChild(d),s.addSubCommand(new svgedit.history.InsertElementCommand(d))}}if($t(a),"in_place"!==t){var g,h;t?"point"===t&&(g=e,h=i):(g=vt.x,h=vt.y);var u=getStrokedBBox(a),c=g-(u.x+u.width/2),f=h-(u.y+u.height/2),p=[],y=[];$.each(a,function(t,e){p.push(c),y.push(f)});var x=o.moveSelectedElements(p,y,!1);s.addSubCommand(x)}q(s),O("changed",a)}},this.groupSelectedElements=function(t,e){t||(t="g");var i="";switch(t){case"a":i="Make hyperlink";var r="";arguments.length>1&&(r=e);break;default:t="g",i="Group Elements"}var n=new svgedit.history.BatchCommand(i),a=S({element:t,attr:{id:St()}});"a"===t&&B(a,r),n.addSubCommand(new svgedit.history.InsertElementCommand(a));for(var s=b.length;s--;){var o=b[s];if(null!=o){"a"===o.parentNode.tagName&&1===o.parentNode.childNodes.length&&(o=o.parentNode);var l=o.nextSibling,d=o.parentNode;a.appendChild(o),n.addSubCommand(new svgedit.history.MoveElementCommand(o,l,d))}}n.isEmpty()||q(n),$t([a],!0)};var Jt=this.pushGroupProperties=function(t,e){var i,r,n,a=t.childNodes,s=a.length,l=t.getAttribute("transform"),g=svgedit.transformlist.getTransformList(t),h=svgedit.math.transformListToTransform(g).matrix,u=new svgedit.history.BatchCommand("Push group properties"),m=0,c=svgedit.utilities.getRotationAngle(t),v=$(t).attr(["filter","opacity"]);for(m=0;m<s;m++){var f=a[m];if(1===f.nodeType){if(null!==v.opacity&&1!==v.opacity){var p=(f.getAttribute("opacity")||1,Math.round((f.getAttribute("opacity")||1)*v.opacity*100)/100);Zt("opacity",p,[f])}if(v.filter){var y=this.getBlur(f),x=y;r||(r=this.getBlur(t)),y?y=Number(r)+Number(y):0===y&&(y=r),x?i=svgedit.utilities.getRefElem(f.getAttribute("filter")):i?(i=Et(i),svgedit.utilities.findDefs().appendChild(i)):i=svgedit.utilities.getRefElem(v.filter);var b="feGaussianBlur"===i.firstChild.tagName?"blur":"filter";i.id=f.id+"_"+b,Zt("filter","url(#"+i.id+")",[f]),y&&(Zt("stdDeviation",y,[i.firstChild]),o.setBlurOffsets(i,y))}var S=svgedit.transformlist.getTransformList(f);if(~f.tagName.indexOf("Gradient")&&(S=null),S&&"defs"!==f.tagName&&g.numberOfItems){if(c&&1==g.numberOfItems){var C=g.getItem(0).matrix,w=d.createSVGMatrix(),N=svgedit.utilities.getRotationAngle(f);N&&(w=S.getItem(0).matrix);var A=svgedit.utilities.getBBox(f),k=svgedit.math.transformListToTransform(S).matrix,E=svgedit.math.transformPoint(A.x+A.width/2,A.y+A.height/2,k),T=c+N,_=d.createSVGTransform();_.setRotate(T,E.x,E.y);var B=svgedit.math.matrixMultiply(C,w,_.matrix.inverse());if(N&&S.removeItem(0),T&&(S.numberOfItems?S.insertItemBefore(_,0):S.appendItem(_)),B.e||B.f){var G=d.createSVGTransform();G.setTranslate(B.e,B.f),S.numberOfItems?S.insertItemBefore(G,0):S.appendItem(G)}}else{var I=f.getAttribute("transform");n={},n.transform=I||"";var M=d.createSVGTransform(),L=svgedit.math.transformListToTransform(S).matrix,P=L.inverse(),O=svgedit.math.matrixMultiply(P,h,L);M.setMatrix(O),S.appendItem(M)}var D=svgedit.recalculate.recalculateDimensions(f);D&&u.addSubCommand(D)}}}if(l&&(n={},n.transform=l,t.setAttribute("transform",""),t.removeAttribute("transform"),u.addSubCommand(new svgedit.history.ChangeElementCommand(t,n))),e&&!u.isEmpty())return u};this.ungroupSelectedElement=function(){var t=b[0];if(t){if($(t).data("gsvg")||$(t).data("symbol"))return void zt(t);if("use"===t.tagName){var e=svgedit.utilities.getElem(_(t).substr(1));return $(t).data("symbol",e).data("ref",e),void zt(t)}var i=$(t).parents("a");if(i.length&&(t=i[0]),"g"===t.tagName||"a"===t.tagName){var r=new svgedit.history.BatchCommand("Ungroup Elements"),n=Jt(t,!0);n&&r.addSubCommand(n);for(var a=t.parentNode,s=t.nextSibling,o=new Array(t.childNodes.length),l=0;t.firstChild;){var d=t.firstChild,g=d.nextSibling,h=d.parentNode;if("title"!==d.tagName)o[l++]=d=a.insertBefore(d,s),r.addSubCommand(new svgedit.history.MoveElementCommand(d,g,h));else{var u=d.nextSibling;r.addSubCommand(new svgedit.history.RemoveElementCommand(d,u,h)),h.removeChild(d)}}Mt();var m=t.nextSibling;t=a.removeChild(t),r.addSubCommand(new svgedit.history.RemoveElementCommand(t,m,a)),r.isEmpty()||q(r),Lt(o)}}},this.moveToTopSelectedElement=function(){var t=b[0];if(null!=t){var e=t,i=e.parentNode,r=e.nextSibling;e=e.parentNode.appendChild(e),r!=e.nextSibling&&(q(new svgedit.history.MoveElementCommand(e,r,i,"top")),O("changed",[e]))}},this.moveToBottomSelectedElement=function(){var t=b[0];if(null!=t){var e=t,i=e.parentNode,r=e.nextSibling,n=e.parentNode.firstChild;"title"==n.tagName&&(n=n.nextSibling),"defs"==n.tagName&&(n=n.nextSibling),e=e.parentNode.insertBefore(e,n),r!=e.nextSibling&&(q(new svgedit.history.MoveElementCommand(e,r,i,"bottom")),O("changed",[e]))}},this.moveUpDownSelected=function(t){var e=b[0];if(e){mt=[];var i,r,n=$(xt(getStrokedBBox([e]))).toArray();if("Down"==t&&n.reverse(),$.each(n,function(){return r?(i=this,!1):void(this==e&&(r=!0))}),i){var a=e,s=a.parentNode,o=a.nextSibling;$(i)["Down"==t?"before":"after"](a),o!=a.nextSibling&&(q(new svgedit.history.MoveElementCommand(a,o,s,"Move "+t)),O("changed",[a]))}}},this.moveSelectedElements=function(t,e,i){t.constructor!=Array&&(t/=c,e/=c),i=i||!0;for(var r=new svgedit.history.BatchCommand("position"),n=b.length;n--;){var a=b[n];if(null!=a){var s=d.createSVGTransform(),o=svgedit.transformlist.getTransformList(a);t.constructor==Array?s.setTranslate(t[n],e[n]):s.setTranslate(t,e),o.numberOfItems?o.insertItemBefore(s,0):o.appendItem(s);var l=svgedit.recalculate.recalculateDimensions(a);l&&r.addSubCommand(l),W.requestSelector(a).resize()}}if(!r.isEmpty())return i&&q(r),O("changed",b),r},this.setFilterShadow=function(t){if(!(b.length<=0)){var e=b[0];if(!t)return void e.removeAttribute("filter");var i=svgedit.utilities.findDefs();if(i){var r=$(i).find("filter");r&&r.length||(r=l.createElementNS(n.SVG,"filter"),i.appendChild(r),r.setAttribute("id","shadow-box"));var a=$(r).find("feDropShadow");a&&a.length||(a=l.createElementNS(n.SVG,"feDropShadow"),a.setAttribute("dx","2"),a.setAttribute("dy","2"),a.setAttribute("stdDeviation","2"),r.appendChild(a)),e.setAttribute("filter","url(#shadow-box)")}}},this.cloneSelectedElements=function(t,e){function i(t,e){return $(e).index()-$(t).index()}var r,n,a=new svgedit.history.BatchCommand("Clone Elements"),s=b.length;for(b.sort(i),r=0;r<s&&(n=b[r],null!=n);++r);var o=b.slice(0,r);for(this.clearSelection(!0),r=o.length;r--;)n=o[r]=Et(o[r]),(v||m().getCurrentLayer()).appendChild(n),a.addSubCommand(new svgedit.history.InsertElementCommand(n));a.isEmpty()||(Lt(o.reverse()),this.moveSelectedElements(t,e,!1),q(a))},this.alignSelectedElements=function(t,e){var i,r,n=[],a=Number.MAX_VALUE,s=Number.MIN_VALUE,l=Number.MAX_VALUE,d=Number.MIN_VALUE,g=Number.MIN_VALUE,h=Number.MIN_VALUE,u=b.length;if(u){for(i=0;i<u&&null!=b[i];++i)switch(r=b[i],n[i]=getStrokedBBox([r]),e){case"smallest":(("l"==t||"c"==t||"r"==t)&&(g==Number.MIN_VALUE||g>n[i].width)||("t"==t||"m"==t||"b"==t)&&(h==Number.MIN_VALUE||h>n[i].height))&&(a=n[i].x,l=n[i].y,s=n[i].x+n[i].width,d=n[i].y+n[i].height,g=n[i].width,h=n[i].height);break;case"largest":(("l"==t||"c"==t||"r"==t)&&(g==Number.MIN_VALUE||g<n[i].width)||("t"==t||"m"==t||"b"==t)&&(h==Number.MIN_VALUE||h<n[i].height))&&(a=n[i].x,l=n[i].y,s=n[i].x+n[i].width,d=n[i].y+n[i].height,g=n[i].width,h=n[i].height);break;default:n[i].x<a&&(a=n[i].x),n[i].y<l&&(l=n[i].y),n[i].x+n[i].width>s&&(s=n[i].x+n[i].width),n[i].y+n[i].height>d&&(d=n[i].y+n[i].height)}"page"==e&&(a=0,l=0,s=o.contentW,d=o.contentH);var m=new Array(u),c=new Array(u);for(i=0;i<u&&null!=b[i];++i){r=b[i];var v=n[i];switch(m[i]=0,c[i]=0,t){case"l":m[i]=a-v.x;break;case"c":m[i]=(a+s)/2-(v.x+v.width/2);break;case"r":m[i]=s-(v.x+v.width);break;case"t":c[i]=l-v.y;break;case"m":c[i]=(l+d)/2-(v.y+v.height/2);break;case"b":c[i]=d-(v.y+v.height)}}this.moveSelectedElements(m,c)}},this.contentW=qt().w,this.contentH=qt().h,this.updateCanvas=function(t,e){d.setAttribute("width",t),d.setAttribute("height",e);var i=$("#canvasBackground")[0],r=g.getAttribute("x"),n=g.getAttribute("y"),a=t/2-this.contentW*c/2,s=e/2-this.contentH*c/2;svgedit.utilities.assignAttributes(g,{width:this.contentW*c,height:this.contentH*c,x:a,y:s,viewBox:"0 0 "+this.contentW+" "+this.contentH}),svgedit.utilities.assignAttributes(i,{width:g.getAttribute("width"),height:g.getAttribute("height"),x:a,y:s});var o=svgedit.utilities.getElem("background_image");return o&&svgedit.utilities.assignAttributes(o,{width:"100%",height:"100%"}),W.selectorParentGroup.setAttribute("transform","translate("+a+","+s+")"),pt("canvasUpdated",{new_x:a,new_y:s,old_x:r,old_y:n,d_x:a-r,d_y:s-n}),{x:a,y:s,old_x:r,old_y:n,d_x:a-r,d_y:s-n}},this.setBackground=function(t,e){var i=svgedit.utilities.getElem("canvasBackground"),r=$(i).find("rect")[0],a=svgedit.utilities.getElem("background_image");r.setAttribute("fill",t),e?(a||(a=l.createElementNS(n.SVG,"image"),svgedit.utilities.assignAttributes(a,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})),B(a,e),i.appendChild(a)):a&&a.parentNode.removeChild(a)},this.cycleElement=function(t){var e,i=b[0],r=!1,n=Nt(v||m().getCurrentLayer());if(n.length){if(null==i)e=t?n.length-1:0,r=n[e];else for(var a=n.length;a--;)if(n[a]==i){e=t?a-1:a+1,e>=n.length?e=0:e<0&&(e=n.length-1),r=n[e];break}$t([r],!0),O("selected",b)}},this.clear(),this.getExtensionMember=function(t,e){var i=[];return $.each(ct,function(r,n){n&&t in n&&i.push(n[t](e))}),i},this.getPrivateMethods=function(){var t={addCommandToHistory:q,setGradient:Kt,addSvgElementFromJson:S,addSvgGroupFromJson:C,assignAttributes:M,BatchCommand:H,call:O,ChangeElementCommand:j,copyElem:Et,ffClone:Tt,findDefs:E,findDuplicateGradient:Xt,getElem:I,getId:bt,getIntersectionList:xt,getMouseTarget:Pt,getNextId:St,getPathBBox:G,getUrlFromAttr:T,hasMatrixTransform:A,identifyLayers:Ft,InsertElementCommand:z,isIdentity:svgedit.math.isIdentity,logMatrix:Gt,matrixMultiply:N,MoveElementCommand:U,preventClickDefault:Ot,recalculateAllSelectedDimensions:_t,recalculateDimensions:D,remapElement:P,RemoveElementCommand:F,removeUnusedDefElems:Dt,round:yt,runExtensions:pt,sanitizeSvg:V,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,transformListToTransform:k,transformPoint:w,walkTree:svgedit.utilities.walkTree};return t}};
var mysvgeditor=function(){return{initSvgEditor:function(e,t,n,o,i,a){window.svgEditor=function(e){function l(t,n){var o=r.setSvgString(t)!==!1;n=n||e.noop,o?n(!0):e.alert(y.notification.errorLoadingSVG,function(){n(!1)})}var s={};e(document).unbind("keydown"),s.tool_scale=1,s.exportWindowCt=0,s.langChanged=!1,s.showSaveWarning=!1,s.storagePromptClosed=!1,s.extensionLoadedCallback=n,s.onSelectedElement=t,s.changeColor=o,s.onGaugeAdded=i,s.onGaugeRemoved=a,s.currentExtensionsInteractivityType=[];var r,c,u=svgedit.utilities,d=!1,f=!1,p=!1,v=[],g={lang:"",iconsize:"",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed",save_notice_done:!1,export_notice_done:!1},h={},m={extensions:[],allowedOrigins:[]},_=["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-panning.js","ext-storage.js"],w={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:1,color:"000000",opacity:1},initOpacity:1,colorPickerCSS:null,initTool:"select",exportWindowType:"new",wireframe:!1,showlayers:!1,no_save_warning:!1,imgPath:"images/",langPath:"locale/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",dimensions:[640,480],gridSnapping:!0,gridColor:"#000",baseUnit:"px",snappingStep:2,showRulers:!0,preventAllURLConfig:!1,preventURLContentLoading:!1,lockExtensions:!1,noDefaultExtensions:!1,showGrid:!1,noStorageOnLoad:!1,forceStorage:!1,emptyStorageOnDecline:!1},y=s.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ..."}};return e.pref=function(e,t){return t?(h[e]=t,void(s.curPrefs=h)):e in h?h[e]:g[e]},s.loadContentAndPrefs=function(){if(m.forceStorage||!m.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)){if(s.storage&&(m.forceStorage||!m.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=prefsAndContent/))){var e="svgedit-"+m.canvasName,t=s.storage.getItem(e);t&&s.loadFromString(t)}var n;for(n in g)if(g.hasOwnProperty(n)){var o="web-edit-"+n;if(s.storage){var i=s.storage.getItem(o);i&&(g[n]=String(i))}else if(window.widget)g[n]=widget.preferenceForKey(o);else{var a=document.cookie.match(new RegExp("(?:^|;\\s*)"+u.preg_quote(encodeURIComponent(o))+"=([^;]+)"));g[n]=a?decodeURIComponent(a[1]):""}}}},s.setConfig=function(t,n){function o(t,n,o){t[n]&&"object"==typeof t[n]?e.extend(!0,t[n],o):t[n]=o}n=n||{},e.each(t,function(i,a){if(t.hasOwnProperty(i))if(g.hasOwnProperty(i)){if(n.overwrite===!1&&(m.preventAllURLConfig||h.hasOwnProperty(i)))return;n.allowInitialUserOverride===!0?g[i]=a:e.pref(i,a)}else if(["extensions","allowedOrigins"].indexOf(i)>-1){if(n.overwrite===!1&&(m.preventAllURLConfig||"allowedOrigins"===i||"extensions"===i&&m.lockExtensions))return;m[i]=m[i].concat(a)}else if(w.hasOwnProperty(i)){if(n.overwrite===!1&&(m.preventAllURLConfig||m.hasOwnProperty(i)))return;if(m.hasOwnProperty(i)){if(n.overwrite===!1)return;o(m,i,a)}else n.allowInitialUserOverride===!0?o(w,i,a):w[i]&&"object"==typeof w[i]?(m[i]={},e.extend(!0,m[i],a)):m[i]=a}}),s.curConfig=m},s.setCustomHandlers=function(t){s.ready(function(){t.open&&(e('#tool_open > input[type="file"]').remove(),e("#tool_open").show(),r.open=t.open),t.save&&(s.showSaveWarning=!1,r.bind("saved",t.save)),t.exportImage&&(f=t.exportImage,r.bind("exported",f)),t.exportPDF&&(p=t.exportPDF,r.bind("exportedPDF",p))})},s.randomizeIds=function(){r.randomizeIds(arguments)},s.init=function(){function t(){h=e.extend(!0,{},g,h),s.curPrefs=h}function n(){m=e.extend(!0,{},w,m),m.noDefaultExtensions||(m.extensions=m.extensions.concat(_)),e.each(["extensions","allowedOrigins"],function(t,n){m[n]=e.grep(m[n],function(e,t){return t===m[n].indexOf(e)})}),s.curConfig=m}function o(t,n){var o=t.id,i=o.split("_"),a=i[0],l=i[1];n&&r.setStrokeAttr("stroke-"+a,l),ge(),A("#cur_"+a,o,20),e(t).addClass("current").siblings().removeClass("current")}function i(t,n){e.pref("bkgd_color",t),e.pref("bkgd_url",n),r.setBackground(t,n)}function d(){var t=r.getHref(ee);if(t=0===t.indexOf("data:")?"":t,s.promptImgURLcallback){var n=s.promptImgURLcallback;n&&_e(n)}else e.prompt(y.notification.enterNewImgURL,t,function(e){e&&_e(e)})}function v(t,n){n||(n=r.getZoom()),t||(t=e("#svgcanvas"));var o,i,a=3e4,l=r.getContentElem(),s=svgedit.units.getTypeMap(),c=s[m.baseUnit];for(o=0;o<2;o++){var u=0===o,d=u?"x":"y",f=u?"width":"height",p=Number(l.getAttribute(d)),v=e("#ruler_"+d+" canvas:first"),g=v.clone();v.replaceWith(g);var h=g[0],_=t[f](),w=_;h.parentNode.style[f]=w+"px";var y,b,k,x=0,C=h.getContext("2d");if(C.fillStyle="#666666",C.fillRect(0,0,h.width,h.height),g.siblings().remove(),_>=a){k=parseInt(_/a,10)+1,y=[],y[0]=C;var S;for(i=1;i<k;i++)h[f]=a,S=h.cloneNode(!0),h.parentNode.appendChild(S),y[i]=S.getContext("2d");S[f]=_%a,_=a}h[f]=_;var L=c*n,T=50/L,E=1;for(i=0;i<re.length&&(b=re[i],E=b,!(T<=b));i++);var N=E*L;C.font="8px sans-serif";for(var P=p/L%E*L,A=P-N;P<w;){A+=N,C.fillStyle="#CACACA";var I=Math.round(P)+.5;u?(C.moveTo(I,15),C.lineTo(I,0)):(C.moveTo(15,I),C.lineTo(0,I)),b=(A-p)/L;var D;if(E>=1)D=Math.round(b);else{var U=String(E).split(".")[1].length;D=b.toFixed(U)}if(0!==D&&1e3!==D&&D%1e3===0&&(D=D/1e3+"K"),u)C.fillText(D,P+2,8);else{var F=String(D).split("");for(i=0;i<F.length;i++)C.fillText(F[i],1,P+9+9*i)}var O=N/10;for(i=1;i<10;i++){var M=Math.round(P+O*i)+.5;if(y&&M>_){if(x++,C.stroke(),x>=k){i=10,P=w;continue}C=y[x],P-=a,M=Math.round(P+O*i)+.5}var R=i%2?12:10;u?(C.moveTo(M,15),C.lineTo(M,R)):(C.moveTo(15,M),C.lineTo(R,M))}P+=N}C.strokeStyle="#666666",C.stroke()}}function b(){r.deleteCurrentLayer()&&(ke(),ue(),e("#layerlist tr.layer").removeClass("layersel"),e("#layerlist tr.layer:first").addClass("layersel"))}function k(){var t=r.getCurrentDrawing().getCurrentLayerName()+" copy";e.prompt(y.notification.enterUniqueLayerName,t,function(t){if(t){if(r.getCurrentDrawing().hasLayer(t))return void e.alert(y.notification.dupeLayerName);r.cloneLayer(t),ke(),ue()}})}function x(){e("#layerlist tr.layersel").index()!=r.getCurrentDrawing().getNumLayers()-1&&(r.mergeLayer(),ke(),ue())}function C(t){var n=e("#layerlist tr.layersel").index(),o=r.getCurrentDrawing().getNumLayers();(n>0||n<o-1)&&(n+=t,r.setCurrentLayerPosition(o-n-1),ue())}function S(e,t){var n=Number(e.value),o=n+t,i=o>=n;return 0===t?n:n>=24?i?Math.round(1.1*n):Math.round(n/1.1):n<=1?i?2*n:n/2:o}function L(e,t){var n=Number(e.value);if(0===n)return 100;var o=n+t;return 0===t?n:n>=100?o:o>=n?2*n:n/2}function T(e){e.stopPropagation(),e.preventDefault()}function E(e){e.stopPropagation(),e.preventDefault()}function N(e){e.stopPropagation(),e.preventDefault()}try{"localStorage"in window&&(s.storage=localStorage)}catch(e){}var P=[];e("#lang_select option").each(function(){P.push(this.value)}),function(){var o,i;if(c=e.deparam.querystring(!0),e.isEmptyObject(c))n(),s.loadContentAndPrefs(),t();else{if(c.dimensions&&(c.dimensions=c.dimensions.split(",")),c.bkgd_color&&(c.bkgd_color="#"+c.bkgd_color),c.extensions&&(c.extensions=c.extensions.match(/[:\/\\]/)?"":c.extensions.split(",")),e.each(["extPath","imgPath","langPath","jGraduatePath"],function(e){c[e]&&delete c[e]}),s.setConfig(c,{overwrite:!1}),n(),!m.preventURLContentLoading){if(o=c.source,i=e.param.querystring(),o||i.indexOf("source=data:")>=0&&(o=i.match(/source=(data:[^&]*)/)[1]),o)return void(0===o.indexOf("data:")?s.loadFromDataURI(o):s.loadFromString(o));if(c.url)return void s.loadFromURL(c.url)}c.noStorageOnLoad&&!m.forceStorage||s.loadContentAndPrefs(),t()}}(),function(){var e,t=window.opener;if(t)try{e=t.document.createEvent("Event"),e.initEvent("svgEditorReady",!0,!0),t.document.documentElement.dispatchEvent(e)}catch(e){}}();var A=s.setIcon=function(t,n,o){var i="string"==typeof n?e.getSvgIcon(n,!0):n.clone();i&&e(t).empty().append(i)},I=function(){window.extOverview&&window.extOverview(),window.extMarkers&&window.extMarkers(),window.extConnector&&window.extConnector(),window.extEyedropper&&window.extEyedropper(),window.extShapes&&window.extShapes(),window.extImagelib&&window.extImagelib(),window.extGrid&&window.extGrid(),window.extPanning&&window.extPanning(),window.extStorage&&window.extStorage(),window.extSwitch&&window.extSwitch(),window.extCompressors&&window.extCompressors(),window.extExchangers&&window.extExchangers(),window.extValveA&&window.extValveA(),window.extValves&&window.extValves(),window.extMotors&&window.extMotors(),window.extValue&&window.extValue(),window.extHtmlInput&&window.extHtmlInput(),window.extHtmlSelect&&window.extHtmlSelect(),window.extHtmlButton&&window.extHtmlButton(),window.extGaugeProgress&&window.extGaugeProgress(),window.extGaugeSemaphore&&window.extGaugeSemaphore(),s.currentExtensionsInteractivityType=r.getExtensionMember("getClassId"),s.putLocale&&s.putLocale(null,P)};"file:"===document.location.protocol?setTimeout(I,100):setTimeout(I,2e3),s.canvas=r=new e.SvgCanvas(document.getElementById("svgcanvas"),m);var D,U,F,O,M,R=["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],z=svgedit.browser.isMac()?"meta+":"ctrl+",G=r.pathActions,j=r.undoMgr,B=m.imgPath+"logo.png",W=e("#workarea"),V=e("#cmenu_canvas"),H=null,q="crosshair",Q="crosshair",Z="toolbars",K="",X={fill:null,stroke:null};(function(){e("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var t=e("#dialog_box"),n=e("#dialog_buttons"),o=e("#dialog_content"),i=function(i,a,l,s,r,c,u){var d,f,p;if(o.html("<p>"+a.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt","prompt"==i),n.empty(),d=e('<input type="button" value="'+y.common.ok+'">').appendTo(n),"alert"!==i&&e('<input type="button" value="'+y.common.cancel+'">').appendTo(n).click(function(){t.hide(),l&&l(!1)}),"prompt"===i)f=e('<input type="text">').prependTo(n),f.val(s||""),f.bind("keydown","return",function(){d.click()});else if("select"===i){var v=e('<div style="text-align:center;">');if(f=e("<select>").appendTo(v),u){var g=e("<label>").text(u.label);p=e('<input type="checkbox">').appendTo(g),p.val(u.value),u.tooltip&&g.attr("title",u.tooltip),p.prop("checked",!!u.checked),v.append(e("<div>").append(g))}e.each(r||[],function(t,n){"object"==typeof n?f.append(e("<option>").val(n.value).html(n.text)):f.append(e("<option>").html(n))}),o.append(v),s&&f.val(s),c&&f.bind("change","return",c),f.bind("keydown","return",function(){d.click()})}else"process"===i&&d.hide();t.show(),d.click(function(){t.hide();var e="prompt"!==i&&"select"!==i||f.val();l&&(p?l(e,p.prop("checked")):l(e))}).focus(),"prompt"!==i&&"select"!==i||f.focus()};e.alert=function(e,t){i("alert",e,t)},e.confirm=function(e,t){i("confirm",e,t)},e.process_cancel=function(e,t){i("process",e,t)},e.prompt=function(e,t,n){i("prompt",e,n,t)},e.select=function(e,t,n,o,a,l){i("select",e,n,a,t,o,l)}})();var Y,J=function(){var t=e(".tool_button_current");t.length&&"tool_select"!==t[0].id&&(t.removeClass("tool_button_current").addClass("tool_button"),e("#tool_select").addClass("tool_button_current").removeClass("tool_button"),e("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")),r.setMode("select"),W.css("cursor","auto")},$=!1,ee=null,te=!1,ne=!1,oe=!1,ie=!1,ae=!1,le="",se=e("title:first").text(),re=[];for(Y=.1;Y<1e5;Y*=10)re.push(Y),re.push(2*Y),re.push(5*Y);var ce=function(e){var t,n=[],o=r.getCurrentDrawing().getNumLayers();for(t=0;t<o;t++)n[t]=r.getCurrentDrawing().getLayerName(t);if(e)for(t=0;t<o;++t)n[t]!=e&&r.getCurrentDrawing().setLayerOpacity(n[t],.5);else for(t=0;t<o;++t)r.getCurrentDrawing().setLayerOpacity(n[t],1)},ue=function(){r.clearSelection();for(var t=e("#layerlist tbody").empty(),n=e("#selLayerNames").empty(),o=r.getCurrentDrawing(),i=o.getCurrentLayerName(),a=r.getCurrentDrawing().getNumLayers(),l=e.getSvgIcon("eye");a--;){var s=o.getLayerName(a),c=e('<tr class="layer">').toggleClass("layersel",s===i),u=e('<td class="layervis">').toggleClass("layerinvis",!o.getLayerVisibility(s)),d=e('<td class="layername">'+s+"</td>");t.append(c.append(u,d)),n.append('<option value="'+s+'">'+s+"</option>")}if(void 0!==l){var f=l.clone();e("td.layervis",t).append(f),e.resizeSvgIcons({"td.layervis .svg_icon":14})}e("#layerlist td.layername").mouseup(function(t){e("#layerlist tr.layer").removeClass("layersel"),e(this.parentNode).addClass("layersel"),r.setCurrentLayer(this.textContent),t.preventDefault()}).mouseover(function(){ce(this.textContent)}).mouseout(function(){ce()}),e("#layerlist td.layervis").click(function(){var t=e(this.parentNode).prevAll().length,n=e("#layerlist tr.layer:eq("+t+") td.layername").text(),o=e(this).hasClass("layerinvis");r.setLayerVisibility(n,o),e(this).toggleClass("layerinvis")});for(var p=5-e("#layerlist tr.layer").size();p-- >0;)t.append('<tr><td style="color:white">_</td><td/></tr>')},de=function(t,n){oe||(oe=!0,K=r.getSvgString(),e("#save_output_btns").toggle(!!n),e("#tool_source_back").toggle(!n),e("#svg_source_textarea").val(K),e("#svg_source_editor").fadeIn(),e("#svg_source_textarea").focus())},fe=function(t,n){e("#path_node_panel").toggle(t),e("#tools_bottom_2,#tools_bottom_3").toggle(!t),t?(e(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),e("#tool_select").addClass("tool_button_current").removeClass("tool_button"),A("#tool_select","select_node"),te=!1,n.length&&(ee=n[0])):setTimeout(function(){A("#tool_select","select")},1e3)},pe=function(t,n){if(s.showSaveWarning=!1,n='<?xml version="1.0"?>\n'+n,svgedit.browser.isIE())return void de(0,!0);var o=t.open("data:image/svg+xml;base64,"+u.encode64(n)),i=e.pref("save_notice_done");if("all"!==i){var a=y.notification.saveFromBrowser.replace("%s","SVG");svgedit.browser.isGecko()?n.indexOf("<defs")!==-1?(a+="\n\n"+y.notification.defsFailOnSave,e.pref("save_notice_done","all"),i="all"):e.pref("save_notice_done","part"):e.pref("save_notice_done","all"),"part"!==i&&o.alert(a)}},ve=function(t,n){var o=n.issues,i=n.exportWindowName;i&&(H=window.open("",i)),H.location.href=n.datauri;var a=e.pref("export_notice_done");if("all"!==a){var l=y.notification.saveFromBrowser.replace("%s",n.type);if(o.length){var s="\n  ";l+="\n\n"+y.notification.noteTheseIssues+s+o.join(s)}e.pref("export_notice_done","all"),H.alert(l)}},ge=function(){window.opera&&e("<p/>").hide().appendTo("body").remove()},he=s.toolButtonClick=function(t,n){if(e(t).hasClass("disabled"))return!1;if(e(t).parent().hasClass("tools_flyout"))return!0;var o="normal";return n||e(".tools_flyout").fadeOut(o),e("#styleoverrides").text(""),W.css("cursor","auto"),e(".tool_button_current").removeClass("tool_button_current").addClass("tool_button"),e(t).addClass("tool_button_current").removeClass("tool_button"),!0},me=s.clickSelect=function(){he("#tool_select")&&(r.setMode("select"),e("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}"))},_e=s.setImageURL=function(t){t||(t=B),r.setImageURL(t),e("#image_url").val(t),0===t.indexOf("data:")?(e("#image_url").hide(),e("#change_image_url").hide()):(r.embedImage(t,function(n){e("#url_notice").toggle(!n),B=t}),e("#image_url").hide(),e("#change_image_url").hide())};s.promptImgURLcallback=null;var we=s.updateCanvas=function(t,n){var o=W.width(),i=W.height(),a=o,l=i,u=r.getZoom(),d=W,f=e("#svgcanvas"),p={x:d[0].scrollLeft+a/2,y:d[0].scrollTop+l/2},g=m.canvas_expansion;o=Math.max(a,r.contentW*u*g),i=Math.max(l,r.contentH*u*g),o==a&&i==l?W.css("overflow","hidden"):W.css("overflow","scroll");var h=f.height()/2,_=f.width()/2;f.width(o).height(i);var w=i/2,y=o/2,b=r.updateCanvas(o,i),k=y/_,x=o/2-a/2,C=i/2-l/2;if(n)n.x+=b.x,n.y+=b.y;else{var S=p.x-_,L=y+S*k,T=p.y-h,E=w+T*k;n={x:L,y:E}}t?r.contentW>d.width()?(W[0].scrollLeft=b.x-10,W[0].scrollTop=b.y-10):(d[0].scrollLeft=x,d[0].scrollTop=C):(d[0].scrollLeft=n.x-a/2,d[0].scrollTop=n.y-l/2),m.showRulers&&(v(f,u),W.scroll()),c.storagePrompt===!0||s.storagePromptClosed||e("#dialog_box").hide()},ye=function(){var t,n,o="none"==r.getColor("fill"),i="none"==r.getColor("stroke"),a=["#tool_fhpath","#tool_line"],l=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(i)for(t in a)n=a[t],e(n).hasClass("tool_button_current")&&me(),e(n).addClass("disabled");else for(t in a)n=a[t],e(n).removeClass("disabled");if(i&&o)for(t in l)n=l[t],e(n).hasClass("tool_button_current")&&me(),e(n).addClass("disabled");else for(t in l)n=l[t],e(n).removeClass("disabled");r.runExtensions("toolButtonStateUpdate",{nofill:o,nostroke:i}),e(".tools_flyout").each(function(){var t=e("#"+this.id+"_show"),n=!1;e(this).children().each(function(){e(this).hasClass("disabled")||(n=!0)}),t.toggleClass("disabled",!n)}),ge()},be=function(){var t,n;if(null!=ee)switch(ee.tagName){case"use":case"image":case"foreignObject":break;case"g":case"a":var i=null,a=ee.getElementsByTagName("*");for(t=0,n=a.length;t<n;t++){var l=a[t].getAttribute("stroke-width");0===t?i=l:i!==l&&(i=null)}e("#stroke_width").val(null===i?"1":i),X.fill.update(!0),X.stroke.update(!0);break;default:X.fill.update(!0),X.stroke.update(!0),e("#stroke_width").val(ee.getAttribute("stroke-width")||1),e("#stroke_style").val(ee.getAttribute("stroke-dasharray")||"none");var s=ee.getAttribute("stroke-linejoin")||"miter";0!=e("#linejoin_"+s).length&&o(e("#linejoin_"+s)[0]),s=ee.getAttribute("stroke-linecap")||"butt",0!=e("#linecap_"+s).length&&o(e("#linecap_"+s)[0])}if(null!=ee){var r=100*(ee.getAttribute("opacity")||1);e("#group_opacity").val(r),e("#opac_slider").slider("option","value",r),e("#elem_id").val(ee.id),e("#elem_class").val(ee.getAttribute("class"))}ye()},ke=function(){var t=ee;null==t||t.parentNode||(t=null);var n=r.getCurrentDrawing().getCurrentLayerName(),o=r.getMode(),i="px"!==m.baseUnit?m.baseUnit:null,a="pathedit"==o,l=e("#cmenu_canvas li");if(e("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel, #xy_panel, #marker_panel, #htmlctrl_panel, #tool_stroke, #tool_angle").hide(),ne||e("#tool_stroke").show(),null!=t){var c=t.nodeName;e("#tool_angle").show();var u=r.getRotationAngle(t);e("#angle").val(u);var f=r.getBlur(t);if(e("#blur").val(f),e("#blur_slider").slider("option","value",f),r.addedNew&&"image"===c&&0!==r.getHref(t).indexOf("data:")&&d(),a||"pathedit"==o){var p=G.getNodePoint();if(e("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button"),e("#tool_node_delete").toggleClass("disabled",!G.canDeleteNodes),A("#tool_openclose_path",G.closed_subpath?"open_path":"close_path"),p){var v=e("#seg_type");i&&(p.x=svgedit.units.convertUnit(p.x),p.y=svgedit.units.convertUnit(p.y)),e("#path_node_x").val(p.x),e("#path_node_y").val(p.y),p.type?v.val(p.type).removeAttr("disabled"):v.val(4).attr("disabled","disabled")}return}if(e("#selected_panel").show(),["line","circle","ellipse"].indexOf(c)>=0)e("#xy_panel").hide();else{var g,h;if(["g","polyline","path"].indexOf(c)>=0){var _=r.getStrokedBBox([t]);_&&(g=_.x,h=_.y)}else g=t.getAttribute("x"),h=t.getAttribute("y");i&&(g=svgedit.units.convertUnit(g),h=svgedit.units.convertUnit(h));t.getAttribute("width"),t.getAttribute("heght");g=Number.parseFloat(g),g=g.toFixed(Number.isInteger(g)?0:2),h=Number.parseFloat(h),h=h.toFixed(Number.isInteger(h)?0:2),e("#selected_x").val(g||0),e("#selected_y").val(h||0),e("#xy_panel").show()}var w=["image","text","path","g","use"].indexOf(c)==-1;e("#tool_topath").toggle(w),e("#tool_reorient").toggle("path"===c),e("#tool_reorient").toggleClass("disabled",0===u);var y={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]},b=t.tagName,k=null;if("a"===b&&(k=r.getHref(t),e("#g_panel").show()),"a"===t.parentNode.tagName&&(e(t).siblings().length||(e("#a_panel").show(),k=r.getHref(t.parentNode))),e("#tool_make_link, #tool_make_link").toggle(!k),k&&e("#link_url").val(k),y[b]){var x=y[b];if(e("#"+b+"_panel").show(),e.each(x,function(n,o){var i=t.getAttribute(o);if("px"!==m.baseUnit&&t[o]){var a=t[o].baseVal.value;i=svgedit.units.convertUnit(a)}e("#"+b+"_"+o).val(i||0)}),"text"==b||"g"===b&&0===t.id.indexOf("VAL_"))e("#text_panel").css("display","inline"),r.getItalic()?e("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):e("#tool_italic").removeClass("push_button_pressed").addClass("tool_button"),r.getBold()?e("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):e("#tool_bold").removeClass("push_button_pressed").addClass("tool_button"),e("#font_family").val(t.getAttribute("font-family")),e("#font_size").val(t.getAttribute("font-size")),e("#text_anchor").val(t.getAttribute("text-anchor")),e("#text").val(t.textContent),r.addedNew&&setTimeout(function(){e("#text").focus().select()},100);else if("image"==b)_e(r.getHref(t));else if("g"===b||"use"===b){e("#container_panel").show();r.getTitle()}else"line"===b&&e("#marker_panel").show()}l[("g"===b?"en":"dis")+"ableContextMenuItems"]("#ungroup"),l[("g"!==b&&te?"en":"dis")+"ableContextMenuItems"]("#group")}else te?(e("#multiselected_panel").show(),l.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")):l.disableContextMenuItems("#interactivity,#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");if(ne&&!te&&(l.disableContextMenuItems("#ungroup"),e("#g_panel").hide()),e("#tool_undo").toggleClass("disabled",0===j.getUndoStackSize()),e("#tool_redo").toggleClass("disabled",0===j.getRedoStackSize()),r.addedNew=!1,t&&!a||te?(e("#selLayerNames").removeAttr("disabled").val(n),V.enableContextMenuItems("#delete,#deselect,#cut,#copy,#move_front,#move_up,#move_down,#move_back")):e("#selLayerNames").attr("disabled","disabled"),l.disableContextMenuItems("#interactivity"),t&&!te){var C=t.getAttribute("type");C&&s.currentExtensionsInteractivityType.indexOf(C)>-1&&l.enableContextMenuItems("#interactivity")}},xe=function(){if(!D){var t="#workarea.wireframe #svgcontent * { stroke-width: "+1/r.getZoom()+"px; }";e("#wireframe_rules").text(W.hasClass("wireframe")?t:"")}},Ce=function(t){t=t||r.getDocumentTitle();var n=se+(t?": "+t:"");e("title:first").text(n)},Se=function(e,t){var n=r.getMode();"select"===n&&J();var o="pathedit"==n;ee=1===t.length||null==t[1]?t[0]:null,te=t.length>=2&&null!=t[1],ne=!1;for(var i=0;i<t.length;i++)t[i]&&t[i].id&&0===t[i].id.indexOf("HX")&&(ne=!0);null!=ee&&(o||be()),fe(o,t),ke(),r.runExtensions("selectedChanged",{elems:t,selectedElement:ee,multiselected:te});var a=[];if(te){for(var i=0;i<t.length;i++)a.push({id:t[i].id,type:t[i].getAttribute("type")});s.onSelectedElement(a)}else ee?(a.push({id:ee.id,type:ee.getAttribute("type")}),s.onSelectedElement(a)):s.onSelectedElement(null)},Le=function(t,n){var o=r.getMode(),i=n[0];if(i){if(te=n.length>=2&&null!=n[1],!te)switch(o){case"rotate":var a=r.getRotationAngle(i);e("#angle").val(a),e("#tool_reorient").toggleClass("disabled",0===a)}r.runExtensions("elementTransition",{elems:n})}},Te=function(e,t){var n,o=r.getMode();for("select"===o&&J(),n=0;n<t.length;++n){var i=t[n];i&&"svg"===i.tagName?(ue(),we()):i&&ee&&null==ee.parentNode&&(ee=i)}s.showSaveWarning=!0,ke(),ee&&"select"===o&&(X.fill.update(),X.stroke.update()),r.runExtensions("elementChanged",{elems:t})},Ee=function(){xe()},Ne=r.zoomChanged=function(t,n,o){var i=15,a=W,l=r.setBBoxZoom(n,a.width()-i,a.height()-i);if(l){var s=l.zoom,c=l.bbox;if(s<.001)return void F({value:.1});e("#zoom").val((100*s).toFixed(1)),o?we():we(!1,{x:c.x*s+c.width*s/2,y:c.y*s+c.height*s/2}),"zoom"==r.getMode()&&c.width&&J(),Ee()}};F=function(e){var t=e.value/100;if(t<.001)return void(e.value=.1);var n=r.getZoom(),o=W;Ne(window,{width:0,height:0,x:(o[0].scrollLeft+o.width()/2)/n,y:(o[0].scrollTop+o.height()/2)/n,zoom:t},!0)},e("#cur_context_panel").delegate("a","click",function(){var t=e(this);return t.attr("data-root")?r.leaveContext():r.setContext(t.text()),r.clearSelection(),!1});var Pe=function(t,n){var o="";if(n){var i="";o='<a href="#" data-root="y">'+r.getCurrentDrawing().getCurrentLayerName()+"</a>",e(n).parentsUntil("#svgcontent > g").andSelf().each(function(){this.id&&(i+=" > "+this.id,o+=this!==n?' > <a href="#">'+this.id+"</a>":" > "+this.id)}),le=i}else le=null;e("#cur_context_panel").toggle(!!n).html(o),Ce()},Ae=function(){X.fill.prep(),X.stroke.prep()},Ie={},De=function(){e(".tools_flyout").each(function(){var t=e("#"+this.id+"_show");if(!t.data("isLibrary")){var n=[];e(this).children().each(function(){n.push(this.title)}),t[0]&&(t[0].title=n.join(" / "))}})},Ue=function(){e(".tools_flyout").each(function(){var t=e("#"+this.id+"_show"),n=t.offset(),o=t.outerWidth();n&&e(this).css({left:(n.left+o)*s.tool_scale,top:n.top})})},Fe=function(t){e.each(t,function(n,o){var i=e(n).children(),a=n+"_show",l=e(a),s=!1;i.addClass("tool_button").unbind("click mousedown mouseup").each(function(n){var i=o[n];Ie[i.sel]=i.fn,i.isDefault&&(s=n);var r=function(n){var o=i;if("keydown"===n.type){var s=e(o.parent+"_show").hasClass("tool_button_current"),r=e(o.parent+"_show").attr("data-curopt");e.each(t[i.parent],function(e,a){a.sel==r&&(o=n.shiftKey&&s?t[i.parent][e+1]||t[i.parent][0]:a)})}if(e(this).hasClass("disabled"))return!1;he(a)&&o.fn();var c;c=o.icon?e.getSvgIcon(o.icon,!0):e(o.sel).children().eq(0).clone(),c[0].setAttribute("width",l.width()),c[0].setAttribute("height",l.height()),l.children(":not(.flyout_arrow_horiz)").remove(),l.append(c).attr("data-curopt",o.sel)};e(this).mouseup(r),i.key&&e(document).bind("keydown",i.key[0]+" shift+"+i.key[0],r)}),s?l.attr("data-curopt",o[s].sel):l.attr("data-curopt")||l.attr("data-curopt",o[0].sel);var r,c=e(a).position();l.mousedown(function(t){if(l.hasClass("disabled"))return!1;var o=e(n),i=c.left+34,a=o.width()*-1,s=o.data("shown_popop")?200:0;r=setTimeout(function(){l.data("isLibrary")?o.css("left",i).show():o.css("left",a).show().animate({left:i},150),o.data("shown_popop",!0)},s),t.preventDefault()}).mouseup(function(t){clearTimeout(r);var n=e(this).attr("data-curopt");return l.data("isLibrary")&&e(a.replace("_show","")).is(":visible")?void he(a,!0):void(he(a)&&Ie[n]&&Ie[n]())})}),De(),Ue()},Oe=function(t,n){var o=e("<div>",{class:"tools_flyout",id:t}).appendTo("#svg_editor").append(n);return o},Me=function(){var e,t=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,n=document.getElementsByTagName("script")[0];for(e in n.style)if(t.test(e))return e.match(t)[0];return"WebkitOpacity"in n.style?"Webkit":"KhtmlOpacity"in n.style?"Khtml":""}(),Re=function(t,n){var o=["top","left","bottom","right"];t.each(function(){var t,i=e(this),a=i.outerWidth()*(n-1),l=i.outerHeight()*(n-1);for(t=0;t<4;t++){var s=o[t],r=i.data("orig_margin-"+s);null==r&&(r=parseInt(i.css("margin-"+s),10),i.data("orig_margin-"+s,r));var c=r*n;"right"===s?c+=a:"bottom"===s&&(c+=l),i.css("margin-"+s,c)}})},ze=s.setIconSize=function(t){var n="#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout",o=e(n),i=1;if("number"==typeof t)i=t;else{var a={s:.75,m:1,l:1.25,xl:1.5};i=a[t]}s.tool_scale=i,Ue();var l=o.parents(":hidden");l.css("visibility","hidden").show(),Re(o,i),l.css("visibility","visible").hide(),e.pref("iconsize",t),e("#iconsize").val(t);var r={"#tools_top":{left:50+e("#main_button").width(),height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}},c=e("#tool_size_rules");if(c.length?c.empty():c=e('<style id="tool_size_rules"></style>').appendTo("head"),"m"!==t){var u="";e.each(r,function(n,o){n="#svg_editor "+n.replace(/,/g,", #svg_editor"),u+=n+"{",e.each(o,function(e,n){var o;"number"==typeof n?o=n*i+"px":(n[t]||n.all)&&(o=n[t]||n.all),u+=e+":"+o+";"}),u+="}"});var d="-"+Me.toLowerCase()+"-";u+=n+"{"+d+"transform: scale("+i+");} #svg_editor div.toolset .toolset {"+d+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+d+"transform: scale("+1/i+");}",c.text(u)}Ue()},Ge=function(t,n,o,i){var a=e(t);n=e(n);var l=!1,s=i.dropUp;s&&e(t).addClass("dropup"),n.find("li").bind("mouseup",function(){i.seticon&&(A("#cur_"+a[0].id,e(this).children()),e(this).addClass("current").siblings().removeClass("current")),o.apply(this,arguments)}),e(window).mouseup(function(e){l||(a.removeClass("down"),n.hide(),n.css({top:0,left:0})),l=!1}),a.bind("mousedown",function(){var e=a.offset();s?(e.top-=n.height(),e.left+=8):e.top+=a.height(),n.offset(e),a.hasClass("down")?(n.hide(),n.css({top:0,left:0})):(n.show(),l=!0),a.toggleClass("down")}).hover(function(){l=!0}).mouseout(function(){l=!1}),i.multiclick&&n.mousedown(function(){l=!0})},je=[],Be=function(t,n){function o(){U&&(clearTimeout(U),U=null),a||(U=setTimeout(function(){a=!0,ze(e.pref("iconsize"))},50))}if(n){var i=!1,a=!1,l=!0;if(n.langReady)if(s.langChanged){var r=e.pref("lang");n.langReady({lang:r,uiStrings:y})}else je.push(n);var c=function(){n.callback&&!i&&l&&(i=!0,n.callback())},u=[];if(n.context_tools&&e.each(n.context_tools,function(t,n){var o,i=n.container_id?' id="'+n.container_id+'"':"",a=e("#"+n.panel);switch(a.length||(a=e("<div>",{id:n.panel}).appendTo("#tools_top")),n.type){case"tool_button":o='<div class="tool_button">'+n.id+"</div>";var l=e(o).appendTo(a);n.events&&e.each(n.events,function(t,n){e(l).bind(t,n)});break;case"select":o="<label"+i+'><select id="'+n.id+'">',e.each(n.options,function(e,t){var i=e==n.defval?" selected":"";o+='<option value="'+e+'"'+i+">"+t+"</option>"}),o+="</select></label>";var s=e(o).appendTo(a).find("select");e.each(n.events,function(t,n){e(s).bind(t,n)});break;case"button-select":o='<div id="'+n.id+'" class="dropdown toolset" title="'+n.title+'"><div id="cur_'+n.id+'" class="icon_label"></div><button></button></div>';var r=e('<ul id="'+n.id+'_opts"></ul>').appendTo("#option_lists");n.colnum&&r.addClass("optcols"+n.colnum);e(o).appendTo(a).children();u.push({elem:"#"+n.id,list:"#"+n.id+"_opts",title:n.title,callback:n.events.change,cur:"#cur_"+n.id});break;case"input":o="<label"+i+'><span id="'+n.id+'_label">'+n.label+':</span><input id="'+n.id+'" title="'+n.title+'" size="'+(n.size||"4")+'" value="'+(n.defval||"")+'" type="text"/></label>';var c=e(o).appendTo(a).find("input");n.spindata&&c.SpinButton(n.spindata),n.events&&e.each(n.events,function(e,t){
c.bind(e,t)})}}),n.buttons){var d={},f={},p=n.svgicons,v={};e.each(n.buttons,function(t,n){for(var o,i,a,l=n.id,s=t;e("#"+l).length;)l=n.id+"_"+ ++s;p||void 0==p?(d[l]=n.icon,i=n.svgicon||n.id,"app_menu"==n.type?f["#"+l+" > div"]=i:f["#"+l]=i):o=e('<img src="'+n.icon+'">');var r,c;switch(n.type){case"mode_flyout":case"mode":r="tool_button",c="#tools_left";break;case"context":r="tool_button",c="#"+n.panel,e(c).length||e("<div>",{id:n.panel}).appendTo("#tools_top");break;case"app_menu":r="",c="#main_menu ul"}var u,g,h,m,_,w=e(n.list||"app_menu"==n.type?"<li/>":"<div/>").attr("id",l).attr("title",n.title).addClass(r);if(n.includeWith||n.list){if(n.list)w.addClass("push_button"),e("#"+n.list+"_opts").append(w),n.isDefault&&(e("#cur_"+n.list).append(w.children().clone()),i=n.svgicon||n.id,f["#cur_"+n.list]=i);else if(n.includeWith){var y=n.includeWith;_=e(y.button),u=_.parent(),_.parent().hasClass("tools_flyout")||(a=_[0].id.replace("tool_","tools_"),h=_.clone().attr("id",a+"_show").append(e("<div>",{class:"flyout_arrow_horiz"})),_.before(h),u=Oe(a,_)),m=O.getButtonData(y.button),y.isDefault&&(f["#"+a+"_show"]=n.id),g=v["#"+u[0].id]=[{sel:"#"+l,fn:n.events.click,icon:n.id,key:n.key,isDefault:n.includeWith?n.includeWith.isDefault:0},m];var b="position"in y?y.position:"last",k=u.children().length;!isNaN(b)&&b>=0&&b<k?u.children().eq(b).before(w):(u.append(w),g.reverse())}}else"position"in n?e(c).children().eq(n.position).length?e(c).children().eq(n.position).before(w):e(c).children().last().before(w):w.appendTo(c),"mode_flyout"==n.type?(_=e(w),u=_.parent(),_.parent().hasClass("tools_flyout")||(a=_[0].id.replace("tool_","tools_"),h=_.clone().attr("id",a+"_show").append(e("<div>",{class:"flyout_arrow_horiz"})),_.before(h),u=Oe(a,_),u.data("isLibrary",!0),h.data("isLibrary",!0)),f["#"+a+"_show"]=n.id,g=v["#"+u[0].id]=[{sel:"#"+l,fn:n.events.click,icon:n.id,isDefault:!0},m]):"app_menu"==n.type&&w.append("<div>").append(n.title);p||w.append(o),n.list||e.each(n.events,function(t,o){"click"==t&&"mode"==n.type?(n.includeWith?w.bind(t,o):w.bind(t,function(){he(w)&&o()}),n.key&&(e(document).bind("keydown",n.key,o),n.title&&w.attr("title",n.title+" ["+n.key+"]"))):w.bind(t,o)}),Fe(v)}),e.each(u,function(){Ge(this.elem,this.list,this.callback,{seticon:!0})}),p&&(l=!1),e.svgIcons(p,{w:24,h:24,id_match:!1,no_img:!svgedit.browser.isWebkit(),fallback:d,placement:f,callback:function(t){"m"!==e.pref("iconsize")&&o(),l=!0,c()}})}n.mySetMarker&&(s.setMarker=n.mySetMarker),c()}},We=function(t,n,o){var i={alpha:n};if(0===t.indexOf("url(#")){var a=r.getRefElem(t);a=a?a.cloneNode(!0):e("#"+o+"_color defs *")[0],i[a.tagName]=a}else 0===t.indexOf("#")?i.solidColor=t.substr(1):i.solidColor="none";return new e.jGraduate.Paint(i)};e("#text").focus(function(){$=!0}),e("#text").blur(function(){$=!1}),r.bind("selected",Se),r.bind("transition",Le),r.bind("changed",Te),r.bind("saved",pe),r.bind("exported",ve),r.bind("exportedPDF",function(e,t){var n=t.exportWindowName;n&&(H=window.open("",n)),H.location.href=t.dataurlstring}),r.bind("zoomed",Ne),r.bind("contextset",Pe),r.bind("extension_added",Be),r.textActions.setInputElem(e("#text")[0]);var Ve='<div class="palette_item" style="background-color:#FFF;color:red;font-size:20px;line-height: 15px;text-align:center;" data-rgb="none">X</div>';e.each(R,function(e,t){Ve+='<div class="palette_item" style="background-color: '+t+';" data-rgb="'+t+'"></div>'}),e("#palette").append(Ve);var He=["#FFF","#888","#000"];Ve="",e.each(He,function(){Ve+='<div class="color_block" style="background-color:'+this+';"></div>'}),e("#bg_blocks").append(Ve);var qe=e("#bg_blocks div"),Qe="cur_background";qe.each(function(){var t=e(this);t.click(function(){qe.removeClass(Qe),e(this).addClass(Qe)})}),i(e.pref("bkgd_color"),e.pref("bkgd_url")),e("#image_save_opts input").val([e.pref("img_save")]);var Ze=function(e){r.setRectRadius(e.value)},Ke=function(e){r.setFontSize(e.value)},Xe=function(e){var t=e.value;0==t&&ee&&["line","polyline"].indexOf(ee.nodeName)>=0&&(t=e.value=1),r.setStrokeWidth(t)},Ye=function(t){r.setRotationAngle(t.value),e("#tool_reorient").toggleClass("disabled",0===parseInt(t.value,10))},Je=function(t,n){null==n&&(n=t.value),e("#group_opacity").val(n),t&&t.handle||e("#opac_slider").slider("option","value",n),r.setOpacity(n/100)},$e=function(t,n,o){null==n&&(n=t.value),e("#blur").val(n);var i=!1;t&&t.handle||(e("#blur_slider").slider("option","value",n),i=!0),o?r.setBlurNoUndo(n):r.setBlur(n,i)};e("#stroke_style").change(function(){r.setStrokeAttr("stroke-dasharray",e(this).val()),ge()}),e("#stroke_linejoin").change(function(){r.setStrokeAttr("stroke-linejoin",e(this).val()),ge()}),e("select").change(function(){e(this).blur()});var et=!1;e("#selLayerNames").change(function(){var t=this.options[this.selectedIndex].value,n=y.notification.QmoveElemsToLayer.replace("%s",t),o=function(e){e&&(et=!0,r.moveSelectedToLayer(t),r.clearSelection(),ue())};t&&(et?o(!0):e.confirm(n,o))}),e("#font_family").change(function(){r.setFontFamily(this.value)}),e("#seg_type").change(function(){r.setSegType(e(this).val())}),e("#text").keyup(function(){r.setTextContent(this.value)}),e("#image_url").change(function(){_e(this.value)}),e("#link_url").change(function(){this.value.length?r.setLinkURL(this.value):r.removeHyperlink()}),e("#g_title").change(function(){r.setGroupTitle(this.value)}),e(".attr_changer").change(function(){var t=this.getAttribute("data-attr"),n=this.value,o=svgedit.units.isValidUnit(t,n,ee);if(!o)return e.alert(y.notification.invalidAttrValGiven),this.value=ee.getAttribute(t),!1;if("id"!==t&&"class"!==t)if(isNaN(n))n=r.convertToNum(t,n);else if("px"!==m.baseUnit){var i=svgedit.units.getTypeMap();(ee[t]||"pathedit"===r.getMode()||"x"===t||"y"===t)&&(n*=i[m.baseUnit])}if("id"===t){var a=ee;r.clearSelection(),a.id=n,r.addToSelection([a],!0)}else r.changeSelectedAttribute(t,n);this.blur()}),e("#palette").mouseover(function(){var t=e('<input type="hidden">');e(this).append(t),t.focus().remove()}),e(".palette_item").mousedown(function(t){var n,o=t.shiftKey||2===t.button?"stroke":"fill",i=e(this).data("rgb");"none"===i||"transparent"===i||"initial"===i?(i="none",n=new e.jGraduate.Paint):n=new e.jGraduate.Paint({alpha:100,solidColor:i.substr(1)}),X[o].setPaint(n),r.setColor(o,i),"none"!==i&&1!==r.getPaintOpacity(o)&&r.setPaintOpacity(o,1),s.changeColor&&s.changeColor(o,i),ye()}).bind("contextmenu",function(e){e.preventDefault()}),e("#toggle_stroke_tools").on("click",function(){e("#tools_bottom").toggleClass("expanded")}),function(){var t=null,n=null,o=W[0],i=!1,a=!1;e("#svgcanvas").bind("mousemove mouseup",function(e){if(i!==!1)return o.scrollLeft-=e.clientX-t,o.scrollTop-=e.clientY-n,t=e.clientX,n=e.clientY,"mouseup"===e.type&&(i=!1),!1}).mousedown(function(e){if(1===e.button||a===!0)return i=!0,t=e.clientX,n=e.clientY,!1}),e(window).mouseup(function(){i=!1}),e(document).bind("keydown","space",function(e){r.spaceKey=a=!0,e.preventDefault()}).bind("keyup","space",function(e){e.preventDefault(),r.spaceKey=a=!1}).bind("keydown","shift",function(e){"zoom"===r.getMode()&&W.css("cursor",Q)}).bind("keyup","shift",function(e){"zoom"===r.getMode()&&W.css("cursor",q)}),s.setPanning=function(e){r.spaceKey=a=e}}(),function(){var t=e("#main_icon"),n=e("#main_icon span"),o=e("#main_menu"),i=!1,a=0,l=!0,s=!1;e(window).mouseup(function(n){i||(t.removeClass("buttondown"),"INPUT"!=n.target.tagName?o.fadeOut(200):s||(s=!0,e(n.target).click(function(){o.css("margin-left","-9999px").show()}))),i=!1}).mousedown(function(t){var n=e(t.target).closest("div.tools_flyout, .contextMenu").length;n||e(".tools_flyout:visible,.contextMenu").fadeOut(250)}),n.bind("mousedown",function(){t.hasClass("buttondown")?o.fadeOut(200):(o.css("margin-left",0).show(),a||(a=o.height()),o.css("height",0).animate({height:a},200),i=!0),t.toggleClass("buttondown buttonup")}).hover(function(){i=!0}).mouseout(function(){i=!1});var r=e("#main_menu li");r.mouseover(function(){l="rgba(0, 0, 0, 0)"==e(this).css("background-color"),r.unbind("mouseover"),l&&r.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){return this.style.backgroundColor="transparent",!0})})}(),s.addDropDown=function(t,n,o){if(0!=e(t).length){var i=e(t).find("button"),a=e(t).find("ul").attr("id",e(t)[0].id+"-list"),l=!1;o?e(t).addClass("dropup"):e("#option_lists").append(a),a.find("li").bind("mouseup",n),e(window).mouseup(function(e){l||(i.removeClass("down"),a.hide()),l=!1}),i.bind("mousedown",function(){if(i.hasClass("down"))a.hide();else{if(!o){var n=e(t).position();a.css({top:n.top+24,left:n.left-10})}a.show(),l=!0}i.toggleClass("down")}).hover(function(){l=!0}).mouseout(function(){l=!1})}},s.addDropDown("#font_family_dropdown",function(){e("#font_family").val(e(this).text()).change()}),s.addDropDown("#opacity_dropdown",function(){if(!e(this).find("div").length){var t=parseInt(e(this).text().split("%")[0],10);Je(!1,t)}},!0),e("#opac_slider").slider({start:function(){e("#opacity_dropdown li:not(.special)").hide()},stop:function(){e("#opacity_dropdown li").show(),e(window).mouseup()},slide:function(e,t){Je(t)}}),s.addDropDown("#blur_dropdown",e.noop);var tt=!1;e("#blur_slider").slider({max:10,step:.1,stop:function(t,n){tt=!1,$e(n),e("#blur_dropdown li").show(),e(window).mouseup()},start:function(){tt=!0},slide:function(e,t){$e(t,null,tt)}}),s.addDropDown("#zoom_dropdown",function(){var t=e(this),n=t.data("val");n?Ne(window,n):F({value:parseFloat(t.text())})},!0),Ge("#stroke_linecap","#linecap_opts",function(){o(this,!0)},{dropUp:!0}),Ge("#stroke_linejoin","#linejoin_opts",function(){o(this,!0)},{dropUp:!0}),Ge("#tool_position","#position_opts",function(){var e=this.id.replace("tool_pos","").charAt(0);r.alignSelectedElements(e,"page")},{multiclick:!0}),function(){var t,n=function(){e(t).blur()};e("#svg_editor").find("button, select, input:not(#text)").focus(function(){t=this,Z="toolbars",W.mousedown(n)}).blur(function(){Z="canvas",W.unbind("mousedown",n),"textedit"==r.getMode()&&e("#text").focus()})}();var nt=function(){he("#tool_fhpath")&&r.setMode("fhpath")},ot=function(){he("#tool_line")&&r.setMode("line")},it=function(){he("#tool_square")&&r.setMode("square")},at=function(){he("#tool_rect")&&r.setMode("rect")},lt=function(){he("#tool_fhrect")&&r.setMode("fhrect")},st=function(){he("#tool_circle")&&r.setMode("circle")},rt=function(){he("#tool_ellipse")&&r.setMode("ellipse")},ct=function(){he("#tool_fhellipse")&&r.setMode("fhellipse")},ut=function(){he("#tool_image")&&r.setMode("image")},dt=function(){he("#tool_zoom")&&(r.setMode("zoom"),W.css("cursor",q))},ft=function(t){var n=r.getResolution();t=t?n.zoom*t:1,e("#zoom").val(100*t),r.setZoom(t),Ee(),we(!0)},pt=function(){he("#tool_zoom")&&(ft(),J())},vt=function(){he("#tool_text")&&r.setMode("text")},gt=function(){he("#tool_path")&&r.setMode("path")};s.clickExtension=function(e){r.clickExtension(e)},s.clickZoom=function(){r.setMode("zoom"),W.css("cursor",q)},s.clickToSetMode=function(e){r.setMode(e)},s.getSvgString=function(){return r.getSvgString()},s.getSelectedElements=function(){return r.getSelectedElems()},s.setSvgString=function(e){return r.setSvgString(e)},s.enableGridSnapping=function(e){m.gridSnapping=e},s.setDocProperty=function(e,t,n,o){return!("fit"!=t&&!svgedit.units.isValidUnit("width",t))&&(!("fit"!=n&&!svgedit.units.isValidUnit("height",n))&&(!!r.setResolution(t,n)&&(o||(o="#ffffff"),!(o&&!r.setBackground(o))&&void we())))},s.alignSelectedElements=function(e){r.alignSelectedElements(e,"page")},s.setColor=function(e,t,n){var o={alpha:t,solidColor:e,type:"solidColor"};X[n].setPaint(o),r.setPaint(n,o)},s.setStrokeOption=function(e){o(e,!0)},s.setFilterShadow=function(e){r.setFilterShadow(e)},s.setFontFamily=function(e){r.setFontFamily(e)},s.setTextAlign=function(e){r.setTextAlign(e)},s.clickClearAll=function(){var e=m.dimensions;J(),r.clear(),r.setResolution(e[0],e[1]),we(!0),ft(),ue(),ke(),Ae(),r.runExtensions("onNewDocument")},s.clearSelection=function(){r.clearSelection()},s.setMarker=function(e,t){console.log("marker selected "+e+" "+t)};var ht=function(){if(null!=ee||te){var e=r.deleteSelectedElements();null!=a&&a(e)}},mt=function(){(null!=ee||te)&&r.cutSelectedElements()},_t=function(){(null!=ee||te)&&r.copySelectedElements()},wt=function(){var e=r.getZoom(),t=(W[0].scrollLeft+W.width()/2)/e-r.contentW,n=(W[0].scrollTop+W.height()/2)/e-r.contentH;r.pasteElements("point",t,n)},yt=function(){null!=ee&&r.moveToTopSelectedElement()},bt=function(){null!=ee&&r.moveToBottomSelectedElement()},kt=function(e){null!=ee&&r.moveUpDownSelected(e)},xt=function(){null!=ee&&r.convertToPath()},Ct=function(){null!=ee&&G.reorient()},St=function(){(null!=ee||te)&&e.prompt(y.notification.enterNewLinkURL,"http://",function(e){e&&r.makeHyperlink(e)})},Lt=function(e,t){if(null!=ee||te){if(m.gridSnapping){var n=r.getZoom()*m.snappingStep;e*=n,t*=n}r.moveSelectedElements(e,t)}},Tt=function(){e("#tool_node_link").toggleClass("push_button_pressed tool_button");var t=e("#tool_node_link").hasClass("push_button_pressed");G.linkControlPoints(t)},Et=function(){G.getNodePoint()&&G.clonePathNode()},Nt=function(){G.getNodePoint()&&G.deletePathNode()},Pt=function(){var t=e("#tool_add_subpath"),n=!t.hasClass("push_button_pressed");t.toggleClass("push_button_pressed tool_button"),G.addSubPath(n)},At=function(){G.opencloseSubPath()},It=function(){r.cycleElement(1)},Dt=function(){r.cycleElement(0)},Ut=function(t,n){if(null!=ee&&!te){t||(n*=-1);var o=parseFloat(e("#angle").val())+n;r.setRotationAngle(o),ke()}};clickClear=function(){var t=m.dimensions;e.confirm(y.notification.QwantToClear,function(e){e&&(J(),r.clear(),r.setResolution(t[0],t[1]),we(!0),ft(),ue(),ke(),Ae(),r.runExtensions("onNewDocument"))})};var Ft=function(){return r.setBold(!r.getBold()),ke(),!1},Ot=function(){return r.setItalic(!r.getItalic()),ke(),!1},Mt=function(){var t={images:e.pref("img_save"),round_digits:6};r.save(t)},Rt=function(){e.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP","PDF"],function(t){function n(){var e=y.notification.loadingImage;"new"===m.exportWindowType&&s.exportWindowCt++,o=m.canvasName+s.exportWindowCt,H=window.open("data:text/html;charset=utf-8,"+encodeURIComponent("<title>"+e+"</title><h1>"+e+"</h1>"),o)}if(t){var o;if("PDF"===t)p||n(),r.exportPDF(o);else{f||n();var i=parseInt(e("#image-slider").val(),10)/100;r.rasterExport(t,i,o)}}},function(){var t=e(this);"JPEG"===t.val()||"WEBP"===t.val()?e("#image-slider").length||e('<div><label>Quality: <input id="image-slider" type="range" min="1" max="100" value="92" /></label></div>').appendTo(t.parent()):e("#image-slider").parent().remove()})},zt=function(){r.open()},Gt=function(){},jt=function(){j.getUndoStackSize()>0&&(j.undo(),ue())},Bt=function(){j.getRedoStackSize()>0&&(j.redo(),ue())},Wt=function(){te?r.groupSelectedElements():ee&&r.ungroupSelectedElement()},Vt=function(){r.cloneSelectedElements(20,20)},Ht=function(){var t=this.id.replace("tool_align","").charAt(0);r.alignSelectedElements(t,e("#align_relative_to").val())},qt=function(){if(e("#tool_wireframe").toggleClass("push_button_pressed tool_button"),W.toggleClass("wireframe"),!D){var t=e("#wireframe_rules");t.length?t.empty():t=e('<style id="wireframe_rules"></style>').appendTo("head"),xe()}};e("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});var Qt=function(){if(!ie){ie=!0,e("#image_save_opts input").val([e.pref("img_save")]);var t=r.getResolution();"px"!==m.baseUnit&&(t.w=svgedit.units.convertUnit(t.w)+m.baseUnit,t.h=svgedit.units.convertUnit(t.h)+m.baseUnit),e("#canvas_width").val(t.w),e("#canvas_height").val(t.h),e("#canvas_title").val(r.getDocumentTitle()),e("#svg_docprops").show()}},Zt=function(){if(!ae){ae=!0,e("#main_menu").hide();var t=e("#bg_blocks div"),n="cur_background",o=h.bkgd_color,i=e.pref("bkgd_url");t.each(function(){var t=e(this),i=t.css("background-color")==o;t.toggleClass(n,i),i&&e("#canvas_bg_url").removeClass(n)}),o||t.eq(0).addClass(n),i&&e("#canvas_bg_url").val(i),e("#grid_snapping_on").prop("checked",m.gridSnapping),e("#grid_snapping_step").attr("value",m.snappingStep),e("#grid_color").attr("value",m.gridColor),e("#svg_prefs").show()}},Kt=function(){e("#svg_source_editor").hide(),oe=!1,e("#svg_source_textarea").blur()},Xt=function(){if(oe){var t=function(){r.clearSelection(),Kt(),ft(),ue(),Ce(),Ae()};r.setSvgString(e("#svg_source_textarea").val())?t():e.confirm(y.notification.QerrorsRevertToSource,function(e){return!!e&&void t()}),J()}},Yt=function(){e("#svg_docprops").hide(),e("#canvas_width,#canvas_height").removeAttr("disabled"),e("#resolution")[0].selectedIndex=0,e("#image_save_opts input").val([e.pref("img_save")]),ie=!1},Jt=function(){e("#svg_prefs").hide(),ae=!1},$t=function(){var t=e("#canvas_title").val();Ce(t),r.setDocumentTitle(t);var n=e("#canvas_width"),o=n.val(),i=e("#canvas_height"),a=i.val();return"fit"==o||svgedit.units.isValidUnit("width",o)?(n.parent().removeClass("error"),"fit"==a||svgedit.units.isValidUnit("height",a)?(i.parent().removeClass("error"),r.setResolution(o,a)?(e.pref("img_save",e("#image_save_opts :checked").val()),we(),void Yt()):(e.alert(y.notification.noContentToFitTo),!1)):(e.alert(y.notification.invalidAttrValGiven),i.parent().addClass("error"),!1)):(e.alert(y.notification.invalidAttrValGiven),n.parent().addClass("error"),!1)},en=s.savePreferences=function(){var t=e("#bg_blocks div.cur_background").css("background-color")||"#FFF";i(t,e("#canvas_bg_url").val());var n=e("#lang_select").val();n!==e.pref("lang")&&s.putLocale(n,P),ze(e("#iconsize").val()),m.gridSnapping=e("#grid_snapping_on")[0].checked,m.snappingStep=e("#grid_snapping_step").val(),m.gridColor=e("#grid_color").val(),m.showRulers=e("#show_rulers")[0].checked,e("#rulers").toggle(m.showRulers),m.showRulers&&v(),m.baseUnit=e("#base_unit").val(),r.setConfig(m),we(),Jt()},tn=e.noop,nn=function(){return e("#dialog_box").hide(),oe||ie||ae?(oe?K!==e("#svg_source_textarea").val()?e.confirm(y.notification.QignoreSourceChanges,function(e){e&&Kt()}):Kt():ie?Yt():ae&&Jt(),void tn()):void(le&&r.leaveContext())},on={width:e(window).width(),height:e(window).height()};if(svgedit.browser.isIE()&&function(){tn=function(){0===W[0].scrollLeft&&0===W[0].scrollTop&&(W[0].scrollLeft=M.left,W[0].scrollTop=M.top)},M={left:W[0].scrollLeft,top:W[0].scrollTop},e(window).resize(tn),s.ready(function(){setTimeout(function(){tn()},500)}),W.scroll(function(){M={left:W[0].scrollLeft,top:W[0].scrollTop}})}(),e(window).resize(function(t){e.each(on,function(t,n){var o=e(window)[t]();W[0]["scroll"+("width"===t?"Left":"Top")]-=(o-n)/2,on[t]=o}),Ue()}),function(){W.scroll(function(){0!=e("#ruler_x").length&&(e("#ruler_x")[0].scrollLeft=W[0].scrollLeft),0!=e("#ruler_y").length&&(e("#ruler_y")[0].scrollTop=W[0].scrollTop)})}(),e("#url_notice").click(function(){e.alert(this.title)}),e("#change_image_url").click(d),function(){var t=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],n="",o="tool_button_current";e.each(t,function(e,t){n+=(e?",":"")+"#tool_"+t}),e(n).mousedown(function(){e(this).addClass(o)}).bind("mousedown mouseout",function(){e(this).removeClass(o)}),e("#tool_undo, #tool_redo").mousedown(function(){e(this).hasClass("disabled")||e(this).addClass(o)}).bind("mousedown mouseout",function(){e(this).removeClass(o)})}(),svgedit.browser.isMac()&&!window.opera){var an=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(Y=an.length;Y--;){var ln=document.getElementById(an[Y]);if(ln){var sn=ln.title,rn=sn.indexOf("Ctrl+");ln.title=[sn.substr(0,rn),"Cmd+",sn.substr(rn+5)].join("")}}}var cn=function(t){var n="stroke_color"==t.attr("id")?"stroke":"fill",o=X[n].paint,i="stroke"==n?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity",a=t.offset();e("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(m.colorPickerCSS||{left:a.left-140,bottom:40}).jGraduate({paint:o,window:{pickerTitle:i},images:{clientPath:m.jGraduatePath},newstop:"inverse"},function(t){o=new e.jGraduate.Paint(t),X[n].setPaint(o),r.setPaint(n,o),e("#color_picker").hide()},function(){e("#color_picker").hide()})},un=function(t,n){var o,i,a=m["fill"===n?"initFill":"initStroke"],l=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"\t\t\t\t\tfill="#'+a.color+'" opacity="'+a.opacity+'"/>\t\t\t\t\t<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml"),s=l.documentElement;s=e(t)[0].appendChild(document.importNode(s,!0)),s.setAttribute("width",16.5),this.rect=s.firstChild,this.defs=s.getElementsByTagName("defs")[0],this.grad=this.defs.firstChild,this.paint=new e.jGraduate.Paint({solidColor:a.color}),this.type=n,this.setPaint=function(e,t){this.paint=e;var n="none",a=e.type,l=e.alpha/100;switch(a){case"solidColor":n="none"!=e[a]?"#"+e[a]:e[a];break;case"linearGradient":case"radialGradient":this.defs.removeChild(this.grad),this.grad=this.defs.appendChild(e[a]);var s=this.grad.id="gradbox_"+this.type;n="url(#"+s+")"}this.rect.setAttribute("fill",n),this.rect.setAttribute("opacity",l),t&&(r.setColor(this.type,o,!0),r.setPaintOpacity(this.type,i,!0))},this.update=function(e){if(ee){var t,n,a=this.type;switch(ee.tagName){case"use":case"image":case"foreignObject":return;case"g":case"a":var l=null,s=ee.getElementsByTagName("*");for(t=0,n=s.length;t<n;t++){var c=s[t],u=c.getAttribute(a);if(0===t)l=u;else if(l!==u){l=null;break}}if(null===l)return void(o=null);o=l,i=1;break;default:i=parseFloat(ee.getAttribute(a+"-opacity")),isNaN(i)&&(i=1);var d="fill"===a?"black":"none";o=ee.getAttribute(a)||d}e&&(r.setColor(a,o,!0),r.setPaintOpacity(a,i,!0)),i*=100;var f=We(o,i,a);this.setPaint(f)}},this.prep=function(){var t=this.paint.type;switch(t){case"linearGradient":case"radialGradient":var o=new e.jGraduate.Paint({copy:this.paint});r.setPaint(n,o)}}};X.fill=new un("#fill_color","fill"),X.stroke=new un("#stroke_color","stroke"),e("#stroke_width").val(m.initStroke.width),e("#group_opacity").val(100*m.initOpacity);var dn=X.fill.rect.cloneNode(!1);dn.setAttribute("style","vector-effect:non-scaling-stroke"),D="non-scaling-stroke"===dn.style.vectorEffect,dn.removeAttribute("style");var fn=X.fill.rect.ownerDocument,pn=fn.createElementNS(svgedit.NS.SVG,"feGaussianBlur");void 0===pn.stdDeviationX&&e("#tool_blur").hide(),e(pn).remove(),function(){var e="-"+Me.toLowerCase()+"-zoom-",t=e+"in";W.css("cursor",t),W.css("cursor")===t&&(q=t,Q=e+"out"),W.css("cursor","auto")}(),e("#fill_color, #tool_fill .icon_label").click(function(){cn(e("#fill_color")),ye()}),e("#stroke_color, #tool_stroke .icon_label").click(function(){cn(e("#stroke_color")),ye()}),e("#group_opacityLabel").click(function(){e("#opacity_dropdown button").mousedown(),e(window).mouseup()}),e("#zoomLabel").click(function(){e("#zoom_dropdown button").mousedown(),e(window).mouseup()}),e("#tool_move_top").mousedown(function(t){e("#tools_stacking").show(),t.preventDefault()}),e(".layer_button").mousedown(function(){e(this).addClass("layer_buttonpressed")}).mouseout(function(){e(this).removeClass("layer_buttonpressed")}).mouseup(function(){e(this).removeClass("layer_buttonpressed")}),e(".push_button").mousedown(function(){e(this).hasClass("disabled")||e(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){e(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){e(this).removeClass("push_button_pressed").addClass("push_button")}),e("#layer_new").click(function(){var t,n=r.getCurrentDrawing().getNumLayers();do t=y.layers.layer+" "+ ++n;while(r.getCurrentDrawing().hasLayer(t));e.prompt(y.notification.enterUniqueLayerName,t,function(t){if(t){if(r.getCurrentDrawing().hasLayer(t))return void e.alert(y.notification.dupeLayerName);r.createLayer(t),ke(),ue()}})}),e("#layer_delete").click(b),e("#layer_up").click(function(){C(-1)}),e("#layer_down").click(function(){C(1)}),e("#layer_rename").click(function(){var t=e("#layerlist tr.layersel td.layername").text();e.prompt(y.notification.enterNewLayerName,"",function(n){if(n){if(t==n||r.getCurrentDrawing().hasLayer(n))return void e.alert(y.notification.layerHasThatName);r.renameCurrentLayer(n),ue()}})});var vn=300,gn=150,hn=-1,mn=!1,_n=!1,wn=function(t){var n=e("#ruler_x");e("#sidepanels").width("+="+t),e("#layerpanel").width("+="+t),n.css("right",parseInt(n.css("right"),10)+t),W.css("right",parseInt(W.css("right"),10)+t),r.runExtensions("workareaResized")},yn=function(t){if(_n&&hn!=-1){mn=!0;var n=hn-t.pageX,o=e("#sidepanels").width();o+n>vn?(n=vn-o,o=vn):o+n<2&&(n=2-o,o=2),0!=n&&(hn-=n,wn(n))}},bn=function(t){var n=e("#sidepanels").width(),o=(n>2||t?2:gn)-n;wn(o)};e("#sidepanel_handle").mousedown(function(t){hn=t.pageX,e(window).mousemove(yn),_n=!1,setTimeout(function(){_n=!0},20)}).mouseup(function(e){mn||bn(),hn=-1,mn=!1}),e(window).mouseup(function(){hn=-1,mn=!1,e("#svg_editor").unbind("mousemove",yn)}),ue();var kn=function(){W.css("line-height",W.height()+"px")};e(window).bind("load resize",kn),e("#resolution").change(function(){var t=e("#canvas_width,#canvas_height");if(this.selectedIndex)if("content"==this.value)t.val("fit").attr("disabled","disabled");else{var n=this.value.split("x");e("#canvas_width").val(n[0]),e("#canvas_height").val(n[1]),t.removeAttr("disabled")}else"fit"==e("#canvas_width").val()&&t.removeAttr("disabled").val(100)}),e("input,select").attr("autocomplete","off"),O=function(){var t=[{sel:"#tool_select",fn:me,evt:"click",key:["V",!0]},{sel:"#tool_fhpath",fn:nt,evt:"click",key:["Q",!0]},{sel:"#tool_line",fn:ot,evt:"click",key:["L",!0]},{sel:"#tool_rect",fn:at,evt:"mouseup",key:["R",!0],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:it,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:lt,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:rt,evt:"mouseup",key:["E",!0],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:st,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:ct,evt:"mouseup",parent:"#tools_ellipse",icon:"fh_ellipse"},{sel:"#tool_path",fn:gt,evt:"click",key:["P",!0]},{sel:"#tool_text",fn:vt,evt:"click",key:["T",!0]},{sel:"#tool_image",fn:ut,evt:"mouseup"},{sel:"#tool_zoom",fn:dt,evt:"mouseup",key:["Z",!0]},{sel:"#tool_clear",fn:clickClear,evt:"mouseup",key:["N",!0]},{sel:"#tool_save",fn:function(){oe?Xt():Mt()},evt:"mouseup",key:["S",!0]},{sel:"#tool_export",fn:Rt,evt:"mouseup"},{sel:"#tool_open",fn:zt,evt:"mouseup",key:["O",!0]},{sel:"#tool_import",fn:Gt,evt:"mouseup"},{sel:"#tool_source",fn:de,evt:"click",key:["U",!0]},{sel:"#tool_wireframe",fn:qt,evt:"click",key:["F",!0]},{sel:"#tool_source_save",fn:Xt,evt:"click"},{sel:"#tool_docprops_save",fn:$t,evt:"click"},{sel:"#tool_docprops",fn:Qt,evt:"mouseup"},{sel:"#tool_prefs_save",fn:en,evt:"click"},{sel:"#tool_prefs_option",fn:function(){return Zt(),!1},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:ht,evt:"click",key:["del/backspace",!0]},{sel:"#tool_reorient",fn:Ct,evt:"click"},{sel:"#tool_node_link",fn:Tt,evt:"click"},{sel:"#tool_node_clone",fn:Et,evt:"click"},{sel:"#tool_node_delete",fn:Nt,evt:"click"},{sel:"#tool_openclose_path",fn:At,evt:"click"},{sel:"#tool_add_subpath",fn:Pt,evt:"click"},{sel:"#tool_move_top",fn:yt,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:bt,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",fn:xt,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:St,evt:"click"},{sel:"#tool_undo",fn:jt,evt:"click",key:["Z",!0]},{sel:"#tool_redo",fn:Bt,evt:"click",key:["Y",!0]},{sel:"#tool_clone,#tool_clone_multi",fn:Vt,evt:"click",key:["D",!0]},{sel:"#tool_group_elements",fn:Wt,evt:"click",key:["G",!0]},{sel:"#tool_ungroup",fn:Wt,evt:"click"},{sel:"#tool_unlink_use",fn:Wt,evt:"click"},{sel:"[id^=tool_align]",fn:Ht,evt:"click"},{sel:"#tool_bold",fn:Ft,evt:"mousedown"},{sel:"#tool_italic",fn:Ot,evt:"mousedown"},{sel:"#sidepanel_handle",fn:bn,key:["X"]},{sel:"#copy_save_done",fn:nn,evt:"click"},{key:"ctrl+left",fn:function(){Ut(0,1)}},{key:"ctrl+right",fn:function(){Ut(1,1)}},{key:"ctrl+shift+left",fn:function(){Ut(0,5)}},{key:"ctrl+shift+right",fn:function(){Ut(1,5)}},{key:"shift+O",fn:Dt},{key:"shift+P",fn:It},{key:[z+"up",!0],fn:function(){ft(2)}},{key:[z+"down",!0],fn:function(){ft(.5)}},{key:[z+"]",!0],fn:function(){kt("Up")}},{key:[z+"[",!0],fn:function(){kt("Down")}},{key:["up",!0],fn:function(){Lt(0,-1)}},{key:["down",!0],fn:function(){Lt(0,1)}},{key:["left",!0],fn:function(){Lt(-1,0)}},{key:["right",!0],fn:function(){Lt(1,0)}},{key:"shift+up",fn:function(){Lt(0,-10)}},{key:"shift+down",fn:function(){Lt(0,10)}},{key:"shift+left",fn:function(){Lt(-10,0)}},{key:"shift+right",fn:function(){Lt(10,0)}},{key:["alt+up",!0],fn:function(){r.cloneSelectedElements(0,-1)}},{key:["alt+down",!0],fn:function(){r.cloneSelectedElements(0,1)}},{key:["alt+left",!0],fn:function(){r.cloneSelectedElements(-1,0)}},{key:["alt+right",!0],fn:function(){r.cloneSelectedElements(1,0)}},{key:["alt+shift+up",!0],fn:function(){r.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",!0],fn:function(){r.cloneSelectedElements(0,10)}},{key:["alt+shift+left",!0],fn:function(){r.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",!0],fn:function(){r.cloneSelectedElements(10,0)}},{key:"A",fn:function(){r.selectAllInCurrentLayer()}},{key:z+"z",fn:jt},{key:z+"shift+z",fn:Bt},{key:z+"y",fn:Bt},{key:z+"x",fn:mt},{key:z+"c",fn:_t},{key:z+"v",fn:wt}],n={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var o={};e.each(t,function(t,i){var a;if(i.sel){if(a=e(i.sel),0==a.length)return!0;if(i.evt&&(svgedit.browser.isTouch()&&"click"===i.evt&&(i.evt="mousedown"),a[i.evt](i.fn)),i.parent&&0!=e(i.parent+"_show").length){var l=e(i.parent);l.length||(l=Oe(i.parent.substr(1))),l.append(a),e.isArray(o[i.parent])||(o[i.parent]=[]),o[i.parent].push(i)}}if(i.key){var s,r=!0,c=i.fn,u=!1;if(e.isArray(i.key)?(s=i.key[0],i.key.length>1&&(u=i.key[1]),i.key.length>2&&(r=i.key[2])):s=i.key,s+="",e.each(s.split("/"),function(t,n){e(document).bind("keydown",n,function(e){return c(),u&&e.preventDefault(),!1})}),i.sel&&!i.hidekey&&a.attr("title")){var d=a.attr("title").split("[")[0]+" ("+s+")";n[s]=i.sel,a.parents("#main_menu").length||a.attr("title",d)}}}),Fe(o),e(".attr_changer, #image_url").bind("keydown","return",function(t){e(this).change(),t.preventDefault()}),e(window).bind("keydown","tab",function(e){"canvas"===Z&&(e.preventDefault(),It())}).bind("keydown","shift+tab",function(e){"canvas"===Z&&(e.preventDefault(),Dt())}),e("#tool_zoom").dblclick(pt)},setTitles:function(){e.each(n,function(t,n){var o=e(n).parents("#main_menu").length;e(n).each(function(){var n;n=o?e(this).text().split(" [")[0]:this.title.split(" [")[0];var i="";e.each(t.split("/"),function(e,t){var n=t.split("+"),o="";n.length>1&&(o=n[0]+"+",t=n[1]),i+=(e?"/":"")+o+(y["key_"+t]||t)}),o?this.lastChild.textContent=n+" ["+i+"]":this.title=n+" ["+i+"]"})})},getButtonData:function(n){var o;return e.each(t,function(e,t){t.sel===n&&(o=t)}),o}}}(),O.setAll(),s.ready(function(){var t,n=m.initTool,o=e("#tools_left, #svg_editor .tools_flyout"),i=o.find("#tool_"+n),a=o.find("#"+n);t=i.length?i:a.length?a:e("#tool_select"),t.click().mouseup(),m.wireframe&&e("#tool_wireframe").click(),m.showlayers&&bn(),e("#rulers").toggle(!!m.showRulers),m.showRulers&&(e("#show_rulers")[0].checked=!0),m.baseUnit&&e("#base_unit").val(m.baseUnit),m.gridSnapping&&(e("#grid_snapping_on")[0].checked=!0),m.snappingStep&&e("#grid_snapping_step").val(m.snappingStep),m.gridColor&&e("#grid_color").val(m.gridColor)}),e("#rect_rx").SpinButton({min:0,max:1e3,callback:Ze}),e("#stroke_width").SpinButton({min:0,max:99,smallStep:.1,callback:Xe}),e("#angle").SpinButton({min:-180,max:180,step:5,callback:Ye}),e("#font_size").SpinButton({min:.001,stepfunc:S,callback:Ke}),e("#group_opacity").SpinButton({min:0,max:100,
step:5,callback:Je}),e("#blur").SpinButton({min:0,max:10,step:.1,callback:$e}),e("#zoom").SpinButton({min:.001,max:1e4,step:50,stepfunc:L,callback:F}).val(100*r.getZoom()),e("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(e,t,n){switch(e){case"interactivity":break;case"delete":ht();break;case"deselect":var o=r.getMode();r.clearSelection(),r.setMode(o);break;case"cut":mt();break;case"copy":_t();break;case"paste":r.pasteElements();break;case"paste_in_place":r.pasteElements("in_place");break;case"group":case"group_elements":r.groupSelectedElements();break;case"ungroup":r.ungroupSelectedElement();break;case"move_front":yt();break;case"move_up":kt("Up");break;case"move_down":kt("Down");break;case"move_back":bt();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(e)&&svgedit.contextmenu.getCustomHandler(e).call()}r.clipBoard.length&&V.enableContextMenuItems("#paste,#paste_in_place")});var xn=function(e,t,n){switch(e){case"dupe":k();break;case"delete":b();break;case"merge_down":x();break;case"merge_all":r.mergeAllLayers(),ke(),ue()}};if(e("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},xn),e("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:!0},xn),e(".contextMenu li").mousedown(function(e){e.preventDefault()}),e("#cmenu_canvas li").disableContextMenu(),V.enableContextMenuItems("#delete,#deselect,#cut,#copy"),window.addEventListener("beforeunload",function(e){if(0===j.getUndoStackSize()&&(s.showSaveWarning=!1),!m.no_save_warning&&s.showSaveWarning)return e.returnValue=y.notification.unsavedChanges,y.notification.unsavedChanges},!1),s.openPrep=function(t){e("#main_menu").hide(),0===j.getUndoStackSize()?t(!0):e.confirm(y.notification.QwantToOpen,t)},window.FileReader){var Cn=function(t){e.process_cancel(y.notification.loadingImage),t.stopPropagation(),t.preventDefault(),e("#workarea").removeAttr("style"),e("#main_menu").hide();var n="drop"==t.type?t.dataTransfer.files[0]:this.files[0];if(!n)return void e("#dialog_box").hide();if(n.type.indexOf("image")!=-1){var o;n.type.indexOf("svg")!=-1?(o=new FileReader,o.onloadend=function(t){r.importSvgString(t.target.result,!0),r.ungroupSelectedElement(),r.ungroupSelectedElement(),r.groupSelectedElements(),r.alignSelectedElements("m","page"),r.alignSelectedElements("c","page"),e("#dialog_box").hide()},o.readAsText(n)):(o=new FileReader,o.onloadend=function(t){var n=function(n,o){var i=r.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:n,height:o,id:r.getNextId(),style:"pointer-events:inherit"}});r.setHref(i,t.target.result),r.selectOnly([i]),r.alignSelectedElements("m","page"),r.alignSelectedElements("c","page"),ke(),e("#dialog_box").hide()},o=100,i=100,a=new Image;a.src=t.target.result,a.style.opacity=0,a.onload=function(){o=a.offsetWidth,i=a.offsetHeight,n(o,i)}},o.readAsDataURL(n))}};W[0].addEventListener("dragenter",T,!1),W[0].addEventListener("dragover",E,!1),W[0].addEventListener("dragleave",N,!1),W[0].addEventListener("drop",Cn,!1);var Sn=e('<input type="file">').change(function(){var t=this;s.openPrep(function(n){if(n&&(r.clear(),1===t.files.length)){e.process_cancel(y.notification.loadingImage);var o=new FileReader;o.onloadend=function(e){l(e.target.result),we()},o.readAsText(t.files[0])}})});e("#tool_open").show().prepend(Sn);var Ln=e('<input type="file">').change(Cn);e("#tool_import").show().prepend(Ln)}we(!0),e(function(){window.svgCanvas=r,r.ready=s.ready}),s.setLang=function(t,n){if(s.langChanged=!0,e.pref("lang",t),e("#lang_select").val(t),n){var o=e("#layerlist tr.layersel td.layername").text(),i=o==y.common.layer+" 1";if(e.extend(y,n),r.setUiStrings(n),O.setTitles(),i&&(r.renameCurrentLayer(y.common.layer+" 1"),ue()),je.length)for(;je.length;){var a=je.shift();a.langReady({lang:t,uiStrings:y})}else r.runExtensions("langReady",{lang:t,uiStrings:y});r.runExtensions("langChanged",t),De();var l={"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"};e.each(l,function(t,n){e(n).attr("title",e(t)[0].title)}),e("#multiselected_panel div[id^=tool_align]").each(function(){e("#tool_pos"+this.id.substr(10))[0].title=this.title})}},r&&r.setColor("fill","#FFFFFF")},s.ready=function(e){d?e():v.push(e)},s.runCallbacks=function(){e.each(v,function(){this()}),d=!0},s.loadFromString=function(e){s.ready(function(){l(e)})},s.disableUI=function(e){},s.loadFromURL=function(t,n){n||(n={});var o=n.cache,i=n.callback;s.ready(function(){e.ajax({url:t,dataType:"text",cache:!!o,beforeSend:function(){e.process_cancel(y.notification.loadingImage)},success:function(e){l(e,i)},error:function(t,n,o){404!=t.status&&t.responseText?l(t.responseText,i):e.alert(y.notification.URLloadFail+": \n"+o,i)},complete:function(){e("#dialog_box").hide()}})})},s.loadFromDataURI=function(e){s.ready(function(){var t=!1,n=e.match(/^data:image\/svg\+xml;base64,/);n?t=!0:n=e.match(/^data:image\/svg\+xml(?:;(?:utf8)?)?,/),n&&(n=n[0]);var o=e.slice(n.length);l(t?u.decode64(o):decodeURIComponent(o))})},s.addExtension=function(){var e=arguments;r&&(r.addExtension.apply(this,e),s&&s.extensionLoadedCallback&&s.extensionLoadedCallback(e))},s}(jQuery)}}}(mysvgeditor||{});