# EPICS Device i18n Translation Guide

## Overview
This document describes the internationalization (i18n) translations added for the EPICS device driver in FUXA.

## Translation Keys

### Tag Property Translations

#### English (en.json)
```json
"device.tag-property-pv-name": "PV Name",
"device.tag-property-pv-type": "PV Type",
"device.tag-property-monitor": "Enable Monitor",
"device.tag-property-monitor-help": "If enabled, FUXA will subscribe to PV updates instead of polling"
```

#### Chinese Simplified (zh-cn.json)
```json
"device.tag-property-pv-name": "PV名称",
"device.tag-property-pv-type": "PV类型",
"device.tag-property-monitor": "启用监控",
"device.tag-property-monitor-help": "如果启用，FUXA将订阅PV更新而不是轮询"
```

### Device Property Translations

#### English (en.json)
```json
"device.property-epics-addr-list": "EPICS CA Address List",
"device.property-epics-auto-addr-list": "EPICS CA Auto Address List",
"device.property-epics-libca-path": "EPICS libca Library Path",
"device.property-epics-libca-help": "Optional: Path to libca.so library. Leave empty for auto-detection."
```

#### Chinese Simplified (zh-cn.json)
```json
"device.property-epics-addr-list": "EPICS CA地址列表",
"device.property-epics-auto-addr-list": "EPICS CA自动地址列表",
"device.property-epics-libca-path": "EPICS libca库路径",
"device.property-epics-libca-help": "可选：libca.so库的路径。留空以自动检测。"
```

## Translation Keys Table

### Tag Property Translations

| Translation Key | English | 简体中文 | Description |
|----------------|---------|----------|-------------|
| `device.tag-property-pv-name` | PV Name | PV名称 | EPICS Process Variable name field label |
| `device.tag-property-pv-type` | PV Type | PV类型 | EPICS Process Variable type selection (string/number/boolean) |
| `device.tag-property-monitor` | Enable Monitor | 启用监控 | Checkbox to enable real-time monitor mode |
| `device.tag-property-monitor-help` | If enabled, FUXA will subscribe to PV updates instead of polling | 如果启用，FUXA将订阅PV更新而不是轮询 | Help text explaining the monitor mode |

### Device Property Translations

| Translation Key | English | 简体中文 | Description |
|----------------|---------|----------|-------------|
| `device.property-epics-addr-list` | EPICS CA Address List | EPICS CA地址列表 | EPICS_CA_ADDR_LIST environment variable |
| `device.property-epics-auto-addr-list` | EPICS CA Auto Address List | EPICS CA自动地址列表 | EPICS_CA_AUTO_ADDR_LIST environment variable |
| `device.property-epics-libca-path` | EPICS libca Library Path | EPICS libca库路径 | NODE_EPICS_CA_LIBCA environment variable |
| `device.property-epics-libca-help` | Optional: Path to libca.so library. Leave empty for auto-detection. | 可选：libca.so库的路径。留空以自动检测。 | Help text for libca library path |

## Usage in Components

### Tag Property Edit Dialog
The translations are used in `client/src/app/device/tag-property/tag-property-edit-epics/tag-property-edit-epics.component.html`:

```html
<!-- PV Name Field -->
<span>{{'device.tag-property-pv-name' | translate}}</span>
<input formControlName="tagAddress" type="text" placeholder="e.g. my:pv:name">

<!-- PV Type Field -->
<span>{{'device.tag-property-pv-type' | translate}}</span>
<mat-select formControlName="tagType">
    <mat-option *ngFor="let type of tagType | enumToArray" [value]="type.key">
        {{ type.value }}
    </mat-option>
</mat-select>

<!-- Monitor Checkbox -->
<mat-checkbox formControlName="tagMonitor">
    {{'device.tag-property-monitor' | translate}}
</mat-checkbox>
<small class="help-text">{{'device.tag-property-monitor-help' | translate}}</small>
```

### Device Property Dialog
The translations are used in `client/src/app/device/device-property/device-property.component.html`:

```html
<div *ngSwitchCase="deviceType.EPICS">
    <!-- EPICS CA Address List -->
    <div class="my-form-field block mb10">
        <span>{{'device.property-epics-addr-list' | translate}}</span>
        <input [(ngModel)]="data.device.property.epicsAddrList"
               placeholder="127.0.0.1"
               style="width: 350px"
               type="text"
               (click)="onAddressChanged()">
    </div>
    
    <!-- EPICS CA Auto Address List -->
    <div class="my-form-field block mb10">
        <span>{{'device.property-epics-auto-addr-list' | translate}}</span>
        <input [(ngModel)]="data.device.property.epicsAutoAddrList"
               placeholder="no"
               style="width: 350px"
               type="text"
               (click)="onAddressChanged()">
    </div>
    
    <!-- EPICS libca Library Path -->
    <div class="my-form-field block mb10">
        <span>{{'device.property-epics-libca-path' | translate}}</span>
        <input [(ngModel)]="data.device.property.nodeEpicsCaLibca"
               placeholder="/path/to/libca.so"
               style="width: 350px"
               type="text"
               (click)="onAddressChanged()">
        <small class="help-text" style="display: block; margin-top: 5px; color: var(--inputPlaceholderColor);">
            {{'device.property-epics-libca-help' | translate}}
        </small>
    </div>
</div>
```

## EPICS Environment Variables

The device property fields map to EPICS Channel Access environment variables:

| Property Field | Environment Variable | Default Value | Description |
|----------------|---------------------|---------------|-------------|
| `epicsAddrList` | `EPICS_CA_ADDR_LIST` | `127.0.0.1` | List of EPICS CA server addresses |
| `epicsAutoAddrList` | `EPICS_CA_AUTO_ADDR_LIST` | `no` | Whether to use automatic address discovery |
| `nodeEpicsCaLibca` | `NODE_EPICS_CA_LIBCA` | (auto-detect) | Path to libca.so library file |

These variables are set in the server driver when connecting to an EPICS device.

## Adding Translations for Other Languages

### Tag Property Translations

To add EPICS tag property translations for other languages (de, es, fr, ja, ko, pt, ru, sv, tr, ua, zh-tw), follow these steps:

1. Open the language file in `client/src/assets/i18n/`
2. Find the section with other `device.tag-property-*` translations (around line 1142 for en.json)
3. Add the following keys after `device.tag-property-gpio`:

```json
"device.tag-property-pv-name": "PV Name",
"device.tag-property-pv-type": "PV Type",
"device.tag-property-monitor": "Enable Monitor",
"device.tag-property-monitor-help": "If enabled, FUXA will subscribe to PV updates instead of polling"
```

4. Replace the English values with appropriate translations for the target language

### Device Property Translations

To add EPICS device property translations:

1. Open the language file in `client/src/assets/i18n/`
2. Find the section with `device.property-socket-reuse` (around line 945 for zh-cn.json)
3. Add the following keys after `device.property-socket-reuse`:

```json
"device.property-epics-addr-list": "EPICS CA Address List",
"device.property-epics-auto-addr-list": "EPICS CA Auto Address List",
"device.property-epics-libca-path": "EPICS libca Library Path",
"device.property-epics-libca-help": "Optional: Path to libca.so library. Leave empty for auto-detection."
```

4. Replace the English values with appropriate translations for the target language

### Example: German (de.json)

Tag Property:
```json
"device.tag-property-pv-name": "PV-Name",
"device.tag-property-pv-type": "PV-Typ",
"device.tag-property-monitor": "Monitor aktivieren",
"device.tag-property-monitor-help": "Wenn aktiviert, abonniert FUXA PV-Updates anstatt zu pollen"
```

Device Property:
```json
"device.property-epics-addr-list": "EPICS CA-Adressliste",
"device.property-epics-auto-addr-list": "EPICS CA Auto-Adressliste",
"device.property-epics-libca-path": "EPICS libca-Bibliothekspfad",
"device.property-epics-libca-help": "Optional: Pfad zur libca.so-Bibliothek. Leer lassen für automatische Erkennung."
```

### Example: French (fr.json)

Tag Property:
```json
"device.tag-property-pv-name": "Nom PV",
"device.tag-property-pv-type": "Type PV",
"device.tag-property-monitor": "Activer le moniteur",
"device.tag-property-monitor-help": "Si activé, FUXA s'abonnera aux mises à jour PV au lieu de faire du polling"
```

Device Property:
```json
"device.property-epics-addr-list": "Liste d'adresses CA EPICS",
"device.property-epics-auto-addr-list": "Liste d'adresses automatiques CA EPICS",
"device.property-epics-libca-path": "Chemin de la bibliothèque libca EPICS",
"device.property-epics-libca-help": "Optionnel: Chemin vers la bibliothèque libca.so. Laissez vide pour la détection automatique."
```

## EPICS Terminology

- **PV**: Process Variable - A named data point in an EPICS system
- **CA**: Channel Access - The network protocol used by EPICS
- **libca**: The core EPICS Channel Access library (libca.so)
- **Monitor Mode**: Real-time subscription to PV changes using CA.monitor()
- **Polling Mode**: Periodic reading of PV values using CA.get()
- **EPICS_CA_ADDR_LIST**: Environment variable specifying EPICS server addresses
- **EPICS_CA_AUTO_ADDR_LIST**: Environment variable for automatic address discovery
- **NODE_EPICS_CA_LIBCA**: Environment variable specifying libca.so library path

## Testing Translations

To test the translations:

1. Change the language in FUXA settings
2. Create a new EPICS device
3. Configure the EPICS device properties (CA address list, etc.)
4. Verify all property labels are displayed in the selected language
5. Add a new tag to the EPICS device
6. Verify all tag property labels are displayed in the selected language
7. Check that help texts appear correctly

## Notes

- The EPICS device type itself (shown in device lists) is not translated and displays as "EPICS" in all languages
- This is consistent with other device types (e.g., "ModbusTCP", "OPCUA") which also display their technical names
- Only user-facing UI elements (labels, help text, buttons) are translated
- Default values are set automatically when creating a new EPICS device:
  - EPICS_CA_ADDR_LIST: `127.0.0.1`
  - EPICS_CA_AUTO_ADDR_LIST: `no`
  - NODE_EPICS_CA_LIBCA: (empty - auto-detect)
